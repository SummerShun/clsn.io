---
title: MySQL的存储引擎与日志说明
author: 惨绿少年
type: post
date: 2017-12-27T02:22:00+00:00
url: /clsn/lx370.html
Baidusubmit:
  - 1
views:
  - 248
specs_zan:
  - 3
zm_favorites:
  - 1
categories:
  - Linux运维
  - MySQL
  - 数据库
  - 运维基本功

---
## <span id="11">1.1 存储引擎的介绍</span>

<p align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222204438584-733595513.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />&nbsp;
</p>

### <span id="111">1.1.1 文件系统存储</span>

　　文件系统：操作系统组织和存取数据的一种机制。文件系统是一种软件。

　　类型：ext2 3 4 ，xfs 数据。&nbsp; 不管使用什么文件系统，数据内容不会变化，不同的是，存储空间、大小、速度。

### <span id="112_mysql">1.1.2 mysql数据库存储</span>

　　MySQL引擎： 可以理解为，MySQL的&ldquo;文件系统&rdquo;，只不过功能更加强大。

　　MySQL引擎功能： 除了可以提供基本的存取功能，还有更多功能事务功能、锁定、备份和恢复、优化以及特殊功能。

### <span id="113_MySQL">1.1.3 MySQL存储引擎种类</span>

MySQL 提供以下存储引擎：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">InnoDB、MyISAM (最常用的两种)
MEMORY、ARCHIVE、FEDERATED、EXAMPLE
BLACKHOLE、MERGE、NDBCLUSTER、CSV</span></pre>
  </div>
  
  <p>
    　　除此之外还可以使用第三方存储引擎。
  </p>
</div>

### <span id="114_innodbmyisam">1.1.4 innodb与myisam对比</span>

<span style="background-color: #ffff00;"><strong>InnoDb</strong><strong>引擎</strong></span>

  1. 支持ACID的事务，支持事务的四种隔离级别；
  2. 支持行级锁及外键约束：因此可以支持写并发；
  3. 不存储总行数；
  4. 一个InnoDb引擎存储在一个文件空间（共享表空间，表大小不受操作系统控制，一个表可能分布在多个文件里），也有可能为多个（设置为独立表空，表大小受操作系统文件大小限制，一般为2G），受操作系统文件大小的限制；
  5. 主键索引采用聚集索引（索引的数据域存储数据文件本身），辅索引的数据域存储主键的值；因此从辅索引查找数据，需要先通过辅索引找到主键值，再访问辅索引；最好使用自增主键，防止插入数据时，为维持B+树结构，文件的大调整。

_<span style="text-decoration: underline;">Innodb</span>__<span style="text-decoration: underline;">的主索引结构如下：</span>_

<p align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222204555943-813641176.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />&nbsp;
</p>

<span style="background-color: #ffff00;"><strong>MyISAM</strong><strong>引擎</strong></span>

  1. 不支持事务，但是每次查询都是原子的；
  2. 支持表级锁，即每次操作是对整个表加锁；
  3. 存储表的总行数；
  4. 一个MYISAM表有三个文件：索引文件、表结构文件、数据文件；
  5. 采用菲聚集索引，索引文件的数据域存储指向数据文件的指针。辅索引与主索引基本一致，但是辅索引不用保证唯一性。

_<span style="text-decoration: underline;">MYISAM</span>__<span style="text-decoration: underline;">的主索引结构如下：</span>_

<p align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222204614428-1809734723.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

<span style="background-color: #ffff00;"><strong>两种索引数据查找过程如下：</strong></span>

<p align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222204639834-1451134518.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />&nbsp;
</p>

## <span id="12_innodb">1.2 innodb存储引擎</span>

　　在MySQL5.5版本之后，默认的**存储引擎**，提供高可靠性和高性能。

### <span id="121_Innodb">1.2.1 Innodb引擎的优点</span>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">a)    事务安全（遵从ACID）
b)    MVCC（Multi</span><span style="color: #808080;">-</span><span style="color: #000000;">Versioning Concurrency Control，多版本并发控制）
c)    InnoDB行级锁
d)    支持外键引用完整性约束
e)    出现故障后快速自动恢复（crash safe recovery）
f)    用于在内存中缓存数据和索引的缓冲区池（buffer pool（data buffer page  </span><span style="color: #ff00ff;">log</span><span style="color: #000000;"> buffer page） 、undo buffer page）
g)    大型数据卷上的最大性能
h)    将对表的查询与不同存储引擎混合
i)    Oracle样式一致非锁定读取(共享锁)
j)    表数据进行整理来优化基于主键的查询（聚集索引）</span></pre>
</div>

### <span id="122_Innodb">1.2.2 Innodb功能总览</span>

<div align="center">
  <div align="center">
    <table class="MsoTable15Grid4Accent3" style="width: 100%; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
      <tr>
        <td style="width: 24.46%; border-top-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-top-color: #9bbb59; border-bottom-color: #9bbb59; border-left-color: #9bbb59; border-right: none; background: #9bbb59; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 5;" align="center">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">功能</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top-width: 1pt; border-top-color: #9bbb59; border-left: none; border-bottom-width: 1pt; border-bottom-color: #9bbb59; border-right: none; background: #9bbb59; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">支持</span></strong>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top-width: 1pt; border-top-color: #9bbb59; border-left: none; border-bottom-width: 1pt; border-bottom-color: #9bbb59; border-right: none; background: #9bbb59; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">功能</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top-width: 1pt; border-right-width: 1pt; border-bottom-width: 1pt; border-top-color: #9bbb59; border-right-color: #9bbb59; border-bottom-color: #9bbb59; border-left: none; background: #9bbb59; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">支持</span></strong>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">存储限制</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span lang="EN-US">64 TB</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">索引高速缓存</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
            <strong><span lang="EN-US">MVCC</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">数据高速缓存</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span lang="EN-US">B </span></strong><strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">树索引</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">自适应散列索引</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">群集索引</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">复制</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">压缩数据</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">更新数据字典</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">加密数据</span><span lang="EN-US">[b]</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">地理空间数据类型</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">查询高速缓存</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">地理空间索引</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">否</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">事务</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">全文搜索索引</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">锁定粒度</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">行</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">群集数据库</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">否</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">外键</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">备份和恢复</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">文件格式管理</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">快速索引创建</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">多个缓冲区池</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
            <strong><span lang="EN-US">PERFORMANCE_SCHEMA</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
      
      <tr>
        <td style="width: 24.46%; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">更改缓冲</span></strong>
          </p>
        </td>
        
        <td style="width: 24.4%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
        
        <td style="width: 26.86%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="26%">
          <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
            <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">自动故障恢复</span></strong>
          </p>
        </td>
        
        <td style="width: 24.28%; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="24%">
          <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
            <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span>
          </p>
        </td>
      </tr>
    </table>
  </div>
</div>

### <span id="123">1.2.3 查询存储引擎的方法</span>

1、使用 SELECT 确认会话存储引擎：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #0000ff;">SELECT</span> <span style="color: #008000; font-weight: bold;">@@default_storage_engine</span><span style="color: #000000;">;
或
show variables </span><span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%engine%</span><span style="color: #ff0000;">'</span>;</pre>
  </div>
</div>

2、使用 SHOW 确认每个表的存储引擎：

<div>
  <div class="cnblogs_code">
    <pre>SHOW <span style="color: #0000ff;">CREATE</span> <span style="color: #0000ff;">TABLE</span><span style="color: #000000;"> City\G
SHOW </span><span style="color: #0000ff;">TABLE</span> STATUS <span style="color: #808080;">LIKE</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">CountryLanguage</span><span style="color: #ff0000;">'</span>\G</pre>
  </div>
</div>

3、使用 INFORMATION_SCHEMA 确认每个表的存储引擎：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #0000ff;">SELECT</span> TABLE_NAME, ENGINE <span style="color: #0000ff;">FROM</span><span style="color: #000000;"> 
INFORMATION_SCHEMA.TABLES
</span><span style="color: #0000ff;">WHERE</span> TABLE_NAME <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">City</span><span style="color: #ff0000;">'</span>
<span style="color: #808080;">AND</span> TABLE_SCHEMA <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">world_innodb</span><span style="color: #ff0000;">'</span>\G    </pre>
  </div>
</div>

4、从5.1版本，迁移到5.5版本以上版本

&nbsp;&nbsp; 　　假如5.1版本数据库所有生产表都是myisam的。

&nbsp;&nbsp;　　 使用mysqldump备份后，一点要替换备份的文件中的engine(引擎)字段，从myisam替换为innodb（可以使用sed命令），否则迁移无任何意义。

&nbsp;&nbsp;　　 数据库升级时，要注意其他配套设施的兼容性，注意代码能否兼容新特性。

### <span id="124">1.2.4 设置存储引擎</span>

1、在启动配置文件中设置服务器存储引擎：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span>
<span style="color: #0000ff;">default</span><span style="color: #808080;">-</span>storage<span style="color: #808080;">-</span>engine<span style="color: #808080;">=&lt;</span>Storage Engine<span style="color: #808080;">></span></pre>
  </div>
</div>

2、使用 SET 命令为当前客户机会话设置：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #0000ff;">SET</span> <span style="color: #008000; font-weight: bold;">@@storage_engine</span><span style="color: #808080;">=&lt;</span>Storage Engine<span style="color: #808080;">></span>;</pre>
  </div>
</div>

3、在 CREATE TABLE 语句指定：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #0000ff;">CREATE</span> <span style="color: #0000ff;">TABLE</span> t (i <span style="color: #0000ff;">INT</span>) ENGINE <span style="color: #808080;">=</span> <span style="color: #808080;">&lt;</span>Storage Engine<span style="color: #808080;">></span>;</pre>
  </div>
</div>

## <span id="13_InnoDB">1.3 InnoDB存储引擎的存储结构</span>

### <span id="131_InnoDB">1.3.1 InnoDB 系统表空间特性</span>

  1. 默认情况下，InnoDB 元数据、撤消日志和缓冲区存储在系统&ldquo;表空间&rdquo;中。
  2. 这是单个逻辑存储区域，可以包含一个或多个文件。
  3. 每个文件可以是常规文件或原始分区。
  4. 最后的文件可以自动扩展。

### <span id="132">1.3.2 表空间的定义</span>

　　表空间：MySQL数据库存储的方式

　　　　表空间中包含数据文件

　　MySQl表空间和数据文件是1:1的关系

　　　　共享表空间除外，是可以1:N关系

<p align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222205111912-2060569556.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

### <span id="133">1.3.3 表空间类型</span>

　　1、共享表空间：ibdata1~ibdataN,一般是2-3个

　　2、独立表空间：存放在指定库目录下，例如data/world/目录下的city.ibd

　　　　表空间位置（datadir）：

　　　　data/目录下

### <span id="134">1.3.4 系统表空间的存储内容</span>

<span style="background-color: #00ff00;"><em><span style="text-decoration: underline;">共享表空间（物理存储结构）</span></em></span>

&nbsp;&nbsp;　　 ibdata1~N 通常被叫做系统表空间，是数据初始化生成的

&nbsp;&nbsp;　　 系统元数据，基表数据，除了表内容数据之外的数据。

&nbsp;&nbsp; 　　tmp 表空间（一般很少关注）

&nbsp;&nbsp; 　　undo日志 ：数据--回滚数据（回滚日志使用）

&nbsp;&nbsp;　　 redo日志 ：ib_logfile0~N 存放系统的innodb表的一些重做日志。

&nbsp;&nbsp;　　 说明：undo日志默认实在ibdata中的，在5.6以后是可以单独定义的。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;　　 tmp 表空间在_<span style="text-decoration: underline;">5.7</span>__<span style="text-decoration: underline;">版本之后</span>_被移出了ibdata1，变为ibtmp1

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 　　&nbsp; 在_<span style="text-decoration: underline;">5.5</span>__<span style="text-decoration: underline;">版本之前</span>_，所有的应用数据也都默认存放到了ibdata中。

<span style="background-color: #00ff00;"><em><span style="text-decoration: underline;">独立表空间(</span></em><em><span style="text-decoration: underline;">一个存储引擎的功能)</span></em></span>

&nbsp;&nbsp;　　 在5.6之后，默认的情况下会单表单独存储到独立表空间文件

　　　除了系统表空间之外，InnoDB 还在数据库目录中创建另外的表空间，用于每个 InnoDB 表的 .ibd 文件。

　　&nbsp; &nbsp;InnoDB 创建的每个新表在数据库目录中设置一个 .ibd 文件来搭配表的.frm 文件。

　　　可以使用 innodb\_file\_per_table 选项控制此设置，更改该设置仅会更改已创建的新表的默认值。。

<p align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222205202037-1994656863.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

### <span id="135">1.3.5 设置共享表空间</span>

查看当前的共享表空间设置

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">innodb_data_file_path</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+------------------------+</span>
<span style="color: #808080;">|</span> Variable_name         <span style="color: #808080;">|</span> Value                  <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+------------------------+</span>
<span style="color: #808080;">|</span> innodb_data_file_path <span style="color: #808080;">|</span> ibdata1:12M:autoextend <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+------------------------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
  
  <p>
    　设置共享表空间：
  </p>
</div>

　　一般是在初始搭建环境的时候就配置号，预设值一般为1G；且最后一个为自动扩展。

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 world</span><span style="color: #ff0000;">]</span># vim <span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
innodb_data_file_path</span><span style="color: #808080;">=</span>ibdata1:76M;ibdata2:100M:autoextend</pre>
  </div>
</div>

重启服务查看当前的共享表空间设置

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">innodb_data_file_path</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------------------------------------+</span>
<span style="color: #808080;">|</span> Variable_name         <span style="color: #808080;">|</span> Value                               <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------------------------------------+</span>
<span style="color: #808080;">|</span> innodb_data_file_path <span style="color: #808080;">|</span> ibdata1:76M;ibdata2:100M:autoextend <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------------------------------------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

### <span id="136">1.3.6 设置独立表空间</span>

　　　独立表空间在5.6版本是默认开启的。

　　　<span style="color: #ff0000;">独立表空间注意事项：</span>**<span style="text-decoration: underline;">不开起独立表空间，共享表空间会占用很大</span>**

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%per_table%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name         <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------+</span>
<span style="color: #808080;">|</span> innodb_file_per_table <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>    <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

&nbsp;&nbsp; 在参数文件/etc/my.cnf&nbsp; 可以控制独立表空间

关闭独立表空间 （0是关闭，1是开启）

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 clsn</span><span style="color: #ff0000;">]</span># vim <span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
innodb_file_per_table</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;"></span></pre>
  </div>
</div>

查看独立表空间配置

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%per_table%</span><span style="color: #ff0000;">'</span><span style="color: #000000;"> ;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name         <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------+</span>
<span style="color: #808080;">|</span> innodb_file_per_table <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">---------------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

小结:

<div>
  <div class="cnblogs_code">
    <pre>innodb_file_per_table<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;"></span><span style="color: #000000;">    关闭独立表空间
innodb_file_per_table</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span>    开启独立表空间，单表单存储</pre>
  </div>
</div>

## <span id="14_MySQL">1.4 MySQL中的事务</span>

　　一组数据操作执行步骤，这些步骤被视为一个工作单元

&nbsp;&nbsp;　　　　 用于对多个语句进行分组，可以在多个客户机并发访问同一个表中的数据时使用。

　　所有步骤都成功或都失败

&nbsp;&nbsp;　　　　 如果所有步骤正常，则执行，如果步骤出现错误或不完整，则取消。

_<span style="text-decoration: underline;">简单来说事务就是：保证工作单元中的语句同时成功或同时失败。</span>_

<p align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222205547162-622353342.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

<p align="center">
  事务处理流程示意图
</p>

### <span id="141">1.4.1 事务是什么</span>

　　与其给事务定义，不如说一说事务的特性。众所周知，事务需要满足**ACID**四个特性。

<span style="background-color: #00ff00;">A(atomicity) 原子性。</span>

　　　一个事务的执行被视为一个不可分割的最小单元。事务里面的操作，要么全部成功执行，要么全部失败回滚，不可以只执行其中的一部分。

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">所有语句作为一个单元全部成功执行或全部取消。
updata t1 </span><span style="color: #0000ff;">set</span> <span style="color: #0000ff;">money</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">10000</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">17</span> <span style="color: #0000ff;">where</span>  id<span style="color: #808080;">=</span><span style="color: #000000;">wxid1
updata t1 </span><span style="color: #0000ff;">set</span> <span style="color: #0000ff;">money</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">10000</span><span style="color: #808080;">+</span><span style="color: #800000; font-weight: bold;">17</span>  <span style="color: #0000ff;">where</span>  id<span style="color: #808080;">=</span>wxid2</pre>
  </div>
</div>

<span style="background-color: #00ff00;">C(consistency) 一致性</span>。

　　一个事务的执行不应该破坏数据库的完整性约束。如果上述例子中第2个操作执行后系统崩溃，保证A和B的金钱总计是不会变的。

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">如果数据库在事务开始时处于一致状态，则在执行该事务期间将保留一致状态。
    updata t1 </span><span style="color: #0000ff;">set</span> <span style="color: #0000ff;">money</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">10000</span><span style="color: #808080;">-</span><span style="color: #800000; font-weight: bold;">17</span> <span style="color: #0000ff;">where</span>  id<span style="color: #808080;">=</span><span style="color: #000000;">wxid1
    updata t1 </span><span style="color: #0000ff;">set</span> <span style="color: #0000ff;">money</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">10000</span><span style="color: #808080;">+</span><span style="color: #800000; font-weight: bold;">17</span>  <span style="color: #0000ff;">where</span>  id<span style="color: #808080;">=</span><span style="color: #000000;">wxid2
    在以上操作过程中，去查自己账户还是10000</span></pre>
  </div>
</div>

<span style="background-color: #00ff00;">I(isolation) 隔离性。</span>

　　通常来说，事务之间的行为不应该互相影响。然而实际情况中，事务相互影响的程度受到隔离级别的影响。文章后面会详述。

<div>
  <p class="ac">
    　　事务之间不相互影响。在做操作的时候，其他人对这两个账户做任何操作，在不同的隔离条件下，可能一致性保证又不一样
  </p>
</div>

_隔离级别_

<div class="cnblogs_code">
  <pre><span style="color: #000000;">    隔离级别会影响到一致性。
    </span><span style="color: #0000ff;">read</span><span style="color: #808080;">-</span><span style="color: #000000;">uncommit  X
    </span><span style="color: #0000ff;">read</span><span style="color: #808080;">-</span><span style="color: #0000ff;">commit</span><span style="color: #000000;">   可能会用的一种级别
    </span><span style="color: #0000ff;">repeatable</span><span style="color: #808080;">-</span><span style="color: #0000ff;">read</span><span style="color: #000000;">   默认的级别，和oracle一样的
    </span><span style="color: #0000ff;">SERIALIZABLE</span>       严格的默认，一般不会用</pre>
</div>

　　此规则除了受隔离级别控制，还受锁控制，可以联想一下NFS的实现

<span style="background-color: #00ff00;">D(durability) 持久性。</span>

　　事务提交之后，需要将提交的事务持久化到磁盘。即使系统崩溃，提交的数据也不应该丢失。

<div>
  <div class="cnblogs_code">
    <pre>　保证数据落地，才算事务真正安全</pre>
  </div>
</div>

### <span id="142">1.4.2 事务的控制语句</span>

常用的事务控制语句：

<div class="cnblogs_code">
  <pre>    START <span style="color: #0000ff;">TRANSACTION</span>（或 <span style="color: #0000ff;">BEGIN</span><span style="color: #000000;">）：显式开始一个新事务
    </span><span style="color: #0000ff;">COMMIT</span><span style="color: #000000;">：永久记录当前事务所做的更改(事务成功结束)
    </span><span style="color: #0000ff;">ROLLBACK</span>：取消当前事务所做的更改(事务失败结束)</pre>
</div>

需要知道的事务控制语句：

<div class="cnblogs_code">
  <pre><span style="color: #000000;">    SAVEPOINT：分配事务过程中的一个位置，以供将来引用
    </span><span style="color: #0000ff;">ROLLBACK</span> <span style="color: #0000ff;">TO</span><span style="color: #000000;"> SAVEPOINT：取消在 savepoint 之后执行的更改
    RELEASE SAVEPOINT：删除 savepoint 标识符
    </span><span style="color: #0000ff;">SET</span> AUTOCOMMIT：为当前连接禁用或启用默认 autocommit模式</pre>
</div>

### <span id="143_autocommit">1.4.3 autocommit参数</span>

　　在MySQL5.5开始，开启事务时不再需要begin或者start transaction语句。并且，默认是开启了Autocommit模式，作为一个事务隐式提交每个语句。

　　在有些业务繁忙企业场景下，这种配置可能会对性能产生很大影响，但对于安全性上有很大提高。将来，我们需要去权衡我们的业务需求去调整是否自动提交。

**　　注意：在生产中，根据实际需求选择是否可开启，一般银行类业务会选择关闭。**

查看当前autocommit状态：

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%autoc%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> autocommit    <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>    <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

修改配置文件，并重启

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 world</span><span style="color: #ff0000;">]</span># vim <span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
autocommit</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;"></span></pre>
  </div>
</div>

再次查看autocommit状态

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%autoc%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> autocommit    <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span><span style="color: #000000;"> sec)
mysql</span><span style="color: #808080;">></span> <span style="color: #0000ff;">select</span> <span style="color: #008000; font-weight: bold;">@@autocommit</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------+</span>
<span style="color: #808080;">|</span> <span style="color: #008000; font-weight: bold;">@@autocommit</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------+</span>
<span style="color: #808080;">|</span>            <span style="color: #800000; font-weight: bold;"></span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
  
  <p>
    　　<strong>说明： </strong>autocommit设置为开启的对比
  </p>
</div>

<div>
  <p class="a3">
    &nbsp;&nbsp;&nbsp;　　<span style="color: #00ff00;"> 优点：</span>数据安全性好，每次修改都会落地
  </p>
  
  <p class="a3">
    &nbsp;&nbsp;　　&nbsp; <span style="color: #00ff00;">缺点：</span>不能进行银行类的交易事务、产生大量小的IO
  </p>
</div>

### <span id="144">1.4.4 导致提交的非事务语句：</span>

<div class="cnblogs_code">
  <pre>DDL语句： （<span style="color: #0000ff;">ALTER</span>、<span style="color: #0000ff;">CREATE</span> 和 <span style="color: #0000ff;">DROP</span><span style="color: #000000;">）
DCL语句： （</span><span style="color: #0000ff;">GRANT</span>、<span style="color: #0000ff;">REVOKE</span> 和 <span style="color: #0000ff;">SET</span><span style="color: #000000;"> PASSWORD）
锁定语句：（LOCK TABLES 和 UNLOCK TABLES）</span></pre>
</div>

导致隐式提交的语句示例：

<div class="cnblogs_code">
  <pre><span style="color: #0000ff;">TRUNCATE</span> <span style="color: #0000ff;">TABLE</span>
<span style="color: #0000ff;">LOAD</span><span style="color: #000000;"> DATA INFILE
</span><span style="color: #0000ff;">SELECT</span> <span style="color: #0000ff;">FOR</span> <span style="color: #0000ff;">UPDATE</span></pre>
</div>

用于隐式提交的 SQL 语句：

<div class="cnblogs_code">
  <pre>START <span style="color: #0000ff;">TRANSACTION</span>
<span style="color: #0000ff;">SET</span> AUTOCOMMIT <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">1</span></pre>
</div>

## <span id="15_redoundo">1.5 redo与undo</span>

<p style="text-align: center;">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222210412928-417691500.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

### <span id="151_undo">1.5.1 事务日志undo</span>

<span style="background-color: #00ff00;">undo原理：</span>

　　Undo Log的原理很简单，为了满足事务的原子性，在操作任何数据之前，首先将数据备份到一个地方（这个存储数据备份的地方称为Undo Log）。然后进行数据的修改。

　　如果出现了错误或者用户执行了ROLLBACK语句，系统可以利用Undo Log中的备份将数据恢复到事务开始之前的状态。

除了可以保证事务的原子性，Undo Log也可以用来辅助完成事务的持久化。

<p align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222210532068-508366062.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

**<span style="text-decoration: underline;">undo</span>****<span style="text-decoration: underline;">是什么？</span>**

　　undo,顾名思义&ldquo;回滚日志&rdquo;，是事务日志的一种。

**<span style="text-decoration: underline;">作用是什么？</span>**

　　在事务ACID过程中，实现的是&ldquo;A&ldquo;原子性的作用。

<span style="background-color: #00ff00;"><em><span style="text-decoration: underline;">用Undo Log</span></em><em><span style="text-decoration: underline;">实现原子性和持久化的事务的简化过程</span></em></span>

<div>
  <div class="cnblogs_code">
    <pre>  假设有A、B两个数据，值分别为1,<span style="color: #800000; font-weight: bold;">2</span><span style="color: #000000;">。
  A.事务开始.
  B.记录A</span><span style="color: #808080;">=</span>1到undo <span style="color: #ff00ff;">log</span><span style="color: #000000;">.
  C.修改A</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">3</span><span style="color: #000000;">.
  D.记录B</span><span style="color: #808080;">=</span>2到undo <span style="color: #ff00ff;">log</span><span style="color: #000000;">.
  E.修改B</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;">.
  F.将undo log写到磁盘。
  G.将数据写到磁盘。
  H.事务提交</span></pre>
  </div>
</div>

&nbsp; 这里有一个隐含的前提条件：&lsquo;数据都是先读到内存中，然后修改内存中的数据，最后将数据写回磁盘之所以能同时保证原子性和持久化，是因为以下特点：

<div>
  <div class="cnblogs_code">
    <pre>  A. 更新数据前记录Undo <span style="color: #ff00ff;">log</span><span style="color: #000000;">。
  B. 为了保证持久性，必须将数据在事务提交前写到磁盘。只要事务成功提交，数据必然已经持久化。
  C. Undo log必须先于数据持久化到磁盘。如果在G,H之间系统崩溃，undo log是完整的，可以用来回滚事务。
  D. 如果在A</span><span style="color: #808080;">-</span>F之间系统崩溃,因为数据没有持久化到磁盘。所以磁盘上的数据还是保持在事务开始前的状态。</pre>
  </div>
</div>

<span style="background-color: #00ff00;"><strong><em><span style="text-decoration: underline;">缺陷：</span></em></strong></span>

　　每个事务提交前将数据和Undo Log写入磁盘，这样会导致大量的磁盘IO，因此性能很低。如果能够将数据缓存一段时间，就能减少IO提高性能。但是这样就会丧失事务的持久性。

　　因此引入了另外一种机制来实现持久化，即Redo Log.

### <span id="152_redo">1.5.2 事务日志redo</span>

**_<span style="text-decoration: underline;">redo</span>_****_<span style="text-decoration: underline;">原理：</span>_**

　　和Undo Log相反，Redo Log记录的是新数据的备份。在事务提交前，只要将Redo Log持久化即可，不需要将数据持久化。当系统崩溃时，虽然数据没有持久化，但是Redo Log已经持久化。

　　系统可以根据Redo Log的内容，将所有数据恢复到最新的状态。

<p style="text-align: center;">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222210631396-1458752602.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />
</p>

&nbsp;

**<span style="text-decoration: underline;">Redo</span>****<span style="text-decoration: underline;">是什么？</span>**

　　redo,顾名思义&ldquo;重做日志&rdquo;，是事务日志的一种。

**<span style="text-decoration: underline;">作用是什么？</span>**

　　在事务ACID过程中，实现的是&ldquo;D&rdquo;持久化的作用。

_<span style="text-decoration: underline;">Undo + Redo</span>__<span style="text-decoration: underline;">事务的简化过程</span>_

<div>
  <div class="cnblogs_code">
    <pre> 假设有A、B两个数据，值分别为1,<span style="color: #800000; font-weight: bold;">2</span><span style="color: #000000;">.
  A.事务开始.
  B.记录A</span><span style="color: #808080;">=</span>1到undo <span style="color: #ff00ff;">log</span><span style="color: #000000;">.
  C.修改A</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">3</span><span style="color: #000000;">.
  D.记录A</span><span style="color: #808080;">=</span>3到redo <span style="color: #ff00ff;">log</span><span style="color: #000000;">.
  E.记录B</span><span style="color: #808080;">=</span>2到undo <span style="color: #ff00ff;">log</span><span style="color: #000000;">.
  F.修改B</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">4</span><span style="color: #000000;">.
  G.记录B</span><span style="color: #808080;">=</span>4到redo <span style="color: #ff00ff;">log</span><span style="color: #000000;">.
  H.将redo log写入磁盘。
  I.事务提交</span></pre>
  </div>
</div>

_<span style="text-decoration: underline;">Undo + Redo</span>__<span style="text-decoration: underline;">事务的特点</span>_

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;"> A. 为了保证持久性，必须在事务提交前将Redo Log持久化。
  B. 数据不需要在事务提交前写入磁盘，而是缓存在内存中。
  C. Redo </span><span style="color: #ff00ff;">Log</span><span style="color: #000000;"> 保证事务的持久性。
  D. Undo </span><span style="color: #ff00ff;">Log</span><span style="color: #000000;"> 保证事务的原子性。
  E. 有一个隐含的特点，数据必须要晚于redo log写入持久存储。</span></pre>
  </div>
  
  <p class="a3">
    <span style="background-color: #ffff00;">redo是否持久化到磁盘参数</span>
  </p>
</div>

<div>
  <div class="cnblogs_code">
    <pre>innodb_flush_log_at_trx_commit<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;"></span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">2</span></pre>
  </div>
</div>

### <span id="153">1.5.3 事务中的锁</span>

**_<span style="text-decoration: underline;">什么是&ldquo;锁&rdquo;？</span>_**

　　&ldquo;锁&rdquo;顾名思义就是锁定的意思。

**_<span style="text-decoration: underline;">&ldquo;锁&rdquo;的作用是什么？</span>_**

　　在事务ACID过程中，&ldquo;锁&rdquo;和&ldquo;隔离级别&rdquo;一起来实现&ldquo;I&rdquo;隔离性的作用。

<p align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171222210755443-1768045723.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="MySQL的存储引擎与日志说明" alt="" />&nbsp;
</p>

**_<span style="text-decoration: underline;">锁的粒度：</span>_**

　　1、MyIasm：低并发锁&mdash;&mdash;表级锁

　　2、Innodb：高并发锁&mdash;&mdash;行级锁

**_<span style="text-decoration: underline;">四种隔离级别：</span>_**

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #0000ff;">READ</span> <span style="color: #0000ff;">UNCOMMITTED</span><span style="color: #000000;"> 许事务查看其他事务所进行的未提交更改
</span><span style="color: #0000ff;">READ</span> <span style="color: #0000ff;">COMMITTED</span><span style="color: #000000;">    允许事务查看其他事务所进行的已提交更改
</span><span style="color: #0000ff;">REPEATABLE</span> <span style="color: #0000ff;">READ</span><span style="color: #808080;">******</span> 确保每个事务的 <span style="color: #0000ff;">SELECT</span><span style="color: #000000;"> 输出一致； InnoDB 的默认级别
</span><span style="color: #0000ff;">SERIALIZABLE</span>  将一个事务的结果与其他事务完全隔离</pre>
  </div>
</div>

_<span style="text-decoration: underline;">开销、加锁速度、死锁、粒度、并发性能</span>_

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高,并发度最低。
行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低,并发度也最高。
页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。</span></pre>
  </div>
  
  <p>
    　　从上述特点可见，很难笼统地说哪种锁更好，只能就具体应用的特点来说哪种锁更合适！
  </p>
</div>

　　仅从锁的角度来说：表级锁更适合于以查询为主，只有少量按索引条件更新数据的应用，如Web应用；而行级锁则更适合于有大量按索引条件并发更新少量不同数据，同时又有并发查询的应用，如一些在线事务处理（OLTP）系统。

## <span id="16_MySQL">1.6 MySQL 日志管理</span>

### <span id="161_MySQL">1.6.1 MySQL日志类型简介</span>

<span style="background-color: #00ff00;"><em><span style="text-decoration: underline;">日志的类型的说明：</span></em></span>

<table class="MsoTable15Grid4Accent3" style="border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr style="mso-yfti-irow: -1; mso-yfti-firstrow: yes; mso-yfti-lastfirstrow: yes; height: 13.15pt;">
    <td style="width: 63.55pt; border-top-width: 1pt; border-top-color: #9bbb59; border-left-width: 1pt; border-left-color: #9bbb59; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right: none; background: #9bbb59; padding: 0cm 5.4pt; height: 13.15pt;" rowspan="2" width="85">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 5;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">日志文件</span></strong>
      </p>
    </td>
    
    <td style="width: 5cm; border-top-width: 1pt; border-top-color: #9bbb59; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right: none; background: #9bbb59; padding: 0cm 5.4pt; height: 13.15pt;" rowspan="2" width="189">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">选项</span></strong>
      </p>
    </td>
    
    <td style="width: 186.8pt; border-top-width: 1pt; border-top-color: #9bbb59; border-left: none; border-bottom-width: 1pt; border-bottom-color: #9bbb59; border-right: none; background: #9bbb59; padding: 0cm 5.4pt; height: 13.15pt;" width="249">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">文件名</span></strong>
      </p>
    </td>
    
    <td style="width: 130.7pt; border-top-width: 1pt; border-top-color: #9bbb59; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #9bbb59; background: #9bbb59; padding: 0cm 5.4pt; height: 13.15pt;" rowspan="2" width="174">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">程序</span></strong>
      </p>
      
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
        <strong><span style="color: white; mso-themecolor: background1;" lang="EN-US">N/A</span></strong>
      </p>
    </td>
  </tr>
  
  <tr style="mso-yfti-irow: 0; height: 13.15pt;">
    <td style="width: 186.8pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #9bbb59; padding: 0cm 5.4pt; height: 13.15pt;" width="249">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 64;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">表名称</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 63.55pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="85">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">错误</span></strong>
      </p>
    </td>
    
    <td style="width: 5cm; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="189">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">--log-error</span>
      </p>
    </td>
    
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">host_name.err</span>
      </p>
    </td>
    
    <td style="width: 130.7pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="174">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">N/A</span>
      </p>
    </td>
  </tr>
  
  <tr style="mso-yfti-irow: 2; height: 13.15pt;">
    <td style="width: 63.55pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt; height: 13.15pt;" rowspan="2" width="85">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">常规</span></strong>
      </p>
    </td>
    
    <td style="width: 5cm; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt; height: 13.15pt;" rowspan="2" width="189">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">--general_log</span>
      </p>
    </td>
    
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt; height: 13.15pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">host_name.log</span>
      </p>
    </td>
    
    <td style="width: 130.7pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt; height: 13.15pt;" rowspan="2" width="174">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">mysqldumpslow</span>
      </p>
      
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">mysqlbinlog</span>
      </p>
    </td>
  </tr>
  
  <tr style="mso-yfti-irow: 3; height: 13.15pt;">
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt; height: 13.15pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">general_log</span>
      </p>
    </td>
  </tr>
  
  <tr style="mso-yfti-irow: 4; height: 17.3pt;">
    <td style="width: 63.55pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt; height: 17.3pt;" rowspan="2" width="85">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">慢速查询</span></strong>
      </p>
    </td>
    
    <td style="width: 5cm; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt; height: 17.3pt;" rowspan="2" width="189">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">--slow_query_log</span>
      </p>
      
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">--long_query_time</span>
      </p>
    </td>
    
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt; height: 17.3pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">host_name-slow.log</span>
      </p>
    </td>
    
    <td style="width: 130.7pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt; height: 17.3pt;" rowspan="2" width="174">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">N/A</span>
      </p>
      
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">程序</span>
      </p>
    </td>
  </tr>
  
  <tr style="mso-yfti-irow: 5; height: 17.3pt;">
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt; height: 17.3pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">slow_log</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 63.55pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" width="85">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">二进制</span></strong>
      </p>
    </td>
    
    <td style="width: 5cm; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="189">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">--log-bin</span>
      </p>
      
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">--expire-logs-days</span>
      </p>
    </td>
    
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">host_name-bin.000001</span>
      </p>
    </td>
    
    <td style="width: 130.7pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; background: #eaf1dd; padding: 0cm 5.4pt;" width="174">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span lang="EN-US">N/A</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 63.55pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #c2d69b; border-bottom-color: #c2d69b; border-left-color: #c2d69b; border-top: none; padding: 0cm 5.4pt;" width="85">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">审计</span></strong>
      </p>
    </td>
    
    <td style="width: 5cm; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="189">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">--audit_log</span>
      </p>
      
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">--audit_log_file</span>
      </p>
    </td>
    
    <td style="width: 186.8pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="249">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">audit.log</span>
      </p>
    </td>
    
    <td style="width: 130.7pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #c2d69b; border-right-width: 1pt; border-right-color: #c2d69b; padding: 0cm 5.4pt;" width="174">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span lang="EN-US">N/A</span>
      </p>
    </td>
  </tr>
</table>

<p style="text-align: left;">
  &nbsp;
</p>

### <span id="162">1.6.2 配置方法</span>

### <span id="i"><span style="font-size: 14px;">状态错误日志：</span></span>

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span>
<span style="color: #ff00ff;">log</span><span style="color: #808080;">-</span>error<span style="color: #808080;">=/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>mysql.<span style="color: #ff00ff;">log</span></pre>
  </div>
</div>

查看配置方式：

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%log%error%</span><span style="color: #ff0000;">'</span>;</pre>
  </div>
</div>

<span style="background-color: #00ff00;">作用：</span>

　　记录mysql数据库的一般状态信息及报错信息，是我们对于数

　据库常规报错处理的常用日志。

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables  <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%log%err%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------+----------------------------------+</span>
<span style="color: #808080;">|</span> Variable_name       <span style="color: #808080;">|</span> Value                            <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------+----------------------------------+</span>
<span style="color: #808080;">|</span> binlog_error_action <span style="color: #808080;">|</span> IGNORE_ERROR                     <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_error           <span style="color: #808080;">|</span> <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>data<span style="color: #808080;">/</span>db02.err <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------+----------------------------------+</span>
<span style="color: #800000; font-weight: bold;">2</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

### <span id="163">1.6.3 一般查询日志</span>

配置方法:

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
general_log</span><span style="color: #808080;">=</span><span style="color: #0000ff;">on</span><span style="color: #000000;">
general_log_file</span><span style="color: #808080;">=/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>server2.<span style="color: #ff00ff;">log</span></pre>
  </div>
</div>

查看配置方式：

<div>
  <div class="cnblogs_code">
    <pre>show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%gen%</span><span style="color: #ff0000;">'</span>;</pre>
  </div>
</div>

作用：

　　记录mysql所有执行成功的SQL语句信息，可以做审计用，但是我们很少开启

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%gen%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------------------------------+</span>
<span style="color: #808080;">|</span> Variable_name    <span style="color: #808080;">|</span> Value                            <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------------------------------+</span>
<span style="color: #808080;">|</span> general_log      <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>                              <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> general_log_file <span style="color: #808080;">|</span> <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>data<span style="color: #808080;">/</span>db02.<span style="color: #ff00ff;">log</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------------------------------+</span>
<span style="color: #800000; font-weight: bold;">2</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

## <span id="17">1.7 二进制日志</span>

　　二进制日志不依赖与存储引擎的。

　　依赖于sql层，记录和sql语句相关的信息

**<span style="background-color: #00ff00;">binlog日志作用：</span>**

&nbsp;&nbsp;　　 1、提供备份功能

&nbsp;&nbsp;　　 2、进行主从复制

&nbsp;　　&nbsp; 3、基于时间点的任意恢复

　　记录在sql层已经执行完成的语句，如果是事务，则记录已完成的事务。

　　功能作用： 时间点备份 和 时间点恢复、 主从

<span style="background-color: #ffff00;"><strong><em><span style="text-decoration: underline;">二进制日志的&ldquo;总闸&rdquo;</span></em></strong></span>

作用：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #800000; font-weight: bold;">1</span><span style="color: #000000;">、是否开启
</span><span style="color: #800000; font-weight: bold;">2</span>、二进制日志路径<span style="color: #808080;">/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>
<span style="color: #800000; font-weight: bold;">3</span>、二进制日志文件名前缀mysql<span style="color: #808080;">-</span><span style="color: #000000;">bin  
</span><span style="color: #800000; font-weight: bold;">4</span>、文件名以"前缀".<span style="color: #800000; font-weight: bold;">000001</span><span style="color: #808080;">~</span><span style="color: #000000;">N
</span><span style="color: #ff00ff;">log</span><span style="color: #808080;">-</span>bin<span style="color: #808080;">=/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>mysql<span style="color: #808080;">-</span>bin  </pre>
  </div>
  
  <p>
    二进制日志的&ldquo;分开关&rdquo;：
  </p>
</div>

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">只有总闸开启才有意义，默认是开启状态。
我们在有些时候会临时关闭掉。
只影响当前会话。
sql_log_bin</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;"></span></pre>
  </div>
</div>

### <span id="171">1.7.1 二进制日志的格式</span>

statement，语句模式：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">记录信息简洁，记录的是SQL语句本身。但是在语句中出现函数操作的话，有可能记录的数据不准确。
</span><span style="color: #800000; font-weight: bold;">5</span>.6中默认模式，但生产环境中慎用，建议改成row。</pre>
  </div>
</div>

row，行模式

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">表中行数据的变化过程。
记录数据详细，对IO性能要求比较高
记录数据在任何情况下都是准确的。
生产中一般是这种模式。
</span><span style="color: #800000; font-weight: bold;">5</span>.7以后默认的模式。</pre>
  </div>
</div>

mixed，混合模式

<div>
  <div class="cnblogs_code">
    <pre>经过判断，选择row<span style="color: #808080;">+</span>statement混合的一种记录模式。（一般不用）</pre>
  </div>
</div>

### <span id="172">1.7.2 开启二进制日志</span>

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%log_bin%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name                   <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------------+-------+</span>
<span style="color: #808080;">|</span> log_bin                         <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_basename                <span style="color: #808080;">|</span>       <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_index                   <span style="color: #808080;">|</span>       <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_trust_function_creators <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_use_v1_row_events       <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>   <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> sql_log_bin                     <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>    <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------------+-------+</span>
<span style="color: #800000; font-weight: bold;">6</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

修改配置文件开启二进制日志

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 tmp</span><span style="color: #ff0000;">]</span># vim <span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span>
<span style="color: #ff00ff;">log</span><span style="color: #808080;">-</span>bin<span style="color: #808080;">=/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">-</span>bin</pre>
  </div>
</div>

_<span style="text-decoration: underline;">命令行修改的方法</span>_

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> <span style="color: #0000ff;">SET</span> GLOBAL binlog_format <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">STATEMENT</span><span style="color: #ff0000;">'</span><span style="color: #000000;">
mysql</span><span style="color: #808080;">></span> <span style="color: #0000ff;">SET</span> GLOBAL binlog_format <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">ROW</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
mysql</span><span style="color: #808080;">></span> <span style="color: #0000ff;">SET</span> GLOBAL binlog_format <span style="color: #808080;">=</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">MIXED</span><span style="color: #ff0000;">'</span>;</pre>
  </div>
</div>

查看文件二进制日志的类型

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span># <span style="color: #0000ff;">file</span> mysql<span style="color: #808080;">-</span>bin.<span style="color: #808080;">*</span><span style="color: #000000;">
mysql</span><span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000001</span>: MySQL <span style="color: #0000ff;">replication</span> <span style="color: #ff00ff;">log</span><span style="color: #000000;">
mysql</span><span style="color: #808080;">-</span>bin.<span style="color: #0000ff;">index</span>:  <span style="color: #ff00ff;">ASCII</span> <span style="color: #0000ff;">text</span></pre>
  </div>
</div>

查看MySQL的配置：

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%log_bin%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------------+-----------------------------------------+</span>
<span style="color: #808080;">|</span> Variable_name                   <span style="color: #808080;">|</span> Value                                   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------------+-----------------------------------------+</span>
<span style="color: #808080;">|</span> log_bin                         <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>                                      <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_basename                <span style="color: #808080;">|</span> <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">-</span>bin       <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_index                   <span style="color: #808080;">|</span> <span style="color: #808080;">/</span>application<span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>data<span style="color: #808080;">/</span>mysql<span style="color: #808080;">-</span>bin.<span style="color: #0000ff;">index</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_trust_function_creators <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>                                     <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_bin_use_v1_row_events       <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>                                     <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> sql_log_bin                     <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>                                      <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------------+-----------------------------------------+</span>
<span style="color: #800000; font-weight: bold;">6</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

### <span id="173">1.7.3 定义记录方式</span>

查看现在的格式

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%format%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------------------+-------------------+</span>
<span style="color: #808080;">|</span> Variable_name            <span style="color: #808080;">|</span> Value             <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------------------+-------------------+</span>
<span style="color: #808080;">|</span> binlog_format            <span style="color: #808080;">|</span> STATEMENT         <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> date_format              <span style="color: #808080;">|</span> <span style="color: #808080;">%</span>Y<span style="color: #808080;">-%</span>m<span style="color: #808080;">-%</span>d          <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> datetime_format          <span style="color: #808080;">|</span> <span style="color: #808080;">%</span>Y<span style="color: #808080;">-%</span>m<span style="color: #808080;">-%</span>d <span style="color: #808080;">%</span>H:<span style="color: #808080;">%</span>i:<span style="color: #808080;">%</span>s <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> default_week_format      <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;"></span>                 <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> innodb_file_format       <span style="color: #808080;">|</span> Antelope          <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> innodb_file_format_check <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>                <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> innodb_file_format_max   <span style="color: #808080;">|</span> Antelope          <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> time_format              <span style="color: #808080;">|</span> <span style="color: #808080;">%</span>H:<span style="color: #808080;">%</span>i:<span style="color: #808080;">%</span>s          <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------------------+-------------------+</span>
<span style="color: #800000; font-weight: bold;">8</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

修改格式

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span># vim <span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">mysqld</span><span style="color: #ff0000;">]</span><span style="color: #000000;">
binlog_format</span><span style="color: #808080;">=</span>row</pre>
  </div>
</div>

改完之后查看

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%format%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------------------+-------------------+</span>
<span style="color: #808080;">|</span> Variable_name            <span style="color: #808080;">|</span> Value             <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------------------+-------------------+</span>
<span style="color: #808080;">|</span> binlog_format            <span style="color: #808080;">|</span> ROW               <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> date_format              <span style="color: #808080;">|</span> <span style="color: #808080;">%</span>Y<span style="color: #808080;">-%</span>m<span style="color: #808080;">-%</span>d          <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> datetime_format          <span style="color: #808080;">|</span> <span style="color: #808080;">%</span>Y<span style="color: #808080;">-%</span>m<span style="color: #808080;">-%</span>d <span style="color: #808080;">%</span>H:<span style="color: #808080;">%</span>i:<span style="color: #808080;">%</span>s <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> default_week_format      <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;"></span>                 <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> innodb_file_format       <span style="color: #808080;">|</span> Antelope          <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> innodb_file_format_check <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>                <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> innodb_file_format_max   <span style="color: #808080;">|</span> Antelope          <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> time_format              <span style="color: #808080;">|</span> <span style="color: #808080;">%</span>H:<span style="color: #808080;">%</span>i:<span style="color: #808080;">%</span>s          <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">------------------------+-------------------+</span>
<span style="color: #800000; font-weight: bold;">8</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

## <span id="18">1.8 二进制日志的操作</span>

### <span id="181">1.8.1 查看</span>

&nbsp; 操作系统层面查看

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span># ll mysql<span style="color: #808080;">-</span>bin.<span style="color: #808080;">*</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql 143 Dec 20 20:17 mysql-bin.000001</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql 120 Dec 20 20:17 mysql-bin.000002</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql  82 Dec 20 20:17 mysql-bin.index</span></pre>
  </div>
</div>

刷新日志

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> flush logs;</pre>
  </div>
</div>

刷新完成后的日志目录

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span># ll mysql<span style="color: #808080;">-</span>bin.<span style="color: #808080;">*</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql 143 Dec 20 20:17 mysql-bin.000001</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql 167 Dec 20 20:24 mysql-bin.000002</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql 120 Dec 20 20:24 mysql-bin.000003</span>
<span style="color: #808080;">-</span>rw<span style="color: #808080;">-</span>rw<span style="color: #008080;">--</span><span style="color: #008080;">-- 1 mysql mysql 123 Dec 20 20:24 mysql-bin.index</span>
<span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span>#</pre>
  </div>
</div>

查看当前使用的二进制日志文件

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span><span style="color: #000000;"> show master status;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------+--------------+------------------+-------------------+</span>
<span style="color: #808080;">|</span> <span style="color: #0000ff;">File</span>             <span style="color: #808080;">|</span> Position <span style="color: #808080;">|</span> Binlog_Do_DB <span style="color: #808080;">|</span> Binlog_Ignore_DB <span style="color: #808080;">|</span> Executed_Gtid_Set <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------+--------------+------------------+-------------------+</span>
<span style="color: #808080;">|</span> mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000003</span> <span style="color: #808080;">|</span>      <span style="color: #800000; font-weight: bold;">120</span> <span style="color: #808080;">|</span>              <span style="color: #808080;">|</span>                  <span style="color: #808080;">|</span>                   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------+--------------+------------------+-------------------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

查看所有的二进制日志文件

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show <span style="color: #0000ff;">binary</span><span style="color: #000000;"> logs;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+-----------+</span>
<span style="color: #808080;">|</span> Log_name         <span style="color: #808080;">|</span> File_size <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+-----------+</span>
<span style="color: #808080;">|</span> mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000001</span> <span style="color: #808080;">|</span>       <span style="color: #800000; font-weight: bold;">143</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000002</span> <span style="color: #808080;">|</span>       <span style="color: #800000; font-weight: bold;">167</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000003</span> <span style="color: #808080;">|</span>       <span style="color: #800000; font-weight: bold;">120</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+-----------+</span>
<span style="color: #800000; font-weight: bold;">3</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)&nbsp;</pre>
  </div>
</div>

### <span id="182">1.8.2 查看二进制日志内容</span>

**_<span style="text-decoration: underline;">名词说明：</span>_**

　　1、events 事件

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 　　　二进制日志如何定义：命令的最小发生单元

　　2、position

&nbsp;&nbsp;　　　　 每个事件在整个二进制文件中想对应的位置号就是position号

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span><span style="color: #000000;"> show master status;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------+--------------+------------------+-------------------+</span>
<span style="color: #808080;">|</span> <span style="color: #0000ff;">File</span>             <span style="color: #808080;">|</span> Position <span style="color: #808080;">|</span> Binlog_Do_DB <span style="color: #808080;">|</span> Binlog_Ignore_DB <span style="color: #808080;">|</span> Executed_Gtid_Set <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------+--------------+------------------+-------------------+</span>
<span style="color: #808080;">|</span> mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000003</span> <span style="color: #808080;">|</span>      <span style="color: #800000; font-weight: bold;">120</span> <span style="color: #808080;">|</span>              <span style="color: #808080;">|</span>                  <span style="color: #808080;">|</span>                   <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">----------------+----------+--------------+------------------+-------------------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span><span style="color: #000000;"> sec)
</span><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span># mysqlbinlog  mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000003</span> <span style="color: #808080;">>/</span>tmp<span style="color: #808080;">/</span>aa.ttt</pre>
  </div>
</div>

导出所有的信息

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 data</span><span style="color: #ff0000;">]</span># mysqlbinlog  mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000003</span> <span style="color: #808080;">>/</span>tmp<span style="color: #808080;">/</span>aa.ttt</pre>
  </div>
</div>

**_<span style="text-decoration: underline;">binlog</span>_****_<span style="text-decoration: underline;">的查看方式：</span>_**

1、查看binlog原始信息

<div>
  <div class="cnblogs_code">
    <pre>mysqbin   mysql<span style="color: #808080;">-</span>bin.<span style="color: #800000; font-weight: bold;">000002</span>  </pre>
  </div>
</div>

2、在row模式下，翻译成语句

<div>
  <div class="cnblogs_code">
    <pre>mysqlbinlog <span style="color: #008080;">--</span><span style="color: #008080;">base64-output='decode-rows' -v   mysql-bin.000002</span></pre>
  </div>
</div>

3、查看binlog事件

<div>
  <div class="cnblogs_code">
    <pre>show <span style="color: #0000ff;">binary</span><span style="color: #000000;"> logs; 所有在使用的binlog信息
show binlog events </span><span style="color: #808080;">in</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">日志文件</span><span style="color: #ff0000;">'</span></pre>
  </div>
</div>

**4****、如何截取binlog****内容，按需求恢复（常规思路）**

<div>
  <p class="a3">
    　　（1）、show binary logs;&nbsp;&nbsp; show master status;
  </p>
  
  <p class="a3">
    　　（2）、show binlog events in '' 从后往前看，找到误操作的事务，判断事务开始position和结束position
  </p>
  
  <p class="a3">
    　　（3）、把误操作的剔除掉，留下正常操作到2个sql文件中
  </p>
  
  <p class="a3">
    　　（4）、先测试库恢复，把误操作的数据导出，然后生产恢复。
  </p>
</div>

<span style="background-color: #ffff00;"><strong>使用上述方法遇到的问题：</strong></span>

<div>
  <p class="ac">
    &nbsp;　　 恢复事件较长
  </p>
  
  <p class="ac">
    &nbsp; 　　　　对生产数据有一定的影响，有可能会出现冗余数据
  </p>
</div>

<span style="background-color: #ffff00;">　<strong>较好的解决方案。</strong></span>

<div>
  <p class="ac">
    　　　　1、flashback闪回功能
  </p>
  
  <p class="ac">
    　　　　2、通过备份，延时从库
  </p>
</div>

### <span id="183_mysqlbinlog">1.8.3 mysqlbinlog截取二进制日志的方法</span>

mysqlbinlog常见的选项有以下几个：

<p style="text-align: center;">
  &nbsp;
</p>

<table class="MsoTable15Grid5DarkAccent1" style="border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 148.6pt; border-top-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-top-color: white; border-bottom-color: white; border-left-color: white; border-right: none; background: #4f81bd; padding: 0cm 5.4pt;" width="198">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 5;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">参数</span></strong>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top-width: 1pt; border-right-width: 1pt; border-bottom-width: 1pt; border-top-color: white; border-right-color: white; border-bottom-color: white; border-left: none; background: #4f81bd; padding: 0cm 5.4pt;" width="499">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 1;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">参数说明</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: white; border-bottom-color: white; border-left-color: white; border-top: none; background: #4f81bd; padding: 0cm 5.4pt;" width="198">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
        <strong><span style="color: white; mso-themecolor: background1;" lang="EN-US">--start-datetime</span></strong>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: white; border-right-width: 1pt; border-right-color: white; background: #b8cce4; padding: 0cm 5.4pt;" width="499">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">从二进制日志中读取指定等于时间戳或者晚于本地计算机的时间</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: white; border-bottom-color: white; border-left-color: white; border-top: none; background: #4f81bd; padding: 0cm 5.4pt;" width="198">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
        <strong><span style="color: white; mso-themecolor: background1;" lang="EN-US">--stop-datetime</span></strong>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: white; border-right-width: 1pt; border-right-color: white; background: #dbe5f1; padding: 0cm 5.4pt;" width="499">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">从二进制日志中读取指定小于时间戳或者等于本地计算机的时间取值和上述一样</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: white; border-bottom-color: white; border-left-color: white; border-top: none; background: #4f81bd; padding: 0cm 5.4pt;" width="198">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 68;">
        <strong><span style="color: white; mso-themecolor: background1;" lang="EN-US">--start-position</span></strong>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: white; border-right-width: 1pt; border-right-color: white; background: #b8cce4; padding: 0cm 5.4pt;" width="499">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 64;">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">从二进制日志中读取指定</span><span lang="EN-US">position </span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">事件位置作为开始。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: white; border-bottom-color: white; border-left-color: white; border-top: none; background: #4f81bd; padding: 0cm 5.4pt;" width="198">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph; mso-yfti-cnfc: 4;">
        <strong><span style="color: white; mso-themecolor: background1;" lang="EN-US">--stop-position</span></strong>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: white; border-right-width: 1pt; border-right-color: white; background: #dbe5f1; padding: 0cm 5.4pt;" width="499">
      <p class="MsoNormal" style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">从二进制日志中读取指定</span><span lang="EN-US">position </span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">事件位置作为事件截至</span>
      </p>
    </td>
  </tr>
</table>

&nbsp; 二进制日志文件示例：&nbsp;&nbsp;<span class="cnblogs_code">mysqlbinlog <span style="color: #008080;">--</span><span style="color: #008080;">start-position=120 --stop-position=结束号 </span></span>&nbsp;

### <span id="184">1.8.4 删除二进制日志</span>

**　　<span style="background-color: #00ff00;">默认情况下，不会删除旧的日志文件。</span>**

根据存在时间删除日志：

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #0000ff;">SET</span> GLOBAL expire_logs_days <span style="color: #808080;">=</span> <span style="color: #800000; font-weight: bold;">7</span><span style="color: #000000;">;
或
PURGE </span><span style="color: #0000ff;">BINARY</span> LOGS BEFORE now() <span style="color: #808080;">-</span> INTERVAL <span style="color: #800000; font-weight: bold;">3</span> <span style="color: #ff00ff;">day</span>;</pre>
  </div>
</div>

根据文件名删除日志：

<div>
  <div class="cnblogs_code">
    <pre>PURGE <span style="color: #0000ff;">BINARY</span> LOGS <span style="color: #0000ff;">TO</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">mysql-bin.000010</span><span style="color: #ff0000;">'</span>;</pre>
  </div>
</div>

&nbsp;&nbsp; 重置二进制日志计数，从1开始计数，删除原有的二进制日志。

<div>
  <div class="cnblogs_code">
    <pre>reset master  </pre>
  </div>
</div>

## <span id="19_mysqlslow_log">1.9 mysql的慢查询日志（slow log）</span>

### <span id="191">1.9.1 这是什么呢？</span>

　　slow-log&nbsp; 记录所有条件内的慢的sql语句

&nbsp;&nbsp;　&nbsp;优化的一种工具日志。能够帮我们定位问题。

### <span id="192">1.9.2 慢查询日志</span>

　　是将mysql服务器中影响数据库性能的相关SQL语句记录到日志文件

　　通过对这些特殊的SQL语句分析，改进以达到提高数据库性能的目的。慢日志设置

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #000000;">long_query_time ： 设定慢查询的阀值，超出次设定值的SQL即被记录到慢查询日志，缺省值为10s
slow_query_log ： 指定是否开启慢查询日志
slow_query_log_file ： 指定慢日志文件存放位置，可以为空，系统会给一个缺省的文件host_name</span><span style="color: #808080;">-</span>slow.<span style="color: #ff00ff;">log</span><span style="color: #000000;">
min_examined_row_limit：查询检查返回少于该参数指定行的SQL不被记录到慢查询日志
log_queries_not_using_indexes: 不使用索引的慢查询日志是否记录到索引</span></pre>
  </div>
</div>

**慢查询日志配置**

<div>
  <div class="cnblogs_code">
    <pre><span style="color: #ff0000;">[</span><span style="color: #ff0000;">root@db02 htdocs</span><span style="color: #ff0000;">]</span># vim <span style="color: #808080;">/</span>etc<span style="color: #808080;">/</span><span style="color: #000000;">my.cnf
slow_query_log</span><span style="color: #808080;">=</span><span style="color: #0000ff;">ON</span><span style="color: #000000;">
slow_query_log_file</span><span style="color: #808080;">=/</span>tmp<span style="color: #808080;">/</span>slow.<span style="color: #ff00ff;">log</span><span style="color: #000000;">
long_query_time</span><span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">0.5</span><span style="color: #000000;">    # 控制慢日志记录的阈值
log_queries_not_using_indexes</span></pre>
  </div>
</div>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 配置完成后重启服务...

查看慢查询日志是否开启，及其位置。

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%slow%</span><span style="color: #ff0000;">'</span>
    <span style="color: #808080;">-></span><span style="color: #000000;"> ;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------+---------------+</span>
<span style="color: #808080;">|</span> Variable_name             <span style="color: #808080;">|</span> Value         <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------+---------------+</span>
<span style="color: #808080;">|</span> log_slow_admin_statements <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>           <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> log_slow_slave_statements <span style="color: #808080;">|</span> <span style="color: #0000ff;">OFF</span>           <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> slow_launch_time          <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;">2</span>             <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> slow_query_log            <span style="color: #808080;">|</span> <span style="color: #0000ff;">ON</span>            <span style="color: #808080;">|</span>
<span style="color: #808080;">|</span> slow_query_log_file       <span style="color: #808080;">|</span> <span style="color: #808080;">/</span>tmp<span style="color: #808080;">/</span>slow.<span style="color: #ff00ff;">log</span> <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------------------+---------------+</span>
<span style="color: #800000; font-weight: bold;">5</span> rows <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

### <span id="193_mysqldumpslow">1.9.3 mysqldumpslow命令</span>

<div>
  <div class="cnblogs_code">
    <pre>　<span style="color: #808080;">/</span>path<span style="color: #808080;">/</span>mysqldumpslow <span style="color: #808080;">-</span>s c <span style="color: #808080;">-</span>t <span style="color: #800000; font-weight: bold;">10</span> <span style="color: #808080;">/</span><span style="color: #0000ff;">database</span><span style="color: #808080;">/</span>mysql<span style="color: #808080;">/</span>slow<span style="color: #808080;">-</span><span style="color: #ff00ff;">log</span></pre>
  </div>
</div>

这会输出记录次数最多的10条SQL语句，其中：

<table class="MsoTable15Grid4Accent1" style="border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 56.45pt; border-top-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-top-color: #4f81bd; border-bottom-color: #4f81bd; border-left-color: #4f81bd; border-right: none; background: #4f81bd; padding: 0cm 5.4pt;" valign="top" width="75">
      <p class="MsoNormal">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">参数</span></strong>
      </p>
    </td>
    
    <td style="width: 466.35pt; border-top-width: 1pt; border-right-width: 1pt; border-bottom-width: 1pt; border-top-color: #4f81bd; border-right-color: #4f81bd; border-bottom-color: #4f81bd; border-left: none; background: #4f81bd; padding: 0cm 5.4pt;" valign="top" width="622">
      <p class="MsoNormal">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; color: white; mso-themecolor: background1;">说明</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 56.45pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #95b3d7; border-bottom-color: #95b3d7; border-left-color: #95b3d7; border-top: none; background: #dbe5f1; padding: 0cm 5.4pt;" valign="top" width="75">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 68;" align="center">
        <strong><span lang="EN-US">-s</span></strong>
      </p>
    </td>
    
    <td style="width: 466.35pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #95b3d7; border-right-width: 1pt; border-right-color: #95b3d7; background: #dbe5f1; padding: 0cm 5.4pt;" valign="top" width="622">
      <p class="MsoNormal">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是表示按照何种方式排序，</span><span lang="EN-US">c</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">、</span><span lang="EN-US">t</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">、</span><span lang="EN-US">l</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">、</span><span lang="EN-US">r</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">分别是按照记录次数、时间、查询</span>
      </p>
      
      <p class="MsoNormal">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">时间、返回的记录数来排序，</span><span lang="EN-US">ac</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">、</span><span lang="EN-US">at</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">、</span><span lang="EN-US">al</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">、</span><span lang="EN-US">ar</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">，表示相应的倒叙；</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 56.45pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #95b3d7; border-bottom-color: #95b3d7; border-left-color: #95b3d7; border-top: none; padding: 0cm 5.4pt;" valign="top" width="75">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 4;" align="center">
        <strong><span lang="EN-US">-t</span></strong>
      </p>
    </td>
    
    <td style="width: 466.35pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #95b3d7; border-right-width: 1pt; border-right-color: #95b3d7; padding: 0cm 5.4pt;" valign="top" width="622">
      <p class="MsoNormal">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">是</span><span lang="EN-US">top n</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">的意思，即为返回前面多少条的数据；</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 56.45pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #95b3d7; border-bottom-color: #95b3d7; border-left-color: #95b3d7; border-top: none; background: #dbe5f1; padding: 0cm 5.4pt;" valign="top" width="75">
      <p class="MsoNormal" style="text-align: center; mso-yfti-cnfc: 68;" align="center">
        <strong><span lang="EN-US">-g</span></strong>
      </p>
    </td>
    
    <td style="width: 466.35pt; border-top: none; border-left: none; border-bottom-width: 1pt; border-bottom-color: #95b3d7; border-right-width: 1pt; border-right-color: #95b3d7; background: #dbe5f1; padding: 0cm 5.4pt;" valign="top" width="622">
      <p class="MsoNormal">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">后边可以写一个正则匹配模式，大小写不敏感的；</span>
      </p>
    </td>
  </tr>
  
  <tr style="mso-yfti-irow: 3; mso-yfti-lastrow: yes; height: 31.7pt;">
    <td style="width: 522.8pt; border-right-width: 1pt; border-bottom-width: 1pt; border-left-width: 1pt; border-right-color: #95b3d7; border-bottom-color: #95b3d7; border-left-color: #95b3d7; border-top: none; padding: 0cm 5.4pt; height: 31.7pt;" colspan="2" valign="top" width="697">
      <p class="MsoNormal">
        <strong><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">例子：</span></strong>
      </p>
      
      <div style="mso-element: para-border-div; border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; mso-border-shadow: yes; background: #F2F2F2; mso-shading: windowtext; mso-pattern: gray-5 auto;">
        <p class="a">
          <span lang="EN-US">/path/mysqldumpslow -s r -t 10 /database/mysql/slow-log</span>
        </p>
      </div>
      
      <p class="MsoNormal">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-bidi-font-weight: bold;">得到返回记录集最多的</span><span lang="EN-US">10</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-bidi-font-weight: bold;">个查询。</span>
      </p>
      
      <div style="mso-element: para-border-div; border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; mso-border-shadow: yes; background: #F2F2F2; mso-shading: windowtext; mso-pattern: gray-5 auto;">
        <p class="a">
          <span lang="EN-US">/path/mysqldumpslow -s t -t 10 -g &ldquo;left </span>
        </p>
        
        <p class="a">
          <span lang="EN-US">join&rdquo;/database/mysql/slow-log</span>
        </p>
      </div>
      
      <p class="MsoNormal">
        <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-bidi-font-weight: bold;">得到按照时间排序的前</span><span lang="EN-US">10</span><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New'; mso-bidi-font-weight: bold;">条里面含有左连接的查询语句。</span>
      </p>
    </td>
  </tr>
</table>

### <span id="194_binlogredolog">1.9.4 怎么保证binlog和redolog已提交事务的一致性</span>

<span>　　在没有开启binlog的时候，在执行commit，认为redo日志持久化到磁盘文件中，commit命令就成功。</span>

写binlog参数：

<div>
  <div class="cnblogs_code">
    <pre>mysql<span style="color: #808080;">></span> show variables <span style="color: #808080;">like</span> <span style="color: #ff0000;">'</span><span style="color: #ff0000;">%sync_binlog%</span><span style="color: #ff0000;">'</span><span style="color: #000000;">;
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> Variable_name <span style="color: #808080;">|</span> Value <span style="color: #808080;">|</span>
<span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #808080;">|</span> sync_binlog   <span style="color: #808080;">|</span> <span style="color: #800000; font-weight: bold;"></span>     <span style="color: #808080;">|</span>    #控制binlog <span style="color: #0000ff;">commit</span><span style="color: #000000;"> 阶段
</span><span style="color: #808080;">+</span><span style="color: #008080;">--</span><span style="color: #008080;">-------------+-------+</span>
<span style="color: #800000; font-weight: bold;">1</span> row <span style="color: #808080;">in</span> <span style="color: #0000ff;">set</span> (<span style="color: #800000; font-weight: bold;">0.00</span> sec)</pre>
  </div>
</div>

&nbsp;&nbsp; sync_binlog 确保是否每个提交的事务都写到binlog中。

### <span id="195_mysql">1.9.5 mysql中的双一标准：</span>

　　innodb\_flush\_log\_at\_trx\_commit和sync\_binlog 两个参数是控制MySQL 磁盘写入策略以及数据安全性的关键参数。

_<span style="text-decoration: underline;">参数意义说明：</span>_

<div>
  <div class="cnblogs_code">
    <pre>innodb_flush_log_at_trx_commit<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span></pre>
  </div>
</div>

　　如果innodb\_flush\_log\_at\_trx_commit设置为0，log buffer将每秒一次地写入log file中，并且log file的flush(刷到磁盘)操作同时进行.该模式下，在事务提交的时候，不会主动触发写入磁盘的操作。

　　如果innodb\_flush\_log\_at\_trx_commit设置为1，每次事务提交时MySQL都会把log buffer的数据写入log file，并且flush(刷到磁盘)中去.

　　如果innodb\_flush\_log\_at\_trx_commit设置为2，每次事务提交时MySQL都会把log buffer的数据写入log file.但是flush(刷到磁盘)操作并不会同时进行。该模式下,MySQL会每秒执行一次 flush(刷到磁盘)操作。

**注意：**

<div>
  <div class="cnblogs_code">
    <pre>由于进程调度策略问题,这个&ldquo;每秒执行一次 flush(刷到磁盘)操作&rdquo;并不是保证100<span style="color: #808080;">%</span>的&ldquo;每秒&rdquo;。</pre>
  </div>
</div>

<span style="background-color: #00ff00;"><em><span style="text-decoration: underline;">参数意义说明：</span></em></span>

<div>
  <p class="ac">
    &nbsp;　　<span class="cnblogs_code">sync_binlog<span style="color: #808080;">=</span><span style="color: #800000; font-weight: bold;">1</span></span>&nbsp;
  </p>
</div>

　　sync_binlog 的默认值是0，像操作系统刷其他文件的机制一样，MySQL不会同步到磁盘中去而是依赖操作系统来刷新binary log。

　　当sync_binlog =N (N>0) ，MySQL 在每写 N次 二进制日志binary log时，会使用fdatasync()函数将它的写二进制日志binary log同步到磁盘中去。

**注:**

<div>
  <p class="a3">
    　　如果启用了autocommit，那么每一个语句statement就会有一次写操作；否则每个事务对应一个写操作。
  </p>
</div>

<span style="color: #ff0000;"><strong>安全方面说明</strong></span>

　　当innodb\_flush\_log\_at\_trx\_commit和sync\_binlog 都为 1 时是最安全的，在mysqld 服务崩溃或者服务器主机crash的情况下，binary log 只有可能丢失最多一个语句或者一个事务。但是鱼与熊掌不可兼得，双11 会导致频繁的io操作，因此该模式也是最慢的一种方式。

　　当innodb\_flush\_log\_at\_trx_commit设置为0，mysqld进程的崩溃会导致上一秒钟所有事务数据的丢失。

　　当innodb\_flush\_log\_at\_trx_commit设置为2，只有在操作系统崩溃或者系统掉电的情况下，上一秒钟所有事务数据才可能丢失。

　　双1适合数据安全性要求非常高，而且磁盘IO写能力足够支持业务，比如订单,交易,充值,支付消费系统。双1模式下，当磁盘IO无法满足业务需求时 比如11.11 活动的压力。推荐的做法是 innodb\_flush\_log\_at\_trx\_commit=2 ，sync\_binlog=N (N为500 或1000) 且使用带蓄电池后备电源的缓存cache，防止系统断电异常。

　　系统性能和数据安全是业务系统高可用稳定的必要因素。我们对系统的优化需要寻找一个平衡点，合适的才是最好的，根据不同的业务场景需求，可以将两个参数做组合调整，以便是db系统的性能达到最优化。

## <span id="110">1.10 参考文献</span>

<div>
  <div class="cnblogs_code">
    <pre>https:<span style="color: #808080;">//</span>www.cnblogs.com<span style="color: #808080;">/</span>wangdake<span style="color: #808080;">-</span>qq<span style="color: #808080;">/</span>p<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">7358322</span><span style="color: #000000;">.html
http:</span><span style="color: #808080;">//</span>www.jb51.net<span style="color: #808080;">/</span>article<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">87653</span><span style="color: #000000;">.htm
http:</span><span style="color: #808080;">//</span>www.mysqlops.com<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">2012</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">04</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">06</span><span style="color: #808080;">/</span>innodb<span style="color: #808080;">-</span><span style="color: #000000;">log1.html
https:</span><span style="color: #808080;">//</span>www.cnblogs.com<span style="color: #808080;">/</span>Bozh<span style="color: #808080;">/</span>archive<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">2013</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">03</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">18</span><span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">2966494</span><span style="color: #000000;">.html
https:</span><span style="color: #808080;">//</span>www.cnblogs.com<span style="color: #808080;">/</span>andy6<span style="color: #808080;">/</span>p<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">6626848</span><span style="color: #000000;">.html
https:</span><span style="color: #808080;">//</span>www.cnblogs.com<span style="color: #808080;">/</span>xuanzhi201111<span style="color: #808080;">/</span>p<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">4128894</span>.html  Anemometer实现pt<span style="color: #808080;">-</span>query<span style="color: #808080;">-</span><span style="color: #000000;">digest 图形化
http:</span><span style="color: #808080;">//</span>www.coooz.com<span style="color: #808080;">/</span>archives<span style="color: #808080;">/</span><span style="color: #800000; font-weight: bold;">771</span>         双一标准</pre>
  </div>
  
  <p>
    &nbsp;
  </p>
</div>

&nbsp;

<div id="toc_container" class="toc_white have_bullets">
  <ul class="toc_list">
    <li>
      <a href="#11">1.1 存储引擎的介绍</a><ul>
        <li>
          <a href="#111">1.1.1 文件系统存储</a>
        </li>
        <li>
          <a href="#112_mysql">1.1.2 mysql数据库存储</a>
        </li>
        <li>
          <a href="#113_MySQL">1.1.3 MySQL存储引擎种类</a>
        </li>
        <li>
          <a href="#114_innodbmyisam">1.1.4 innodb与myisam对比</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#12_innodb">1.2 innodb存储引擎</a><ul>
        <li>
          <a href="#121_Innodb">1.2.1 Innodb引擎的优点</a>
        </li>
        <li>
          <a href="#122_Innodb">1.2.2 Innodb功能总览</a>
        </li>
        <li>
          <a href="#123">1.2.3 查询存储引擎的方法</a>
        </li>
        <li>
          <a href="#124">1.2.4 设置存储引擎</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#13_InnoDB">1.3 InnoDB存储引擎的存储结构</a><ul>
        <li>
          <a href="#131_InnoDB">1.3.1 InnoDB 系统表空间特性</a>
        </li>
        <li>
          <a href="#132">1.3.2 表空间的定义</a>
        </li>
        <li>
          <a href="#133">1.3.3 表空间类型</a>
        </li>
        <li>
          <a href="#134">1.3.4 系统表空间的存储内容</a>
        </li>
        <li>
          <a href="#135">1.3.5 设置共享表空间</a>
        </li>
        <li>
          <a href="#136">1.3.6 设置独立表空间</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#14_MySQL">1.4 MySQL中的事务</a><ul>
        <li>
          <a href="#141">1.4.1 事务是什么</a>
        </li>
        <li>
          <a href="#142">1.4.2 事务的控制语句</a>
        </li>
        <li>
          <a href="#143_autocommit">1.4.3 autocommit参数</a>
        </li>
        <li>
          <a href="#144">1.4.4 导致提交的非事务语句：</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#15_redoundo">1.5 redo与undo</a><ul>
        <li>
          <a href="#151_undo">1.5.1 事务日志undo</a>
        </li>
        <li>
          <a href="#152_redo">1.5.2 事务日志redo</a>
        </li>
        <li>
          <a href="#153">1.5.3 事务中的锁</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#16_MySQL">1.6 MySQL 日志管理</a><ul>
        <li>
          <a href="#161_MySQL">1.6.1 MySQL日志类型简介</a>
        </li>
        <li>
          <a href="#162">1.6.2 配置方法</a>
        </li>
        <li>
          <a href="#i">状态错误日志：</a>
        </li>
        <li>
          <a href="#163">1.6.3 一般查询日志</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#17">1.7 二进制日志</a><ul>
        <li>
          <a href="#171">1.7.1 二进制日志的格式</a>
        </li>
        <li>
          <a href="#172">1.7.2 开启二进制日志</a>
        </li>
        <li>
          <a href="#173">1.7.3 定义记录方式</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#18">1.8 二进制日志的操作</a><ul>
        <li>
          <a href="#181">1.8.1 查看</a>
        </li>
        <li>
          <a href="#182">1.8.2 查看二进制日志内容</a>
        </li>
        <li>
          <a href="#183_mysqlbinlog">1.8.3 mysqlbinlog截取二进制日志的方法</a>
        </li>
        <li>
          <a href="#184">1.8.4 删除二进制日志</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#19_mysqlslow_log">1.9 mysql的慢查询日志（slow log）</a><ul>
        <li>
          <a href="#191">1.9.1 这是什么呢？</a>
        </li>
        <li>
          <a href="#192">1.9.2 慢查询日志</a>
        </li>
        <li>
          <a href="#193_mysqldumpslow">1.9.3 mysqldumpslow命令</a>
        </li>
        <li>
          <a href="#194_binlogredolog">1.9.4 怎么保证binlog和redolog已提交事务的一致性</a>
        </li>
        <li>
          <a href="#195_mysql">1.9.5 mysql中的双一标准：</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#110">1.10 参考文献</a>
    </li>
  </ul>
</div>