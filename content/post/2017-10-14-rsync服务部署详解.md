---
title: rsync 服务部署详解
author: 惨绿少年
type: post
date: 2017-10-14T03:40:00+00:00
url: /clsn/lx920.html
Baidusubmit:
  - 1
views:
  - 124
zm_favorites:
  - 1
categories:
  - Linux运维
  - 存储
  - 自动化
  - 运维基本功

---
# <span id="1_rsync">第1章 rsync <span style="font-family: '微软雅黑',sans-serif;">软件介绍</span></span>

## <span id="11_rsync">1.1 <span style="font-family: '微软雅黑',sans-serif;">什么是</span>rsync</span>

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  rsync <span style="font-family: '微软雅黑',sans-serif;">是一款开源的、快速的、多功能的、可实现<span style="background: yellow;">全量及增量的本地或远程数据同步备份</span>的优秀工具。</span>
</p>

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  http://www.samba.org/ftp/rsync/rsync.html
</p>

### <span id="111">1.1.1 <span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">全量及增量</span></span>

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">全量：将全部数据，进行传输覆盖</span>
</p>

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">增量：只传输差异部分的数据</span>
</p>

## <span id="12">1.2 <span style="font-family: '微软雅黑',sans-serif;">实现增量复制的原理</span></span>

<p style="text-indent: 21.0pt;">
  Rsync<span style="font-family: '微软雅黑',sans-serif;">通过其独特的</span>&ldquo;quick check&rdquo;<span style="font-family: '微软雅黑',sans-serif;">算法，实现增量传输数据</span>
</p>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;">man rsync</span>
Rsync  finds  files  that  need  to  be transferred using a &ldquo;quick check&rdquo; algorithm (by default)  that  looks  <span style="color: #0000ff;">for</span>  files  that  have changed  <span style="color: #0000ff;">in</span>  size  <span style="color: #0000ff;">or</span>  <span style="color: #0000ff;">in</span>  last-modified time.  Any changes <span style="color: #0000ff;">in</span> the other preserved attributes (as requested by options) are  made  on the  destination file directly when the quick check indicates that the file&rsquo;s data does <span style="color: #0000ff;">not</span> need to be updated.</pre>
</div>

<p style="text-indent: 21.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">在同步备份数据时，默认情况下，</span>Rsync<span style="font-family: '微软雅黑',sans-serif;">通过其独特的</span>&ldquo;quick check&rdquo;<span style="font-family: '微软雅黑',sans-serif;">算法，它仅同步大小或者最后修改时间发生变化的文件或目录，当然也可根据权限，属主等属性的变化同步，但需要指定相应的参数，甚至可以实现只同步一个文件里有变化的内容部分，所以，可以实现快速的同步备份数据。</span>
</p>

> <p style="text-indent: 21.0pt;">
>   &nbsp;centos 5 rsync 2.x&nbsp;先比对再同步，速度较慢
> </p>
> 
> <p style="text-indent: 21.0pt;">
>   &nbsp;centos 6 rsync 3.x&nbsp;一边比对，一边对差异部分进行同步
> </p>

### <span id="121">1.2.1 <span style="font-family: '微软雅黑',sans-serif;">软件版本</span></span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync --version</span>
rsync  version 3.0.6  protocol version 30<span style="color: #000000;">
Copyright (C) </span>1996-2009 by Andrew Tridgell, Wayne Davison, <span style="color: #0000ff;">and</span><span style="color: #000000;"> others.
Web site: http:</span>//rsync.samba.org/<span style="color: #000000;">
Capabilities:
    </span>64-bit files, 64-bit inums, 64-bit timestamps, 64-<span style="color: #000000;">bit long ints,
    socketpairs, hardlinks, symlinks, IPv6, batchfiles, inplace,
    append, ACLs, xattrs, iconv, symtimes
rsync comes with ABSOLUTELY NO WARRANTY.  This </span><span style="color: #0000ff;">is</span> free software, <span style="color: #0000ff;">and</span><span style="color: #000000;"> you
are welcome to redistribute it under certain conditions.  See the GNU
General Public Licence </span><span style="color: #0000ff;">for</span> details.</pre>
</div>

## <span id="13_rsync_nbsp">1.3 rsync <span style="font-family: '微软雅黑',sans-serif;">软件功能介绍</span>&nbsp;</span>

> 类似于&nbsp;cp&nbsp;命令&nbsp;--&nbsp;实现本地备份传输数据
> 
> 类似于scp&nbsp;命令&nbsp;--&nbsp;远程备份传输数据
> 
> 类似于&nbsp;rm&nbsp;命令&nbsp;--&nbsp;实现无差异同步备份
> 
> 类似于&nbsp;ls&nbsp;命令&nbsp;--&nbsp;本地文件信息查看

rsync <span style="font-family: '微软雅黑',sans-serif;">命令属于</span>1 v 4 <span style="font-family: '微软雅黑',sans-serif;">的命令</span>

### <span id="131_rsync_cp">1.3.1 rsync == cp</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cp -a  /etc/hosts /tmp/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/</span>
<span style="color: #000000;">hosts
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> \rm /tmp/hosts</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync  /etc/hosts /tmp/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/hosts</span>
/tmp/hosts</pre>
</div>

### <span id="132_rsync_scp">1.3.2 rsync == scp</span>

<span style="background: yellow;">#</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">使用</span><span style="background: yellow;">scp</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">实现</span>

<p style="text-indent: 15.75pt;">
  #<span style="font-family: '微软雅黑',sans-serif;">检查对端服务器目标位置上是否有该文件</span>
</p>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/hosts</span>
ls: cannot access /tmp/hosts: No such file <span style="color: #0000ff;">or</span> directory</pre>
</div>

<p style="text-indent: 15.75pt;">
  #<span style="font-family: '微软雅黑',sans-serif;">从本地拷贝到远端服务器上</span>
</p>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/hosts</span>
/tmp/<span style="color: #000000;">hosts
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> scp -rp /etc/hosts 10.0.0.31:/tmp/</span>
The authenticity of host <span style="color: #800000;">'</span><span style="color: #800000;">10.0.0.31 (10.0.0.31)</span><span style="color: #800000;">'</span> can<span style="color: #800000;">'</span><span style="color: #800000;">t be established.</span>
RSA key fingerprint <span style="color: #0000ff;">is</span> d3:41:bb:0d:43:88:da:a3:2c:e8:36:91:11<span style="color: #000000;">:c9:e4:9c.
Are you sure you want to </span><span style="color: #0000ff;">continue</span> connecting (yes/<span style="color: #000000;">no)? yes
Warning: Permanently added </span><span style="color: #800000;">'</span><span style="color: #800000;">10.0.0.31</span><span style="color: #800000;">'</span><span style="color: #000000;"> (RSA) to the list of known hosts.
root@</span>10.0.0.31<span style="color: #800000;">'</span><span style="color: #800000;">s password:</span>
hosts                                           100%  357     0.4KB/s   00:00</pre>
</div>

<p style="text-indent: 15.75pt;">
  #<span style="font-family: '微软雅黑',sans-serif;">检查远端服务器上的结果</span>
</p>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/hosts</span>
/tmp/hosts</pre>
</div>

<span style="background: yellow;">#</span><span style="font-family: 微软雅黑, sans-serif; background: yellow;">使用</span><span style="background: yellow;">rsync </span><span style="font-family: 微软雅黑, sans-serif; background: yellow;">实现</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -rp /etc/hosts 10.0.0.31:/tmp/</span>
root@10.0.0.31<span style="color: #800000;">'</span><span style="color: #800000;">s password:</span>
[root@backup ~]<span style="color: #008000;">#
</span>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/hosts</span>
/tmp/hosts</pre>
</div>

### <span id="133_rsync_rm">1.3.3 rsync == rm</span>

#### <span id="1331nbsp">1.3.3.1&nbsp;<span style="font-family: '微软雅黑',sans-serif;">环境准备</span></span>

<span style="font-family: '微软雅黑',sans-serif;">创建出来一次命令</span> <span style="font-family: '微软雅黑',sans-serif;">进行操作</span>

<div class="cnblogs_code">
  <pre> [root@backup tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir /znix</span>
[root@backup znix]<span style="color: #008000;">#</span><span style="color: #008000;"> cp /tmp/* .</span>
[root@backup znix]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 4
-rw-r--r-- 1 root root 357 Oct 11 15:21 hosts</pre>
</div>

#rm<span style="font-family: '微软雅黑',sans-serif;">命令操作</span>

<div class="cnblogs_code">
  <pre>[root@backup znix]<span style="color: #008000;">#</span><span style="color: #008000;"> rm -rf /znix/hosts</span>
[root@backup znix]<span style="color: #008000;">#</span><span style="color: #008000;"> ll /znix/hosts</span>
ls: cannot access /znix/hosts: No such file <span style="color: #0000ff;">or</span> directory</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">查看这文件</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> l</span>
total 4
-rw-r--r-- 1 root root 357 Oct 11 15:21 hosts</pre>
</div>

<p style="margin-left: 7.1pt;">
  <span style="font-family: '微软雅黑',sans-serif;">创建一个空目录，使用空目录进行<span style="background: yellow;">无差异同步</span></span>
</p>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir /null</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync --delete  /null/ /znix/</span>
rsync: --delete does <span style="color: #0000ff;">not</span> work without -r <span style="color: #0000ff;">or</span> -<span style="color: #000000;">d.
rsync error: syntax </span><span style="color: #0000ff;">or</span> usage error (code 1) at main.c(1422) [client=3.0.6<span style="color: #000000;">]
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync  -a  --delete  /null/ /znix/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ll /znix/</span>
total 0</pre>
</div>

### <span id="134_rsync_ls_-l">1.3.4 rsync == ls -l</span>

<p style="margin-left: 7.1pt;">
  <span style="font-family: '微软雅黑',sans-serif;">使用</span>rsync <span style="font-family: '微软雅黑',sans-serif;">可以实现与</span> ls <span style="font-family: '微软雅黑',sans-serif;">类似的功能</span>
</p>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls -l install.log</span>
-rw-r--r--. 1 root root 21736 Sep 25 08:38<span style="color: #000000;"> install.log
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync install.log</span>
-rw-r--r--       21736 2017/09/25 08:38:28 install.log</pre>
</div>

## <span id="14_Rsync7">1.4 Rsync<span style="font-family: '微软雅黑',sans-serif;">的特性总结（</span><span style="background: yellow;">7</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; background: yellow;">个特性信息说明</span><span style="font-family: '微软雅黑',sans-serif;">）</span></span>

<div class="cnblogs_code">
  <pre>01<span style="color: #000000;">. 支持拷贝普通文件与特殊文件如链接文件，设备等。
</span>02<span style="color: #000000;">. 可以有排除指定文件或目录同步的功能，相当于打包命令tar的排除功能。
    </span><span style="color: #008000;">#</span><span style="color: #008000;">tar zcvf backup_1.tar.gz  /opt/data  -exclude=clsn   </span>
    说明：在打包/opt/<span style="color: #000000;">data时就排除了clsn命名的目录和文件。
</span>03. 可以做到保持原文件或目录的权限、时间、软硬链接、属主、组等所有属性均不改变-<span style="color: #000000;">p。
</span>04. 可实现增量同步，既只同步发生变化的数据，因此数据传输效率很高（tar -<span style="color: #000000;">N）。
    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 将备份/home 目录自 2008-01-29 以来修改过的文件</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> tar -N 2008-01-29 -zcvf /backups/inc-backup_$(date +%F).tar.gz /home</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 将备份 /home 目录昨天以来修改过的文件</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> tar -N $(date -d yesterday "+%F") -zcvf /backups/inc-backup_$(date +%F).tar.gz /home</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> 添加文件到已经打包的文件</span>
    <span style="color: #008000;">#</span><span style="color: #008000;"> tar -rf all.tar *.gif</span>
    说明：这条命令是将所有.gif的文件增加到all.tar的包里面去。-<span style="color: #000000;">r是表示增加文件的意思。
</span>05<span style="color: #000000;">. 可以使用rcp,rsh,ssh等方式来配合进行隧道加密传输文件（rsync本身不对数据加密）
</span>06. 可以通过socket(进程方式)传输文件和数据（服务端和客户端）*****<span style="color: #000000;">。重点掌握
</span>07. 支持匿名的或认证（无需系统用户）的进程模式传输，可实现方便安全的进行数据备份及镜像。</pre>
</div>

## <span id="15_Rsync">1.5 Rsync<span style="font-family: '微软雅黑',sans-serif;">的企业工作场景说明</span></span>

> <span style="background-color: initial;">01.&nbsp;两台服务器之间数据同步（定时任务cron+rsync）</span>
> 
> &nbsp;&nbsp;&nbsp;&nbsp;同步网站内部人员数据信息（定时任务最小周期为1分钟）
> 
> 02.&nbsp;两台服务器之间数据同步（实时任务inotify/sersync/lrsyncd+rsync）
> 
> &nbsp;&nbsp;&nbsp;&nbsp;同步网站用户人员数据信息

# <span id="2_rsync">第2章 rsync<span style="font-family: '微软雅黑',sans-serif;">使用方式</span></span>

## <span id="21_rsync">2.1 rsync<span style="font-family: '微软雅黑',sans-serif;">软件工作方式</span></span>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">SYNOPSIS
        本地数据同步方式
       Local:  rsync [OPTION...] SRC... [DEST]
        远程数据同步方式
       Access via remote shell:
         Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]
         Push: rsync [OPTION...] SRC... [USER@]HOST:DEST
        守护进程方式同步数据
       Access via rsync daemon:
         Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]
               rsync [OPTION...] rsync:</span>//[USER@]HOST[:PORT]/<span style="color: #000000;">SRC... [DEST]
         Push: rsync [OPTION...] SRC... [USER@]HOST::DEST
               rsync [OPTION...] SRC... rsync:</span>//[USER@]HOST[:PORT]/DEST</pre>
</div>

### <span id="211_cp">2.1.1 <span style="font-family: '微软雅黑',sans-serif;">本地数据同步方式（类似于</span>cp<span style="font-family: '微软雅黑',sans-serif;">）</span></span>

<div class="cnblogs_code">
  <pre>Local:  rsync [OPTION...] SRC... [DEST]</pre>
</div>

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 148.85pt; border-top: 1pt solid #9bbb59; border-bottom: 1pt solid #9bbb59; border-left: 1pt solid #9bbb59; border-right: none; background: #9bbb59; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: white;">参数</span></strong>
      </p>
    </td>
    
    <td style="width: 219.7pt; border-top: 1pt solid #9bbb59; border-right: 1pt solid #9bbb59; border-bottom: 1pt solid #9bbb59; border-left: none; background: #9bbb59; padding: 0cm 5.4pt;" valign="top" width="293">
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: white;">含义</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.85pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        <strong>rsync&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 219.7pt; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; background: #EAF1DD; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="293">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">数据同步命令</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.85pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        <strong>[OPTION...]&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 219.7pt; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="293">
      <p>
        rsync<span style="font-family: '微软雅黑',sans-serif;">命令参数信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.85pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        <strong>SRC&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 219.7pt; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; background: #EAF1DD; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="293">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">要同不得数据信息（文件或目录）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.85pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        <strong>[DEST]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 219.7pt; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="293">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">将数据传输到什么位置</span>
      </p>
    </td>
  </tr>
</table>

#### <span id="2111nbspnbspnbsp">2.1.1.1&nbsp;<span style="font-family: '微软雅黑',sans-serif;">实例演示命令：</span>&nbsp;&nbsp;</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync  /etc/hosts /tmp/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ls /tmp/hosts</span>
/tmp/hosts</pre>
</div>

### <span id="212_scp">2.1.2 <span style="font-family: '微软雅黑',sans-serif;">远程数据同步方式（类似</span>scp<span style="font-family: '微软雅黑',sans-serif;">）</span>---<span style="font-family: '微软雅黑',sans-serif;">又称为隧道传输</span></span>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">Access via remote shell:
  Pull: rsync [OPTION...] [USER@]HOST:SRC... [DEST]
  Push: rsync [OPTION...] SRC... [USER@]HOST:DEST</span></pre>
</div>

<p style="text-indent: 15.75pt;">
  <span style="font-family: '微软雅黑',sans-serif;">说明：需要进行交互传输数据。如果想实现免交互传输数据，需要借助</span>ssh+key<span style="font-family: '微软雅黑',sans-serif;">方式实现</span>
</p>

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 410.85pt; border-width: 1pt; border-style: solid; border-color: #9bbb59; background: #92d050; padding: 0cm 5.4pt;" colspan="2" valign="top" width="548">
      <p>
        <strong><span style="color: white;">pull</span></strong><strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: white;">：</span> </strong><strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: white;">拉：</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" valign="top" width="208">
      <p>
        <strong>[USER@] </strong><strong><span style="font-family: '微软雅黑',sans-serif;">：</span></strong>
      </p>
    </td>
    
    <td style="width: 9.0cm; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; background: #EAF1DD; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="340">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">以什么用户身份传输数据信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; padding: 0cm 5.4pt;" valign="top" width="208">
      <p>
        <strong>HOST:&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 9.0cm; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="340">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">远程主机信息（</span>IP<span style="font-family: '微软雅黑',sans-serif;">地址信息</span> <span style="font-family: '微软雅黑',sans-serif;">主机名称信息）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" valign="top" width="208">
      <p>
        <strong>SRC:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 9.0cm; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; background: #EAF1DD; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="340">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">远端要恏过来的数据信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; padding: 0cm 5.4pt;" valign="top" width="208">
      <p>
        <strong>[dest]&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 9.0cm; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="340">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">恏到本地什么位置</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 410.85pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; background: #92d050; padding: 0cm 5.4pt;" colspan="2" valign="top" width="548">
      <p>
        <strong><span style="color: white;">push</span></strong><strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: white;">：推：</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; padding: 0cm 5.4pt;" valign="top" width="208">
      <p>
        <strong>SRC</strong><strong><span style="font-family: '微软雅黑',sans-serif;">：</span>&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 9.0cm; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="340">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">本地要怼过去的数据信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid #c2d69b; border-bottom: 1pt solid #c2d69b; border-left: 1pt solid #c2d69b; border-top: none; background: #eaf1dd; padding: 0cm 5.4pt;" valign="top" width="208">
      <p>
        <strong>DEST&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 9.0cm; border-top: none; border-left: none; border-bottom: solid #C2D69B 1.0pt; border-right: solid #C2D69B 1.0pt; background: #EAF1DD; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="340">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">怼到远端什么位置</span>
      </p>
    </td>
  </tr>
</table>

### <span id="213_pull">2.1.3 <span style="font-family: '微软雅黑',sans-serif;">【实践操作】</span>pull <span style="font-family: '微软雅黑',sans-serif;">拉</span></span>

<p style="margin-left: 7.1pt;">
  <span style="font-family: '微软雅黑',sans-serif;">从远端拉文件到当前目录</span>
</p>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> touch /tmp/1.txt</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync nfs01:/tmp/1.txt .</span>
root@nfs01<span style="color: #800000;">'</span><span style="color: #800000;">s password:</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 44
-rw-r--r--  1 root root     0 Oct 11 16:16 1.txt</pre>
</div>

### <span id="214_push">2.1.4 <span style="font-family: '微软雅黑',sans-serif;">【实践操作】</span>push <span style="font-family: '微软雅黑',sans-serif;">推</span> <span style="font-family: '微软雅黑',sans-serif;">（目录）</span></span>

<p style="margin-left: 7.1pt;">
  <span style="font-family: '微软雅黑',sans-serif;">将本地的</span>hosts<span style="font-family: '微软雅黑',sans-serif;">文件推到远端服务器上</span>
</p>

<div class="cnblogs_code">
  <pre>[root@backup tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 4
-rw-r--r-- 1 root root 357 Oct 11 15:12 hosts</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">使用</span>push<span style="font-family: '微软雅黑',sans-serif;">的格式</span> <span style="font-family: '微软雅黑',sans-serif;">推整个目录（包括目录）</span>

<div class="cnblogs_code">
  <pre>[root@backup tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -r /tmp nfs01:/tmp/</span>
root@nfs01<span style="color: #800000;">'</span><span style="color: #800000;">s password:</span>
[root@nfs01 tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 4<span style="color: #000000;">
drwxr</span>-xr-x 3 root root 4096 Oct 11 16:20 tmp</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">推整个目录下的文件（不包括目录本身）</span>

<div class="cnblogs_code">
  <pre>[root@backup tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -r /tmp/ nfs01:/tmp/</span>
root@nfs01<span style="color: #800000;">'</span><span style="color: #800000;">s password:</span>
[root@nfs01 tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 8
-rw-r--r-- 1 root root  357 Oct 11 16:21<span style="color: #000000;"> hosts
drwxr</span>-xr-x 3 root root 4096 Oct 11 16:20 tmp</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">说明：</span>

> /tmp&nbsp;&nbsp; --表示将tmp目录本身及目录下的内容进行传输
> 
> /tmp/&nbsp; --表示只传输tmp目录下面的内容信息

## <span id="22"><span style="courier new"4courier new";background: yellow;">2.2 </span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; background: yellow;">守护进程方式同步数据</span></span>

<div class="cnblogs_code">
  <pre>[root@localhost ~]<span style="color: #008000;">#</span><span style="color: #008000;"> uname -a</span>
Linux 2.6.32-696.el6.x86_64 <span style="color: #008000;">#</span><span style="color: #008000;">1 SMP Tue Mar 21 19:29:05 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span>
<span style="color: #000000;">Access via rsync daemon:
Pull: rsync [OPTION...] [USER@]HOST::SRC... [DEST]
      rsync [OPTION...] rsync:</span>//[USER@]HOST[:PORT]/<span style="color: #000000;">SRC... [DEST]
Push: rsync [OPTION...] SRC... [USER@]HOST::DEST
      rsync [OPTION...] SRC... rsync:</span>//[USER@]HOST[:PORT]/DEST</pre>
</div>

### <span id="221_rsync">2.2.1 <span style="font-family: '微软雅黑',sans-serif;">配置</span>rsync<span style="font-family: '微软雅黑',sans-serif;">守护进程方式（需要有服务端与客户端）</span></span>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">规划：</span>

> &nbsp; &nbsp;1、backup服务器作为rsync服务端
> 
> &nbsp;&nbsp;&nbsp; 2、以rysnc客户端作为参照物，将数据推到rsync服务器上

### <span id="222_rsync_backup">2.2.2 <span style="font-family: '微软雅黑',sans-serif;">配置</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务端（将服务端配置到</span> backup <span style="font-family: '微软雅黑',sans-serif;">服务器上）</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">软件是否存在</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpm -qa |grep rsync</span>
rsync-3.0.6-12.el6.x86_64</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">进行软件服务配置</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/rsyncd.conf</span>
uid =<span style="color: #000000;"> rsync
gid </span>=<span style="color: #000000;"> rsync
use chroot </span>=<span style="color: #000000;"> no
max connections </span>= 200<span style="color: #000000;">
timeout </span>= 300<span style="color: #000000;">
pid file </span>= /var/run/<span style="color: #000000;">rsyncd.pid
lock file </span>= /var/run/<span style="color: #000000;">rsync.lock
log file </span>= /var/log/<span style="color: #000000;">rsyncd.log
ignore errors
read only </span>=<span style="color: #000000;"> false
list </span>=<span style="color: #000000;"> false
hosts allow </span>= 172.16.1.0/24<span style="color: #000000;">
hosts deny </span>= 0.0.0.0/32<span style="color: #000000;">
auth users </span>=<span style="color: #000000;"> rsync_backup
secrets file </span>= /etc/<span style="color: #000000;">rsync.password
[backup]
comment </span>= <span style="color: #800000;">"</span><span style="color: #800000;">backup dir by clsn</span><span style="color: #800000;">"</span><span style="color: #000000;">
path </span>= /backup</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三个里程：创建</span>rsync<span style="font-family: '微软雅黑',sans-serif;">用户</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> id rsync</span>
<span style="color: #000000;">id: rsync: No such user
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> useradd -s /sbin/nologin -M rsync</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第四个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">创建数据备份储存目录</span>,<span style="font-family: '微软雅黑',sans-serif;">目录修改属主</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir /backup/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> chown -R rsync.rsync /backup/</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第五个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">创建认证用户密码文件</span>

<div class="cnblogs_code">
  <pre>echo <span style="color: #800000;">"</span><span style="color: #800000;">rsync_backup:clsn123</span><span style="color: #800000;">"</span> >>/etc/<span style="color: #000000;">rsync.password
chmod </span>600 /etc/rsync.password</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第六个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">启动</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服</span>

<div class="cnblogs_code">
  <pre>rsync --daemon</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">至此服务端配置完成</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ps -ef |grep rsync</span>
root       2076      1  0 17:05 ?        00:00:00 rsync --<span style="color: #000000;">daemon
root       </span>2163   1817  0 17:38 pts/1    00:00:00 grep --color=<span style="color: #000000;">auto rsync
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> netstat -lntup |grep rsync</span>
tcp        0      0 0.0.0.0:873                 0.0.0.0:*                   LISTEN      2076/<span style="color: #000000;">rsync         
tcp        0      0 :::</span>873                      :::*                        LISTEN      2076/rsync   </pre>
</div>

### <span id="223_rsync">2.2.3 <span style="font-family: '微软雅黑',sans-serif;">配置</span>rsync<span style="font-family: '微软雅黑',sans-serif;">客户端（其他服务器为客户端）</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">软件是否存在</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpm -qa |grep rsync</span>
rsync-3.0.6-12.el6.x86_64</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">创建认证文件</span>

&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">客户端的认证文件只需要有密码即可</span>

<div class="cnblogs_code">
  <pre>echo <span style="color: #800000;">"</span><span style="color: #800000;">clsn123</span><span style="color: #800000;">"</span> >>/etc/<span style="color: #000000;">rsync.password
chmod </span>600 /etc/rsync.password</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">实现数据传输</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">交互式</span>
  </p>
</div>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/hosts rsync_backup@172.16.1.41::backup</span>
<span style="color: #000000;">Password:
sending incremental file list
hosts
         </span>357 100%    0.00kB/s    0:00:00 (xfer<span style="color: #008000;">#</span><span style="color: #008000;">1, to-check=0/1)</span>
<span style="color: #000000;"> 
sent </span>63 bytes  received 33 bytes  9.14 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 357  speedup <span style="color: #0000ff;">is</span> 3.72</pre>
</div>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">免交互式</span>
  </p>
</div>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/hosts rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span>
<span style="color: #000000;">sending incremental file list
hosts
         </span>357 100%    0.00kB/s    0:00:00 (xfer<span style="color: #008000;">#</span><span style="color: #008000;">1, to-check=0/1)</span>
<span style="color: #000000;"> 
sent </span>199 bytes  received 27 bytes  150.67 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 357  speedup <span style="color: #0000ff;">is</span> 1.58</pre>
</div>

## <span id="23_rsync">2.3 rsync<span style="font-family: '微软雅黑',sans-serif;">守护进程传输数据原理</span></span>

<p style="text-align: center;">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20180207105650013-767401738.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="rsync 服务部署详解" alt="" />
</p>

## <span id="24_rsync">2.4 rsync <span style="font-family: '微软雅黑',sans-serif;">命令同步参数选项</span>&<span style="font-family: '微软雅黑',sans-serif;">特殊参数</span></span>

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 176.95pt; border-width: 1pt; border-style: solid; border-color: windowtext; background: gray; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: center;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif;">目录参数</span></strong>
      </p>
    </td>
    
    <td style="width: 12cm; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: gray; padding: 0cm 5.4pt;" width="454">
      <p style="text-align: center;" align="center">
        <strong><span style="font-family: '微软雅黑',sans-serif;">参数说明</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -v ,--verbose
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">详细模式输出，传输时的信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -z,--compress
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">传输时进行压缩以提高传输效率</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        --compress-level=NUM <span style="font-family: '微软雅黑',sans-serif;">可按级别压缩</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">局域网可以不用压缩</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -a,--archive <span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">（主要）</span>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">归档模式，表示以递归方式传输文件，并保持文件属性。等于</span> <span style="color: red;">-rtopgDl</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -r,--recursive <strong>&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">对子目录以递归模式，即目录下的所有目录都同样传输。小写</span>r
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -t,--times&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">保持文件时间信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -o,--owner&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">保持文件属主信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -p,--perms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">保持文件权限</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -g,--group&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">保持文件属组信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -P<span style="font-family: '微软雅黑',sans-serif;">，</span>--progress
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">显示同步的过程及传输时的进度等信息（大</span>P<span style="font-family: '微软雅黑',sans-serif;">）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -D,--devices&nbsp;&nbsp;&nbsp; <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">保持设备文件信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -l,--links&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: #00B050;">归档于</span><span style="color: #00b050;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">保留软连接（小写字母</span>l<span style="font-family: '微软雅黑',sans-serif;">）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        -e<span style="font-family: '微软雅黑',sans-serif;">，</span>--rsh=COMMAND
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">使用的信道协议（</span>remote shell<span style="font-family: '微软雅黑',sans-serif;">），指定替代</span>rsh<span style="font-family: '微软雅黑',sans-serif;">的</span>shell<span style="font-family: '微软雅黑',sans-serif;">程序。</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">例如</span> ssh
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        --exclude=<em><span style="text-decoration: underline;">PATTERN</span></em>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">指定排除不需要传输的文件信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        --exclude-from=<em><span style="text-decoration: underline;">file</span></em>
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">文件名所在目录文件，即可以实现排除多个文件</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        --bwlimit=RATE
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">限速功能</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="236">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        --delete
      </p>
    </td>
    
    <td style="width: 12.0cm; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="454">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">让目标目录</span>SRC<span style="font-family: '微软雅黑',sans-serif;">和源目录数据</span>DST<span style="font-family: '微软雅黑',sans-serif;">一致，即无差异数据同步</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 517.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; background: #92d050; padding: 0cm 5.4pt;" colspan="2" width="690">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">保持同步目录及文件属性：</span></strong>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">这里的</span>-avzP<span style="font-family: '微软雅黑',sans-serif;">相当于</span> -vzetopdDlP<span style="font-family: '微软雅黑',sans-serif;">，生产环境常用的参数为</span> -avzP
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">在脚本中可以报</span>-vP<span style="font-family: '微软雅黑',sans-serif;">去掉</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        --progress<span style="font-family: '微软雅黑',sans-serif;">可以用</span>-P<span style="font-family: '微软雅黑',sans-serif;">代替</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 517.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; background: #92cddc; padding: 0cm 5.4pt;" colspan="2" width="690">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong>daemon</strong><strong><span style="font-family: '微软雅黑',sans-serif;">启动扩展参数</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="236">
      <p>
        --daemon
      </p>
    </td>
    
    <td style="width: 12cm; border-top: none; border-left: none; border-bottom: 1pt solid windowtext; border-right: 1pt solid windowtext; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="454">
      <p>
        daemon<span style="font-family: '微软雅黑',sans-serif;">表示以守护进程的方式启动</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="236">
      <p>
        --address
      </p>
    </td>
    
    <td style="width: 12cm; border-top: none; border-left: none; border-bottom: 1pt solid windowtext; border-right: 1pt solid windowtext; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="454">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">绑定指定</span>IP<span style="font-family: '微软雅黑',sans-serif;">地址提供服务。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="236">
      <p>
        --config=FILE
      </p>
    </td>
    
    <td style="width: 12cm; border-top: none; border-left: none; border-bottom: 1pt solid windowtext; border-right: 1pt solid windowtext; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="454">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">更改配置文件路径，而不是默认的</span>/etc/rsyncd.conf
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 176.95pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="236">
      <p>
        --port=PORT
      </p>
    </td>
    
    <td style="width: 12cm; border-top: none; border-left: none; border-bottom: 1pt solid windowtext; border-right: 1pt solid windowtext; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; padding: 0cm 5.4pt;" valign="top" width="454">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">更改其它端口提供服务，而不是缺省的</span>873<span style="font-family: '微软雅黑',sans-serif;">端口</span>
      </p>
    </td>
  </tr>
</table>

### <span id="241">2.4.1 <span style="font-family: '微软雅黑',sans-serif;">特殊参数实践</span></span>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">指定</span><span style="background: lime;">ip</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">：</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync --daemon --address=172.16.1.41</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> netstat -lntup |grep 873</span>
tcp     0   0 172.16.1.41:873     0.0.0.0:*        LISTEN      2583/<span style="color: #000000;">rsync      
参数测试：
[root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span>
<span style="color: #000000;">sending incremental file list
services
      </span>641020 100%   19.34MB/s    0:00:00 (xfer<span style="color: #008000;">#</span><span style="color: #008000;">1, to-check=0/1)</span>
<span style="color: #000000;"> 
sent </span>127417 bytes  received 27 bytes  254888.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 5.03</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">指定配置文件路径</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync --daemon --config=/etc/rsyncd.conf</span>
[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span>
<span style="color: #000000;">sending incremental file list
sent </span>29 bytes  received 8 bytes  74.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 17324.86</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">服务端指定服务端口：</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync --daemon --port=5222</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> netstat -lntup|grep rsync</span>
tcp        0      0 0.0.0.0:5222      0.0.0.0:*           LISTEN      2598/<span style="color: #000000;">rsync         
tcp        0      0 :::</span>5222            :::*                 LISTEN      2598/rsync      </pre>
</div>

# <span id="3_rsycn_rsyncdconf">第3章 rsycn<span style="font-family: '微软雅黑',sans-serif;">配置文件详解</span> rsyncd.conf</span>

## <span id="31">3.1 <span style="font-family: '微软雅黑',sans-serif;">部分知识补充</span></span>

### <span id="311">3.1.1 <span style="font-family: '微软雅黑',sans-serif;">配置文件内容<span style="color: #4f81bd;">参考资料</span></span></span>

<div class="cnblogs_code">
  <pre>man rsyncd.conf</pre>
</div>

### <span id="312">3.1.2 <span style="font-family: '微软雅黑',sans-serif;">配置文件内容总结</span></span>

&nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">模块之上内容为<span style="background: yellow;">全局</span>变量信息</span>

&nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">模块之下内容为<span style="background: yellow;">局部</span>变量信息</span>

**<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">说明：</span>**

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p style="text-indent: 21pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;">
    <span style="font-family: '微软雅黑',sans-serif;">无论是全局变量发生变化，还是局部变量发生变化，都建议重启</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务使配置生效。</span>
  </p>
</div>

## <span id="32_etcinitdrsync">3.2 <span style="font-family: '微软雅黑',sans-serif;">利用</span>/etc/init.d/<span style="font-family: '微软雅黑',sans-serif;">启动</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务方式</span></span>

### <span id="321">3.2.1 <span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">可以实现方式：</span></span>

<div class="cnblogs_code">
  <pre>a. 编写rsync启动脚本（有一定的shell能力 <span style="color: #0000ff;">if</span><span style="color: #000000;"> case）
b. 利用xinetd服务，管理启动rsync服务</span></pre>
</div>

### <span id="322_xinetd_rsync">3.2.2 <span style="font-family: '微软雅黑',sans-serif;">利用</span> xinetd<span style="font-family: '微软雅黑',sans-serif;">服务</span> <span style="font-family: '微软雅黑',sans-serif;">管理</span>rsync</span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">安装</span>xinetd<span style="font-family: '微软雅黑',sans-serif;">软件</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> yum install -y xinetd</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpm -qa |grep xin</span>
xinetd-2.3.14-40.el6.x86_64</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：编辑配置文件</span>

&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">修改</span>disable = yes <span style="font-family: '微软雅黑',sans-serif;">改为</span>disable = no

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/xinetd.d/rsync</span><span style="color: #008000;">
#</span><span style="color: #008000;"> default: off</span><span style="color: #008000;">
#</span><span style="color: #008000;"> description: The rsync server is a good addition to an ftp server, as it \</span><span style="color: #008000;">
#</span><span style="color: #008000;">   allows crc checksumming etc.</span>
<span style="color: #000000;">service rsync
{
disable   </span>=<span style="color: #000000;"> no
flags     </span>=<span style="color: #000000;"> IPv6
socket_type     </span>=<span style="color: #000000;"> stream
wait            </span>=<span style="color: #000000;"> no
user            </span>=<span style="color: #000000;"> root
server          </span>= /usr/bin/<span style="color: #000000;">rsync
server_args     </span>= --<span style="color: #000000;">daemon
log_on_failure  </span>+=<span style="color: #000000;"> USERID
}</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三个里程碑：重启</span>xinetd<span style="font-family: '微软雅黑',sans-serif;">服务</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/xinetd restart</span>
<span style="color: #000000;">Stopping xinetd:                                           [  OK  ]
Starting xinetd:                                           [  OK  ]</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">传输测试</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup --password-file=/etc/rsync.password</span>
<span style="color: #000000;">sending incremental file list
sent </span>29 bytes  received 8 bytes  74.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 17324.86</pre>
</div>

## <span id="33">3.3 <span style="font-family: '微软雅黑',sans-serif;">定义变量信息实现免秘钥交互</span></span>

### <span id="331_man">3.3.1 <span style="font-family: '微软雅黑',sans-serif;">通过</span>man<span style="font-family: '微软雅黑',sans-serif;">手册获得方法</span></span>

<div class="cnblogs_code">
  <pre>Some  modules  on the remote daemon may require authentication. If so, you will receive a password prompt when you connect.  You  can avoid  the  password  prompt  by  setting the environment variable RSYNC_PASSWORD to the password  you  want  to  use  <span style="color: #0000ff;">or</span>  using  the --password-<span style="color: #000000;">file option. This may be useful when scripting rsync.
WARNING:  On some systems environment variables are visible to all users. On those systems using </span>--password-file <span style="color: #0000ff;">is</span> recommended.</pre>
</div>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">在远程进程的一些模块可能需要认证。如果是这样的话，你将得到一个密码提示当您连接。你可以通过设置环境变量</span><span style="background: yellow;">rsync_password</span><span style="font-family: '微软雅黑',sans-serif;">要使用或使用密码文件选项密码避免密码提示。这可能是有用的脚本文件。</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">警告：在一些系统环境变量，对所有用户都是可见的。在这些系统中使用的密码文件的建议。</span>
  </p>
</div>

### <span id="332_RSYNC_PASSWORD">3.3.2 <span style="font-family: '微软雅黑',sans-serif;">使用</span> RSYNC_PASSWORD <span style="font-family: '微软雅黑',sans-serif;">变量实现免交互</span></span>

<span style="font-family: '微软雅黑',sans-serif;">未设置变量之前</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup</span>
Password:</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">添加上环境变量</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> export RSYNC_PASSWORD=clsn123</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">测试</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup</span>
<span style="color: #000000;">sending incremental file list
sent </span>29 bytes  received 8 bytes  24.67 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 17324.86</pre>
</div>

## <span id="34">3.4 <span style="font-family: '微软雅黑',sans-serif;">守护进程多模块功能配置</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">编写配置信息创建多模块</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/rsyncd.conf</span>
<span style="color: #000000;">&hellip;&hellip;
[nfsdata]
comment </span>= <span style="color: #800000;">"</span><span style="color: #800000;">nfsdata dir by clsn</span><span style="color: #800000;">"</span><span style="color: #000000;">
path </span>= /backup/<span style="color: #000000;">nfsdata
[nfsbackup]
comment </span>= <span style="color: #800000;">"</span><span style="color: #800000;">nfsbackup dir by clsn</span><span style="color: #800000;">"</span><span style="color: #000000;">
path </span>= /backup/nfsbackup&nbsp;</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">创建多模块指定的目录</span>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> 创建目录，并修改目录的权限</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir /backup/nfs{data,backup} -p</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> chown rsync.rsync  /backup/nfs{data,backup}</span></pre>
</div>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;">查看：</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ll /backup/nfs{data,backup} -d</span>
drwxr-xr-x 2 rsync rsync 4096 Oct 12 10:05 /backup/<span style="color: #000000;">nfsbackup
drwxr</span>-xr-x 2 rsync rsync 4096 Oct 12 10:05 /backup/nfsdata</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">利用</span>rsync<span style="font-family: '微软雅黑',sans-serif;">客户端进行测试</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /data/ rsync_backup@172.16.1.41::nfsdata --password-file=/etc/rsync.passsword</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
nfs.data
sent </span>78 bytes  received 30 bytes  216.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">说明：</span>

> rsyncd.conf配置文件中，添加多模块信息，可以不用重启rsync服务，即时生效~
> 
> 全局变量参数针对所有模块生效；局部变量参数只针对指定模块生效
> 
> read only参数默认配置为ture，即为只读模式
> 
> 全局变量发生变化，不用重启rsync服务；局部变量发生变化，需要重启rsync服务

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">注意：修改配置文件就重启</span>**<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">&darr;</span>**

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p style="text-indent: 21pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;">
    <span style="font-family: '微软雅黑',sans-serif;">无论是全局变量发生变化，还是局部变量发生变化，都建议重启</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务使配置生效</span>
  </p>
</div>

## <span id="35">3.5 <span style="font-family: '微软雅黑',sans-serif;">守护进程的排除功能实践</span></span>

### <span id="351">3.5.1 <span style="font-family: '微软雅黑',sans-serif;">排除的方式</span></span>

<p style="text-indent: 21.0pt;">
  a<span style="font-family: '微软雅黑',sans-serif;">）</span> --exclude=<span style="font-family: '微软雅黑',sans-serif;">要配置的目录或文件名称</span>
</p>

&nbsp;&nbsp;&nbsp; b<span style="font-family: '微软雅黑',sans-serif;">）</span> --exclude-from=<span style="font-family: '微软雅黑',sans-serif;">要排除多个目录或文件汇总文件名称</span>

&nbsp;&nbsp;&nbsp; c<span style="font-family: '微软雅黑',sans-serif;">）</span> <span style="font-family: '微软雅黑',sans-serif;">在配置文件中进行修改，指定要排除的信息</span>

### <span id="352">3.5.2 <span style="font-family: '微软雅黑',sans-serif;">排除测试</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑</span>: <span style="font-family: '微软雅黑',sans-serif;">创建模拟测试环境</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir {a..d}</span>
[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> touch {a..d}/{1..3}.txt</span>
[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> tree</span>
<span style="color: #000000;">.
├── a
│   ├── </span>1<span style="color: #000000;">.txt
│   ├── </span>2<span style="color: #000000;">.txt
│   └── </span>3<span style="color: #000000;">.txt
├── b
│   ├── </span>1<span style="color: #000000;">.txt
│   ├── </span>2<span style="color: #000000;">.txt
│   └── </span>3<span style="color: #000000;">.txt
├── c
│   ├── </span>1<span style="color: #000000;">.txt
│   ├── </span>2<span style="color: #000000;">.txt
│   └── </span>3<span style="color: #000000;">.txt
└── d
    ├── </span>1<span style="color: #000000;">.txt
    ├── </span>2<span style="color: #000000;">.txt
    └── </span>3<span style="color: #000000;">.txt
</span>4 directories, 12 files</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑</span> <span style="font-family: '微软雅黑',sans-serif;">利用</span> --exclude<span style="font-family: '微软雅黑',sans-serif;">参数测试排除功能</span>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> 需求：不要a目录中3.txt 不要b、c目录</span>
[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /data/ --exclude=a/3.txt --exclude=b --exclude=c rsync_backup@172.16.1.41::nfsdata</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
a</span>/<span style="color: #000000;">
a</span>/1<span style="color: #000000;">.txt
a</span>/2<span style="color: #000000;">.txt
d</span>/<span style="color: #000000;">
d</span>/1<span style="color: #000000;">.txt
d</span>/2<span style="color: #000000;">.txt
d</span>/3<span style="color: #000000;">.txt
sent </span>300 bytes  received 114 bytes  828.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00</pre>
</div>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif; background: yellow;">精简方式排除</span>
  </p>
</div>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /data/ --exclude=a/3.txt --exclude={b,c} rsync_backup@172.16.1.41::nfsdata</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
a</span>/<span style="color: #000000;">
a</span>/1<span style="color: #000000;">.txt
a</span>/2<span style="color: #000000;">.txt
d</span>/<span style="color: #000000;">
d</span>/1<span style="color: #000000;">.txt
d</span>/2<span style="color: #000000;">.txt
d</span>/3<span style="color: #000000;">.txt
sent </span>300 bytes  received 114 bytes  828.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00</pre>
</div>

### <span id="353_--exclude-from">3.5.3 <span style="font-family: '微软雅黑',sans-serif;">利用</span>--exclude-from <span style="font-family: '微软雅黑',sans-serif;">方式进行排除</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑</span>: <span style="font-family: '微软雅黑',sans-serif;">创建模拟测试环境</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir {a..d}</span>
[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> touch {a..d}/{1..3}.txt</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：利用</span>--exlude-from<span style="font-family: '微软雅黑',sans-serif;">参数，测试排除功能</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /tmp/paichu.txt</span>
a/3<span style="color: #000000;">.txt
b
c</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三个里程碑：进行排除</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /data/ --exclude-from=/tmp/paichu.txt rsync_backup@172.16.1.41::nfsdata</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
a</span>/<span style="color: #000000;">
a</span>/1<span style="color: #000000;">.txt
a</span>/2<span style="color: #000000;">.txt
d</span>/<span style="color: #000000;">
d</span>/1<span style="color: #000000;">.txt
d</span>/2<span style="color: #000000;">.txt
d</span>/3<span style="color: #000000;">.txt
sent </span>300 bytes  received 114 bytes  828.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">说明：</span>

> 01.&nbsp;排除文件中，需要利用相对路径指定排除信息（不能利用绝对路径）
> 
> 02.&nbsp;相对路径指的是相对同步的目录信息而言，是对rsync -avz /data/&nbsp;后面的data目录进行相对

### <span id="354">3.5.4 <span style="font-family: '微软雅黑',sans-serif;">在配置文件中修改要排除的文件</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">编写修改服务端配置文件</span>

<div class="cnblogs_code">
  <pre>vim /etc/<span style="color: #000000;">rsyncd.conf
[nfsdata]
comment </span>= <span style="color: #800000;">"</span><span style="color: #800000;">nfsdata dir by clsn</span><span style="color: #800000;">"</span><span style="color: #000000;">
path </span>= /backup/<span style="color: #000000;">nfsdata
exclude</span>=a/3.txt b c</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：重启</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务</span>

<div class="cnblogs_code">
  <pre>killall rsync && sleep 1 && rsync --daemon</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">进行测试</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /data/  rsync_backup@172.16.1.41::nfsdata</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
a</span>/<span style="color: #000000;">
a</span>/1<span style="color: #000000;">.txt
a</span>/2<span style="color: #000000;">.txt
skipping daemon</span>-excluded file <span style="color: #800000;">"</span><span style="color: #800000;">a/3.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">
skipping daemon</span>-excluded directory <span style="color: #800000;">"</span><span style="color: #800000;">b</span><span style="color: #800000;">"</span>
*** Skipping any contents <span style="color: #0000ff;">from</span> this failed directory ***<span style="color: #000000;">
skipping daemon</span>-excluded directory <span style="color: #800000;">"</span><span style="color: #800000;">c</span><span style="color: #800000;">"</span>
*** Skipping any contents <span style="color: #0000ff;">from</span> this failed directory ***<span style="color: #000000;">
d</span>/<span style="color: #000000;">
d</span>/1<span style="color: #000000;">.txt
d</span>/2<span style="color: #000000;">.txt
d</span>/3<span style="color: #000000;">.txt
sent </span>407 bytes  received 116 bytes  1046.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00<span style="color: #000000;">
rsync error: some files</span>/attrs were <span style="color: #0000ff;">not</span> transferred (see previous errors) (code 23) at main.c(1039) [sender=3.0.6]</pre>
</div>

## <span id="36">3.6 <span style="font-family: '微软雅黑',sans-serif;">守护进程来创建备份目录</span></span>

<span style="font-family: '微软雅黑',sans-serif;">通过客户端命令创建服务端备份目录中子目录</span>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> 推送/etc/services文件到 服务器/backup/sda/目录</span>
[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/dba/</span>
<span style="color: #000000;">sending incremental file list
created directory dba
services
      </span>641020 100%   19.34MB/s    0:00:00 (xfer<span style="color: #008000;">#</span><span style="color: #008000;">1, to-check=0/1)</span></pre>
</div>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> 推送/etc/services文件到 服务器/backup/sa/目录</span>
sent 127417 bytes  received 27 bytes  254888.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 5.03<span style="color: #000000;">
[root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/sa/</span>
<span style="color: #000000;">sending incremental file list
created directory sa
services
      </span>641020 100%   19.34MB/s    0:00:00 (xfer<span style="color: #008000;">#</span><span style="color: #008000;">1, to-check=0/1)</span></pre>
</div>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> 推送/etc/services文件到 服务器/backup/dev/目录</span>
sent 127417 bytes  received 27 bytes  254888.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 5.03<span style="color: #000000;">
[root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avzP /etc/services rsync_backup@172.16.1.41::backup/dev/</span>
<span style="color: #000000;">sending incremental file list
created directory dev
services
      </span>641020 100%   18.71MB/s    0:00:00 (xfer<span style="color: #008000;">#</span><span style="color: #008000;">1, to-check=0/1)</span>
<span style="color: #000000;"> 
sent </span>127417 bytes  received 27 bytes  254888.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 5.03</pre>
</div>

**<span style="font-family: '微软雅黑',sans-serif;">检查结果：</span>**

<div class="cnblogs_code">
  <pre>[root@backup backup]<span style="color: #008000;">#</span><span style="color: #008000;"> tree</span>
<span style="color: #000000;">.
├── dba
│   └── services
├── dev
│   └── services
└── sa
    └── services</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: yellow; background: darkgreen;">说明：</span>

> a&nbsp;目标目录名称后要加上&nbsp;"/",&nbsp;表示创建目录，否则变为修改传输文件名称了
> 
> b&nbsp;利用客户端创建服务备份子目录时，只能创建一级子目录。

## <span id="37">3.7 <span style="font-family: '微软雅黑',sans-serif;">守护进程的访问控制配置</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：在服务端配置文件，编写白名单策略或黑名单策略（只能取其一）</span>

<div class="cnblogs_code">
  <pre>    vim /etc/<span style="color: #000000;">rsyncd.conf
    hosts allow </span>= 172.16.1.0/24
    <span style="color: #008000;">#</span><span style="color: #008000;">hosts deny = 0.0.0.0/32</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">关于访问控制的说明：</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p style="text-indent: 21pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;">
    01. <span style="font-family: '微软雅黑',sans-serif;">白名单和黑名单<span style="background: lime;">同时存在</span>时，默认控制策略为<span style="background: lime;">不匹配</span>的传输数据信息<span style="background: lime;">全部放行</span></span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp; 02. <span style="font-family: '微软雅黑',sans-serif; background: yellow;">白名单单一存在</span><span style="font-family: '微软雅黑',sans-serif;">时，默认控制策略为<span style="background: yellow;">不匹配</span>的传输数据信息<span style="background: yellow;">全部禁止</span></span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp; 03. <span style="font-family: '微软雅黑',sans-serif; background: lime;">黑名单单一存在</span><span style="font-family: '微软雅黑',sans-serif;">时，默认控制策略为<span style="background: lime;">不匹配</span>的传输数据信息<span style="background: lime;">全部放行</span></span>
  </p>
</div>

**<span style="color: red;">&nbsp; &nbsp;</span>****<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">全局变量修改控制策略信息，</span><span style="color: red;">rsync</span>****<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">服务必须重启</span>**

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：客户端进行测试</span>

<div class="cnblogs_code">
  <pre>    [root@nfs01 backup]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /etc/services rsync_backup@10.0.0.41::data</span>
    @ERROR: Unknown module <span style="color: #800000;">'</span><span style="color: #800000;">data</span><span style="color: #800000;">'</span><span style="color: #000000;">
    rsync error: error starting client</span>-server protocol (code 5) at main.c(1503) [sender=3.0.6<span style="color: #000000;">]
</span>--------------------------------------------------------------------------------<span style="color: #000000;">
    [root@nfs01 backup]</span><span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /etc/services sync_backup@172.16.1.41::data</span>
<span style="color: #000000;">    sending incremental file list
    sent </span>29 bytes  received 8 bytes  74.00 bytes/<span style="color: #000000;">sec
    total size </span><span style="color: #0000ff;">is</span> 641020  speedup <span style="color: #0000ff;">is</span> 17324.86</pre>
</div>

## <span id="38">3.8 <span style="font-family: '微软雅黑',sans-serif;">守护进程无差异同步配置</span></span>

### <span id="381">3.8.1 <span style="font-family: '微软雅黑',sans-serif;">什么是无差异：</span></span>

&nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">推模式：我有什么，你就有什么；我没有，你也不能有</span>

&nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">拉模式：你有什么，我就有什么；你没有，我也不能有</span>

&nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">总结：<strong><span style="color: red;">服务端客户端数据完全一致（一模一样）</span></strong></span>

### <span id="382">3.8.2 <span style="font-family: '微软雅黑',sans-serif;">实现无差异同步方法</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">创建实验环境</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ll /data/</span>
total 16<span style="color: #000000;">
drwxr</span>-xr-x 2 root root 4096 Oct 12 10:29<span style="color: #000000;"> a
drwxr</span>-xr-x 2 root root 4096 Oct 12 10:40<span style="color: #000000;"> b
drwxr</span>-xr-x 2 root root 4096 Oct 12 10:29<span style="color: #000000;"> c
drwxr</span>-xr-x 2 root root 4096 Oct 12 10:29 d</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程：进行第一次数据同步</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup/</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
a</span>/<span style="color: #000000;">
a</span>/1<span style="color: #000000;">.txt
a</span>/2<span style="color: #000000;">.txt
a</span>/3<span style="color: #000000;">.txt
b</span>/<span style="color: #000000;">
b</span>/1<span style="color: #000000;">.txt
b</span>/2<span style="color: #000000;">.txt
b</span>/3<span style="color: #000000;">.txt
c</span>/<span style="color: #000000;">
c</span>/1<span style="color: #000000;">.txt
c</span>/2<span style="color: #000000;">.txt
c</span>/3<span style="color: #000000;">.txt
d</span>/<span style="color: #000000;">
d</span>/1<span style="color: #000000;">.txt
d</span>/2<span style="color: #000000;">.txt
d</span>/3<span style="color: #000000;">.txt
sent </span>669 bytes  received 255 bytes  1848.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三个里程：删除指定目录，并添加指定文件，测试无差异功能</span>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> 删除客户端中的 a/ 目录，再进行无差异传输</span>
[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rm a/ -rf</span>
[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup/</span>
<span style="color: #000000;">sending incremental file list
.</span>/<span style="color: #000000;">
deleting a</span>/3<span style="color: #000000;">.txt
deleting a</span>/2<span style="color: #000000;">.txt
deleting a</span>/1<span style="color: #000000;">.txt
deleting a</span>/<span style="color: #000000;">
sent </span>181 bytes  received 14 bytes  390.00 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 0  speedup <span style="color: #0000ff;">is</span> 0.00</pre>
</div>

### <span id="383">3.8.3 <span style="font-family: '微软雅黑',sans-serif;">【<span style="background: yellow;">注意</span>】无差异同步方法的应用</span></span>

01. <span style="font-family: '微软雅黑',sans-serif;">实现储存数据与备份数据完全一致（<strong><span style="color: red;">慎用</span></strong>）</span>

<div class="cnblogs_code">
  <pre>  rsync -avz --delete  /data/ rsync_backup@172.16.1.41::backup /</pre>
</div>

02. <span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; background: yellow;">快速删除大文件数据</span>

<div class="cnblogs_code">
  <pre>  1.mkdir /null      --<span style="color: #000000;">创建出一个空目录。
  </span>2.rsync -avz --delete /null/ /bigdata/
  <span style="color: #008000;">#</span><span style="color: #008000;"> 删除效率高于 rm -rf /bigdata</span></pre>
</div>

## <span id="39">3.9 <span style="font-family: '微软雅黑',sans-serif;">守护进程的列表功能配置</span></span>

<span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">在服务端配置文件中开启</span>list<span style="font-family: '微软雅黑',sans-serif;">列表功能</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/rsyncd.conf</span>
list = true</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：重启</span>rsync<span style="font-family: '微软雅黑',sans-serif;">服务</span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> killall rsync && sleep 1 && rsync --daemon</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">第三个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">客户端查看服务端模块信息</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 data]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync rsync_backup@172.16.1.41::</span>
backup         <span style="color: #800000;">"</span><span style="color: #800000;">backup dir by clsn</span><span style="color: #800000;">"</span><span style="color: #000000;">
nfsdata        </span><span style="color: #800000;">"</span><span style="color: #800000;">nfsdata dir by clsn</span><span style="color: #800000;">"</span><span style="color: #000000;">
nfsbackup      </span><span style="color: #800000;">"</span><span style="color: #800000;">nfsbackup dir by clsn</span><span style="color: #800000;">"</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: lime;">说明：</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p style="text-indent: 21pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;">
    <span style="font-family: '微软雅黑',sans-serif;">为了提升备份服务器安全性，<span style="background: lime;">建议关闭</span></span>list<span style="font-family: '微软雅黑',sans-serif;">列表功能</span>
  </p>
</div>

# <span id="4">第4章 <span style="font-family: '微软雅黑',sans-serif;">常见问题</span></span>

<div class="cnblogs_code">
  <pre>[root@nfs01 tmp]<span style="color: #008000;">#</span><span style="color: #008000;"> rsync -avz /etc/hosts  rsync_backup@172.16.1.41::backup</span>
<span style="color: #000000;">Password:
sending incremental file list
hosts
rsync: mkstemp </span><span style="color: #800000;">"</span><span style="color: #800000;">.hosts.U5OCyR</span><span style="color: #800000;">"</span> (<span style="color: #0000ff;">in</span> backup) failed: Permission denied (13<span style="color: #000000;">)
sent </span>200 bytes  received 27 bytes  13.76 bytes/<span style="color: #000000;">sec
total size </span><span style="color: #0000ff;">is</span> 371  speedup <span style="color: #0000ff;">is</span> 1.63<span style="color: #000000;">
rsync error: some files</span>/attrs were <span style="color: #0000ff;">not</span> transferred (see previous errors) (code 23) at main.c(1039) [sender=3.0.6]</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">说明：备份目录权限设置不正确</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">解决办法：</span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">将服务端的备份存放目录（</span>path<span style="font-family: '微软雅黑',sans-serif;">值），属主和属组修改为</span>rsync<span style="font-family: '微软雅黑',sans-serif;">。</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">&nbsp;　　<span class="cnblogs_code">[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> chown -R rsync.rsync /backup/</span></span>&nbsp;</span>
  </p>
</div>

<div id="toc_container" class="toc_white have_bullets">
  <ul class="toc_list">
    <li>
      <a href="#1_rsync">第1章 rsync 软件介绍</a><ul>
        <li>
          <a href="#11_rsync">1.1 什么是rsync</a><ul>
            <li>
              <a href="#111">1.1.1 全量及增量</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#12">1.2 实现增量复制的原理</a><ul>
            <li>
              <a href="#121">1.2.1 软件版本</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#13_rsync_nbsp">1.3 rsync 软件功能介绍&nbsp;</a><ul>
            <li>
              <a href="#131_rsync_cp">1.3.1 rsync == cp</a>
            </li>
            <li>
              <a href="#132_rsync_scp">1.3.2 rsync == scp</a>
            </li>
            <li>
              <a href="#133_rsync_rm">1.3.3 rsync == rm</a><ul>
                <li>
                  <a href="#1331nbsp">1.3.3.1&nbsp;环境准备</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#134_rsync_ls_-l">1.3.4 rsync == ls -l</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#14_Rsync7">1.4 Rsync的特性总结（7个特性信息说明）</a>
        </li>
        <li>
          <a href="#15_Rsync">1.5 Rsync的企业工作场景说明</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#2_rsync">第2章 rsync使用方式</a><ul>
        <li>
          <a href="#21_rsync">2.1 rsync软件工作方式</a><ul>
            <li>
              <a href="#211_cp">2.1.1 本地数据同步方式（类似于cp）</a><ul>
                <li>
                  <a href="#2111nbspnbspnbsp">2.1.1.1&nbsp;实例演示命令：&nbsp;&nbsp;</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#212_scp">2.1.2 远程数据同步方式（类似scp）---又称为隧道传输</a>
            </li>
            <li>
              <a href="#213_pull">2.1.3 【实践操作】pull 拉</a>
            </li>
            <li>
              <a href="#214_push">2.1.4 【实践操作】push 推 （目录）</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#22">2.2 守护进程方式同步数据</a><ul>
            <li>
              <a href="#221_rsync">2.2.1 配置rsync守护进程方式（需要有服务端与客户端）</a>
            </li>
            <li>
              <a href="#222_rsync_backup">2.2.2 配置rsync服务端（将服务端配置到 backup 服务器上）</a>
            </li>
            <li>
              <a href="#223_rsync">2.2.3 配置rsync客户端（其他服务器为客户端）</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#23_rsync">2.3 rsync守护进程传输数据原理</a>
        </li>
        <li>
          <a href="#24_rsync">2.4 rsync 命令同步参数选项&特殊参数</a><ul>
            <li>
              <a href="#241">2.4.1 特殊参数实践</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#3_rsycn_rsyncdconf">第3章 rsycn配置文件详解 rsyncd.conf</a><ul>
        <li>
          <a href="#31">3.1 部分知识补充</a><ul>
            <li>
              <a href="#311">3.1.1 配置文件内容参考资料</a>
            </li>
            <li>
              <a href="#312">3.1.2 配置文件内容总结</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#32_etcinitdrsync">3.2 利用/etc/init.d/启动rsync服务方式</a><ul>
            <li>
              <a href="#321">3.2.1 可以实现方式：</a>
            </li>
            <li>
              <a href="#322_xinetd_rsync">3.2.2 利用 xinetd服务 管理rsync</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#33">3.3 定义变量信息实现免秘钥交互</a><ul>
            <li>
              <a href="#331_man">3.3.1 通过man手册获得方法</a>
            </li>
            <li>
              <a href="#332_RSYNC_PASSWORD">3.3.2 使用 RSYNC_PASSWORD 变量实现免交互</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#34">3.4 守护进程多模块功能配置</a>
        </li>
        <li>
          <a href="#35">3.5 守护进程的排除功能实践</a><ul>
            <li>
              <a href="#351">3.5.1 排除的方式</a>
            </li>
            <li>
              <a href="#352">3.5.2 排除测试</a>
            </li>
            <li>
              <a href="#353_--exclude-from">3.5.3 利用--exclude-from 方式进行排除</a>
            </li>
            <li>
              <a href="#354">3.5.4 在配置文件中修改要排除的文件</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#36">3.6 守护进程来创建备份目录</a>
        </li>
        <li>
          <a href="#37">3.7 守护进程的访问控制配置</a>
        </li>
        <li>
          <a href="#38">3.8 守护进程无差异同步配置</a><ul>
            <li>
              <a href="#381">3.8.1 什么是无差异：</a>
            </li>
            <li>
              <a href="#382">3.8.2 实现无差异同步方法</a>
            </li>
            <li>
              <a href="#383">3.8.3 【注意】无差异同步方法的应用</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#39">3.9 守护进程的列表功能配置</a>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#4">第4章 常见问题</a>
    </li>
  </ul>
</div>