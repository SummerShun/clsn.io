---
title: 高并发场景 LVS 安装及高可用实现
author: 惨绿少年
type: post
date: 2017-11-28T23:54:00+00:00
url: /clsn/lx613.html
Baidusubmit:
  - 1
views:
  - 214
zm_favorites:
  - 1
categories:
  - Linux运维
  - Web应用
  - 安全
  - 玩转Linux
  - 运维基本功

---
## <span id="11">1.1 <span style="font-family: '微软雅黑',sans-serif;">负载均衡介绍</span></span>

### <span id="111">1.1.1 <span style="font-family: '微软雅黑',sans-serif;">负载均衡的妙用</span></span>

<p style="margin-left: 7.1pt; text-indent: 21.0pt;">
  <span style="font-family: 等线;">&nbsp;负载均衡（</span>Load Balance<span style="font-family: 等线;">）集群提供了一种廉价、有效、透明的方法，来扩展网络设备和服务器的负载、带宽、增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">单台计算机无法承受大规模的并发访问或数据流量了，此时需要搭建负载均衡集群把流量分摊到多台节点设备上分别处理，即减少用户等待响应的时间又提升了用户体验；</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span>7*24<span style="font-family: '微软雅黑',sans-serif;">小时的服务保证，任意一个或多个有限后端节点设备宕机，不能影响整个业务的运行。</span>
</p>

### <span id="112_lvs">1.1.2 <span style="font-family: '微软雅黑',sans-serif;">为什么要用</span>lvs</span>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">n&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">工作在网络模型的</span>7<span style="font-family: '微软雅黑',sans-serif;">层，可以针对</span>http<span style="font-family: '微软雅黑',sans-serif;">应用做一些分流的策略，比如针对域名、目录结构，</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">单凭这点可利用的场合就远多于</span>LVS<span style="font-family: '微软雅黑',sans-serif;">了。</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">n&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">最新版本的</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">也支持</span>4<span style="font-family: '微软雅黑',sans-serif;">层</span>TCP<span style="font-family: '微软雅黑',sans-serif;">负载，曾经这是</span>LVS<span style="font-family: '微软雅黑',sans-serif;">比</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">好的地方。</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">n&nbsp;</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">对网络稳定性的依赖非常小，理论上能</span>ping<span style="font-family: '微软雅黑',sans-serif;">通就就能进行负载功能，这个也是它的优势之一，相反</span>LVS<span style="font-family: '微软雅黑',sans-serif;">对网络稳定性依赖比较大。</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">n&nbsp;</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">安装和配置比较简单，测试起来比较方便，它基本能把错误用日志打印出来。</span>LVS<span style="font-family: '微软雅黑',sans-serif;">的配置、测试就要花比较长的时间了，</span>LVS<span style="font-family: '微软雅黑',sans-serif;">对网络依赖比较大。</span>
</p>

**<span style="font-family: 等线; background: lime;">那为什么要用</span><span style="background: lime;">lvs</span>****<span style="font-family: 等线; background: lime;">呢？</span>**

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">简单一句话，当并发超过了</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">上限，就可以使用</span>LVS<span style="font-family: '微软雅黑',sans-serif;">了。</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">日</span>1000-2000W PV<span style="font-family: '微软雅黑',sans-serif;">或并发请求</span>1<span style="font-family: '微软雅黑',sans-serif;">万以下都可以考虑用</span>Nginx<span style="font-family: '微软雅黑',sans-serif;">。</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">大型门户网站，电商网站需要用到</span>LVS<span style="font-family: '微软雅黑',sans-serif;">。</span>
</p>

## <span id="12_LVS">1.2 LVS<span style="font-family: '微软雅黑',sans-serif;">介绍</span></span>

<p style="text-indent: 21.0pt;">
  LVS<span style="font-family: 等线;">是</span>Linux Virtual Server<span style="font-family: 等线;">的简写，意即</span>Linux<span style="font-family: 等线;">虚拟服务器，是一个虚拟的服务器集群系统，可以在</span>UNIX/LINUX<span style="font-family: 等线;">平台下实现负载均衡集群功能。该项目在</span><span style="text-decoration: underline;">1998</span><span style="text-decoration: underline;"><span style="font-family: 等线;">年</span>5</span><span style="text-decoration: underline;"><span style="font-family: 等线;">月由章文嵩博士</span></span><span style="font-family: 等线;">组织成立，是<strong><em><span style="text-decoration: underline;">中国国内最早出现的自由软件项目之一</span></em></strong>。</span>
</p>

### <span id="121">1.2.1 <span style="font-family: '微软雅黑',sans-serif;">相关参考资料</span></span>

LVS<span style="font-family: 等线;">官网：</span>_<span style="text-decoration: underline;">http://www.linuxvirtualserver.org/index.html</span>_

_<span style="text-decoration: underline;"><span style="font-family: 等线;">相关中文资料</span></span>_

&nbsp;

<div class="cnblogs_Highlighter">
  <pre class="brush:python;gutter:true;">LVS项目介绍           http://www.linuxvirtualserver.org/zh/lvs1.html 
LVS集群的体系结构     http://www.linuxvirtualserver.org/zh/lvs2.html 
LVS集群中的IP负载均衡技术  http://www.linuxvirtualserver.org/zh/lvs3.html
LVS集群的负载调度      http://www.linuxvirtualserver.org/zh/lvs4.html </pre>
</div>

&nbsp;

### <span id="122_LVSip_vs">1.2.2 LVS<span style="font-family: '微软雅黑',sans-serif;">内核模块</span>ip_vs<span style="font-family: '微软雅黑',sans-serif;">介绍</span></span>

<p style="margin-left: 19.25pt;">
  <span style="font-family: 等线;">早在</span>2.2<span style="font-family: 等线;">内核时，</span> IPVS<span style="font-family: 等线;">就已经以内核补丁的形式出现。</span>
</p>

<p style="margin-left: 19.25pt;">
  <span style="font-family: 等线;">从</span>2.4.23<span style="font-family: 等线;">版本开始，</span>IPVS<span style="font-family: 等线;">软件就合并到</span>Linux<span style="font-family: 等线;">内核的常用版本的内核补丁的集合。</span>
</p>

<p style="margin-left: 19.25pt;">
  <span style="text-decoration: underline;"><span style="font-family: 等线;">从</span><strong>2.4.24</strong></span><span style="text-decoration: underline;"><span style="font-family: 等线;">以后</span>IPVS</span><span style="text-decoration: underline;"><span style="font-family: 等线;">已经成为</span>Linux</span><span style="text-decoration: underline;"><span style="font-family: 等线;">官方标准内核的一部分。</span></span>
</p>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129150904487-1864991874.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span>LVS<span style="font-family: '微软雅黑',sans-serif;">无需安装</span>
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">安装的是管理工具，第一种叫</span>ipvsadm<span style="font-family: '微软雅黑',sans-serif;">，第二种叫</span>keepalive
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span>ipvsadm<span style="font-family: '微软雅黑',sans-serif;">是通过命令行管理，而</span>keepalive<span style="font-family: '微软雅黑',sans-serif;">读取配置文件管理</span>
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">&uuml;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">后面我们会用</span>Shell<span style="font-family: '微软雅黑',sans-serif;">脚本实现</span>keepalive<span style="font-family: '微软雅黑',sans-serif;">的功能</span>
</p>

## <span id="13_LVS">1.3 LVS<span style="font-family: '微软雅黑',sans-serif;">集群搭建</span></span>

### <span id="131">1.3.1 <span style="font-family: '微软雅黑',sans-serif;">集群环境说明</span></span>

<table style="width: 96%; border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 9.88%; border-top: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: 1pt solid #4472c4; border-right: none; background: #4472c4; padding: 0cm 5.4pt;" valign="top" width="9%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">主机名</span></strong>
      </p>
    </td>
    
    <td style="width: 18.32%; border-top: solid #4472C4 1.0pt; border-left: none; border-bottom: solid #4472C4 1.0pt; border-right: none; background: #4472C4; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="18%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif; color: white;">IP</span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">地址</span></strong>
      </p>
    </td>
    
    <td style="width: 25.36%; border-top: solid #4472C4 1.0pt; border-left: none; border-bottom: solid #4472C4 1.0pt; border-right: none; background: #4472C4; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="25%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">软件</span></strong>
      </p>
    </td>
    
    <td style="width: 46.46%; border-top: 1pt solid #4472c4; border-right: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: none; background: #4472c4; padding: 0cm 5.4pt;" valign="top" width="46%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">系统版本</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 9.88%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" valign="top" width="9%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">lb03</span></strong>
      </p>
    </td>
    
    <td style="width: 18.32%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="18%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">10.0.0.15</span>
      </p>
    </td>
    
    <td style="width: 25.36%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="25%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">lvs keepalived</span>
      </p>
    </td>
    
    <td style="width: 46.46%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="46%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">CentOS Linux release 7.4.1708</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 9.88%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" valign="top" width="9%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">lb04</span></strong>
      </p>
    </td>
    
    <td style="width: 18.32%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="18%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">10.0.0.16</span>
      </p>
    </td>
    
    <td style="width: 25.36%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="25%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">lvs keepalived</span>
      </p>
    </td>
    
    <td style="width: 46.46%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="46%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">CentOS Linux release 7.4.1708</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 9.88%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" valign="top" width="9%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">web03</span></strong>
      </p>
    </td>
    
    <td style="width: 18.32%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="18%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">10.0.0.18</span>
      </p>
    </td>
    
    <td style="width: 25.36%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="25%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">tomcat</span>
      </p>
    </td>
    
    <td style="width: 46.46%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="46%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">CentOS Linux release 7.4.1708</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 9.88%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" valign="top" width="9%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">web04</span></strong>
      </p>
    </td>
    
    <td style="width: 18.32%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="18%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">10.0.0.17</span>
      </p>
    </td>
    
    <td style="width: 25.36%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="25%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">tomcat</span>
      </p>
    </td>
    
    <td style="width: 46.46%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="46%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">CentOS Linux release 7.4.1708</span>
      </p>
    </td>
  </tr>
</table>

_<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">主机说明</span></span>_

<div class="cnblogs_code">
  <pre>[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /etc/redhat-release </span>
CentOS Linux release 7.4.1708<span style="color: #000000;"> (Core) 
[root@lb03 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> uname -a</span>
Linux lb03 3.10.0-693.el7.x86_64 <span style="color: #008000;">#</span><span style="color: #008000;">1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span>
[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> systemctl status firewalld.service </span>
● firewalld.service - firewalld -<span style="color: #000000;"> dynamic firewall daemon
   Loaded: loaded (</span>/usr/lib/systemd/system/<span style="color: #000000;">firewalld.service; disabled; vendor preset: enabled)
   Active: inactive (dead)
     Docs: man:firewalld(</span>1<span style="color: #000000;">)
[root@lb03 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> getenforce </span>
Disabled</pre>
</div>

_<span style="text-decoration: underline;"><span style="background: lime;">web</span></span>__<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">环境说明</span></span>_

<div class="cnblogs_code">
  <pre>[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> curl 10.0.0.17</span>
<span style="color: #000000;">web03
[root@lb03 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> curl 10.0.0.18</span>
web04</pre>
</div>

　　web服务器的搭建参照： Tomcat： <a href="/wp-content/themes/clsn-003/inc/go.php?url=%20http://www.cnblogs.com/clsn/p/7904611.html"  target="_blank">http://www.cnblogs.com/clsn/p/7904611.html</a>

　　　　　　　　　　　　　&nbsp; Nginx：<a href="/wp-content/themes/clsn-003/inc/go.php?url=%20http://www.cnblogs.com/clsn/p/7750615.html"  target="_blank">&nbsp;http://www.cnblogs.com/clsn/p/7750615.html</a>

### <span id="132_ipvsadm">1.3.2 <span style="font-family: '微软雅黑',sans-serif;">安装</span>ipvsadm<span style="font-family: '微软雅黑',sans-serif;">管理工具</span></span>

<p style="text-indent: 7.1pt;">
  <span style="font-family: 等线;">安装管理工具</span>
</p>

<div class="cnblogs_code">
  <pre>yum -y install ipvsadm</pre>
</div>

<p style="text-indent: 11.0pt;">
  <span style="font-family: 等线;">查看当前</span>LVS<span style="font-family: 等线;">状态，顺便激活</span>LVS<span style="font-family: 等线;">内核模块。</span>
</p>

<div class="cnblogs_code">
  <pre>ipvsadm</pre>
</div>

<p style="text-indent: 11.0pt;">
  <span style="font-family: 等线;">查看系统的</span>LVS<span style="font-family: 等线;">模块。</span>
</p>

<div class="cnblogs_code">
  <pre>[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> lsmod|grep ip_vs</span>
ip_vs_wrr              12697  1<span style="color: #000000;">
ip_vs                 </span>141092  3<span style="color: #000000;"> ip_vs_wrr
nf_conntrack          </span>133387  1<span style="color: #000000;"> ip_vs
libcrc32c              </span>12644  3 xfs,ip_vs,nf_conntrack</pre>
</div>

### <span id="133_LVS">1.3.3 LVS<span style="font-family: '微软雅黑',sans-serif;">集群搭建</span></span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="background-color: #00ffff;"><span style="font-family: '微软雅黑',sans-serif;">配置</span>LVS<span style="font-family: '微软雅黑',sans-serif;">负载均衡服务（<em><span style="text-decoration: underline;">在</span></em></span><em><span style="text-decoration: underline;">lb03</span></em><em><span style="text-decoration: underline;"><span style="font-family: '微软雅黑',sans-serif;">操作</span></span></em><span style="font-family: '微软雅黑',sans-serif;">）</span></span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>1<span style="font-family: '微软雅黑',sans-serif;">：在</span>eth0<span style="font-family: '微软雅黑',sans-serif;">网卡绑定</span>VIP<span style="font-family: '微软雅黑',sans-serif;">地址（</span>ip<span style="font-family: '微软雅黑',sans-serif;">）</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>2<span style="font-family: '微软雅黑',sans-serif;">：清除当前所有</span>LVS<span style="font-family: '微软雅黑',sans-serif;">规则（</span>-C<span style="font-family: '微软雅黑',sans-serif;">）</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>3<span style="font-family: '微软雅黑',sans-serif;">：设置</span>tcp<span style="font-family: '微软雅黑',sans-serif;">、</span>tcpfin<span style="font-family: '微软雅黑',sans-serif;">、</span>udp<span style="font-family: '微软雅黑',sans-serif;">链接超时时间（</span>--set<span style="font-family: '微软雅黑',sans-serif;">）</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>4<span style="font-family: '微软雅黑',sans-serif;">：添加虚拟服务（</span>-A<span style="font-family: '微软雅黑',sans-serif;">），</span>-t<span style="font-family: '微软雅黑',sans-serif;">指定虚拟服务的</span>IP<span style="font-family: '微软雅黑',sans-serif;">端口，</span>-s <span style="font-family: '微软雅黑',sans-serif;">指定调度算法</span> <span style="font-family: '微软雅黑',sans-serif;">调度算法见</span>man ipvsadm<span style="font-family: '微软雅黑',sans-serif;">，</span> rr wrr <span style="font-family: '微软雅黑',sans-serif;">权重轮询</span> -p <span style="font-family: '微软雅黑',sans-serif;">指定超时时间</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>5<span style="font-family: '微软雅黑',sans-serif;">：将虚拟服务关联到真实服务上（</span>-a<span style="font-family: '微软雅黑',sans-serif;">）</span> -r<span style="font-family: '微软雅黑',sans-serif;">指定真实服务的</span>IP<span style="font-family: '微软雅黑',sans-serif;">端口</span> -g LVS<span style="font-family: '微软雅黑',sans-serif;">的模式</span> DR<span style="font-family: '微软雅黑',sans-serif;">模式</span> -w <span style="font-family: '微软雅黑',sans-serif;">指定权重</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>6<span style="font-family: '微软雅黑',sans-serif;">：查看配置结果（</span>-ln<span style="font-family: '微软雅黑',sans-serif;">）</span>
  </p>
</div>

**_<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">命令集</span></span>_****<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">：</span></span>**

<div class="cnblogs_code">
  <pre>ip addr add 10.0.0.13/24<span style="color: #000000;"> dev eth0
ipvsadm </span>-<span style="color: #000000;">C                    
ipvsadm </span>--set 30 5 60<span style="color: #000000;">         
ipvsadm </span>-A -t 10.0.0.13:80 -s wrr -p 20<span style="color: #000000;">   
ipvsadm </span>-a -t 10.0.0.13:80 -r 10.0.0.17:80 -g -w 1<span style="color: #000000;"> 
ipvsadm </span>-a -t 10.0.0.13:80 -r 10.0.0.18:80 -g -w 1<span style="color: #000000;">
ipvsadm </span>-ln</pre>
</div>

**_<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">检查结果</span></span>_****<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">：</span></span>**

<div class="cnblogs_code">
  <pre>[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ipvsadm -ln</span>
IP Virtual Server version 1.2.1 (size=4096<span style="color: #000000;">)
Prot LocalAddress:Port Scheduler Flags
  </span>-><span style="color: #000000;"> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  </span>10.0.0.13:80 wrr persistent 20
  -> 10.0.0.17:80                 Route   1<span style="color: #000000;">      0          0  
  </span>-> 10.0.0.18:80                 Route   1      0          0   </pre>
</div>

**_<span style="text-decoration: underline;"><span style="background: aqua;">ipvsadm</span></span>_****_<span style="text-decoration: underline;"><span style="font-family: 等线; background: aqua;">参数说明：</span></span>_<span style="text-decoration: underline;"><span style="background: aqua;">(</span></span>****<span style="text-decoration: underline;"><span style="font-family: 等线; background: aqua;">更多参照</span><span style="background: aqua;"> man ipvsadm)</span></span>**

<table style="width: 100%; border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 12.16%; border-top: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: 1pt solid #4472c4; border-right: none; background: #4472c4; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="color: #ffffff;"><strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">参数</span></strong></span>
      </p>
      
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="color: #ffffff;"><strong><em><span style="font-size: 10pt; font-family: 'Times New Roman', serif;">(</span></em></strong><strong><em><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">短格式</span></em></strong><strong><em><span style="font-size: 10pt; font-family: 'Times New Roman', serif;">)</span></em></strong></span>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: solid #4472C4 1.0pt; border-left: none; border-bottom: solid #4472C4 1.0pt; border-right: none; background: #4472C4; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="color: #ffffff;"><strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">参数</span></strong></span>
      </p>
      
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="color: #ffffff;"><strong><em><span style="font-size: 10pt; font-family: 'Times New Roman', serif;">(</span></em></strong><strong><em><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">长格式</span></em></strong><strong><em><span style="font-size: 10pt; font-family: 'Times New Roman', serif;">)</span></em></strong></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: 1pt solid #4472c4; border-right: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: none; background: #4472c4; padding: 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <span style="color: #ffffff;"><strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">参数说明</span></strong></span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-A</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--add-service</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">在内核的虚拟服务器表中添加一条新的虚拟服务器记录。也就是增加一台新的虚拟服务器。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-E</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--edit-service</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">编辑内核虚拟服务器表中的一条虚拟服务器记录。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-D</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--delete-service</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">删除内核虚拟服务器表中的一条虚拟服务器记录。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-C</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--clear</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">清除内核虚拟服务器表中的所有记录。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-R</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--restore</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">恢复虚拟服务器规则</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-S</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--save</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">保存虚拟服务器规则，输出为</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-R </span><span style="font-size: 10.0pt; font-family: 宋体;">选项可读的格式</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-a</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--add-server</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">在内核虚拟服务器表的一条记录里添加一条新的真实服务器记录。也就是在一个虚拟服务器中增加一台新的真实服务器</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-e</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--edit-server</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">编辑一条虚拟服务器记录中的某条真实服务器记录</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-d</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--delete-server</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">删除一条虚拟服务器记录中的某条真实服务器记录</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-L|-l</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--list</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示内核虚拟服务器表</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-Z</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--zero</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">虚拟服务表计数器清零（清空当前的连接数量等）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--set<em> tcp tcpfin udp</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">设置连接超时值</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--start-daemon</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">启动同步守护进程。他后面可以是</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">master </span><span style="font-size: 10.0pt; font-family: 宋体;">或</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">backup</span><span style="font-size: 10.0pt; font-family: 宋体;">，用来说明</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">LVS Router </span><span style="font-size: 10.0pt; font-family: 宋体;">是</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">master </span><span style="font-size: 10.0pt; font-family: 宋体;">或是</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">backup</span><span style="font-size: 10.0pt; font-family: 宋体;">。在这个功能上也可以采用</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">keepalived </span><span style="font-size: 10.0pt; font-family: 宋体;">的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">VRRP </span><span style="font-size: 10.0pt; font-family: 宋体;">功能。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--stop-daemon</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">停止同步守护进程</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-h</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--help </span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示帮助信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-t</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--tcp-service <em>service-address [vip:port] or [real-server-ip:port]</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">说明虚拟服务器提供的是</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">tcp </span><span style="font-size: 10.0pt; font-family: 宋体;">的服务</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-u</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--udp-service <em>service-address [vip:port] or [real-server-ip:port]</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">说明虚拟服务器提供的是</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">udp </span><span style="font-size: 10.0pt; font-family: 宋体;">的服务</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-f</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--fwmark-service <em>fwmark</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">说明是经过</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">iptables </span><span style="font-size: 10.0pt; font-family: 宋体;">标记过的服务类型。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-s</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--scheduler <em>scheduler</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">使用的调度算法，有这样几个选项</span>
      </p>
      
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">rr|wrr|lc|wlc|lblc|lblcr|dh|sh|sed|nq</span>
      </p>
      
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">默认的调度算法是：</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;"> wlc</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-p</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--persistent <em>[timeout]</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">持久稳固的服务。这个选项的意思是来自同一个客户的多次请求，将被同一台真实的服务器处理。</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">timeout </span><span style="font-size: 10.0pt; font-family: 宋体;">的默认值为</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">300</span><span style="font-size: 10.0pt; font-family: 宋体;">秒。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-M</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--netmask netmask</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">persistent granularity mask</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-r</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--real-server <em>server-address</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">真实的服务器</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">[Real-Server:port]</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-g</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--gatewaying</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">指定</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">LVS </span><span style="font-size: 10.0pt; font-family: 宋体;">的工作模式为直接路由模式（也是</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">LVS </span><span style="font-size: 10.0pt; font-family: 宋体;">默认的模式）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-i</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--ipip</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">指定</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">LVS </span><span style="font-size: 10.0pt; font-family: 宋体;">的工作模式为隧道模式</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-m</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--masquerading</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">指定</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">LVS </span><span style="font-size: 10.0pt; font-family: 宋体;">的工作模式为</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">NAT </span><span style="font-size: 10.0pt; font-family: 宋体;">模式</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-w</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--weight <em>weight</em></span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">真实服务器的权值</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--mcast-interface</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">interface </span><span style="font-size: 10.0pt; font-family: 宋体;">指定组播的同步接口</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-c</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--connection</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">LVS </span><span style="font-size: 10.0pt; font-family: 宋体;">目前的连接</span> <span style="font-size: 10.0pt; font-family: 宋体;">如：</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ipvsadm -L -c</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--timeout&nbsp;&nbsp;&nbsp; </span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">tcp tcpfin udp </span><span style="font-size: 10.0pt; font-family: 宋体;">的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">timeout </span><span style="font-size: 10.0pt; font-family: 宋体;">值</span> <span style="font-size: 10.0pt; font-family: 宋体;">如：</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ipvsadm -L --timeout</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--daemon&nbsp;&nbsp;&nbsp;&nbsp; </span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示同步守护进程状态</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--stats&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示统计信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--rate&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">显示速率信息</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--sort&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">对虚拟服务器和真实服务器排序输出</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">-</span></strong>
      </p>
    </td>
    
    <td style="width: 31.18%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="31%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">--numeric -n</span>
      </p>
    </td>
    
    <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">输出</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP </span><span style="font-size: 10.0pt; font-family: 宋体;">地址和端口的数字形式</span>
      </p>
    </td>
  </tr>
</table>

### <span id="134_web">1.3.4 <span style="font-family: '微软雅黑',sans-serif;">在</span>web<span style="font-family: '微软雅黑',sans-serif;">浏览器配置操作</span></span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>1<span style="font-family: '微软雅黑',sans-serif;">：在</span>lo<span style="font-family: '微软雅黑',sans-serif;">网卡绑定</span>VIP<span style="font-family: '微软雅黑',sans-serif;">地址（</span>ip<span style="font-family: '微软雅黑',sans-serif;">）</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">步骤</span>2<span style="font-family: '微软雅黑',sans-serif;">：修改内核参数抑制</span>ARP<span style="font-family: '微软雅黑',sans-serif;">响应</span>
  </p>
</div>

_<span style="text-decoration: underline;"><span style="font-family: 等线;">命令集</span></span>_<span style="text-decoration: underline;"><span style="font-family: 等线;">：</span></span>

<div class="cnblogs_code">
  <pre>ip addr add 10.0.0.13/32<span style="color: #000000;"> dev lo

cat </span>>>/etc/sysctl.conf&lt;&lt;<span style="color: #000000;">EOF
net.ipv4.conf.all.arp_ignore </span>= 1<span style="color: #000000;">
net.ipv4.conf.all.arp_announce </span>= 2<span style="color: #000000;">
net.ipv4.conf.lo.arp_ignore </span>= 1<span style="color: #000000;">
net.ipv4.conf.lo.arp_announce </span>= 2<span style="color: #000000;">
EOF
sysctl </span>-p</pre>
</div>

**_<span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">至此</span><span style="background: yellow;">LVS</span></span>_****_<span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">集群配置完毕</span></span>_****<span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">！</span></span>**

### <span id="135">1.3.5 <span style="font-family: '微软雅黑',sans-serif;">进行访问测试</span></span>

<p style="margin-left: 7.1pt; text-indent: 13.9pt;">
  <em><span style="text-decoration: underline;"><span style="font-family: 等线;">浏览器访问：</span></span></em>
</p>

<p style="text-align: center; text-indent: 7.1pt;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129151314144-587644970.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _<span style="text-decoration: underline;"><span style="font-family: 等线;">命令行测试：</span></span>_

<div class="cnblogs_code">
  <pre>[root@lb04 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> curl 10.0.0.13</span>
web03</pre>
</div>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _<span style="text-decoration: underline;"><span style="font-family: 等线;">抓包查看结果：</span></span>_

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129151335769-167618594.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _<span style="text-decoration: underline;">arp</span>__<span style="text-decoration: underline;"><span style="font-family: 等线;">解析查看：</span></span>_

<div class="cnblogs_code">
  <pre>[root@lb04 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> arp -n</span>
<span style="color: #000000;">Address                  HWtype  HWaddress           Flags Mask            Iface
</span>10.0.0.254               ether   00:50:56<span style="color: #000000;">:e9:9f:2c   C                     eth0
</span><span style="color: #00ff00;">10.0.0.18                ether   00:0c:29:ea:ca:55   C                     eth0
</span><span style="color: #ff9900;">10.0.0.13                ether   00:0c:29:de:7c:97   C                     eth0
</span>172.16.1.15              ether   00:0c:29<span style="color: #000000;">:de:7c:a1   C                     eth1
</span><span style="color: #ff9900;">10.0.0.17                ether   00:0c:29:4a:ac:4a   C                     eth0</span></pre>
</div>

## <span id="14_LVS">1.4 <span style="font-family: '微软雅黑',sans-serif;">负载均衡（</span>LVS<span style="font-family: '微软雅黑',sans-serif;">）相关名词</span></span>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129151421753-37861922.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

<p style="text-indent: 14.15pt;">
  <em><span style="text-decoration: underline;"><span style="font-family: 等线;">术语说明：</span></span></em>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">DS：Director Server。指的是前端负载均衡器节点。
RS：Real Server。后端真实的工作服务器。
VIP：向外部直接面向用户请求，作为用户请求的目标的IP地址。
DIP：Director Server IP，主要用于和内部主机通讯的IP地址。
RIP：Real Server IP，后端服务器的IP地址。
CIP：Client IP，访问客户端的IP地址。</span></pre>
</div>

### <span id="141_LVS--DR">1.4.1 LVS<span style="font-family: '微软雅黑',sans-serif;">集群的工作模式</span>--DR<span style="font-family: '微软雅黑',sans-serif;">直接路由模式</span></span>

<p style="text-indent: 21.0pt;">
  DR<span style="font-family: 等线;">模式是通过改写请求报文的目标</span>MAC<span style="font-family: 等线;">地址，将请求发给真实服务器的，而真实服务器将响应后的处理结果直接返回给客户端用户。</span>
</p>

<p style="text-indent: 21.0pt;">
  DR<span style="font-family: 等线;">技术可极大地提高集群系统的伸缩性。但要求调度器</span>LB<span style="font-family: 等线;">与真实服务器</span>RS<span style="font-family: 等线;">都有一块物理网卡连在同一物理网段上，即必须在同一局域网环境。</span>
</p>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129151443862-1890443677.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

_<span style="text-decoration: underline;"><span style="background: lime;">DR</span></span>__<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">直接路由模式说明：</span></span>_

<div class="cnblogs_Highlighter">
  <pre class="brush:python;gutter:true;">a)通过在调度器LB上修改数据包的目的MAC地址实现转发。注意，源IP地址仍然是CIP，目的IP地址仍然是VIP。
b)请求的报文经过调度器，而RS响应处理后的报文无需经过调度器LB，因此，并发访问量大时使用效率很高，比Nginx代理模式强于此处。
c)因DR模式是通过MAC地址的改写机制实现转发的，因此，所有RS节点和调度器LB只能在同一个局域网中。需要注意RS节点的VIP的绑定(lo:vip/32)和ARP抑制问题。
d)强调下：RS节点的默认网关不需要是调度器LB的DIP，而应该直接是IDC机房分配的上级路由器的IP(这是RS带有外网IP地址的情况)，理论上讲，只要RS可以出网即可，不需要必须配置外网IP，但走自己的网关，那网关就成为瓶颈了。
e)由于DR模式的调度器仅进行了目的MAC地址的改写，因此，调度器LB无法改变请求报文的目的端口。LVS DR模式的办公室在二层数据链路层（MAC），NAT模式则工作在三层网络层（IP）和四层传输层（端口）。
f)当前，调度器LB支持几乎所有UNIX、Linux系统，但不支持windows系统。真实服务器RS节点可以是windows系统。
g)总之，DR模式效率很高，但是配置也较麻烦。因此，访问量不是特别大的公司可以用haproxy/Nginx取代之。这符合运维的原则：简单、易用、高效。日1000-2000W PV或并发请求1万以下都可以考虑用haproxy/Nginx(LVS的NAT模式)
h)直接对外的访问业务，例如web服务做RS节点，RS最好用公网IP地址。如果不直接对外的业务，例如：MySQL，存储系统RS节点，最好只用内部IP地址。</pre>
</div>

<p style="text-indent: 7.1pt;">
  <strong><span style="background: lime;">DR</span></strong><strong><span style="font-family: 等线; background: lime;">的实现原理和数据包的改变</span></strong>
</p>

<p style="text-align: center; text-indent: 7.1pt;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129153425472-1160889800.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />&nbsp;
</p>

<div class="cnblogs_Highlighter">
  <pre class="brush:python;gutter:true;">(a) 当用户请求到达Director Server，此时请求的数据报文会先到内核空间的PREROUTING链。 此时报文的源IP为CIP，目标IP为VIP
(b) PREROUTING检查发现数据包的目标IP是本机，将数据包送至INPUT链
(c) IPVS比对数据包请求的服务是否为集群服务，若是，将请求报文中的源MAC地址修改为DIP的MAC地址，将目标MAC地址修改RIP的MAC地址，然后将数据包发至POSTROUTING链。 此时的源IP和目的IP均未修改，仅修改了源MAC地址为DIP的MAC地址，目标MAC地址为RIP的MAC地址 
(d) 由于DS和RS在同一个网络中，所以是通过二层来传输。POSTROUTING链检查目标MAC地址为RIP的MAC地址，那么此时数据包将会发至Real Server。
(e) RS发现请求报文的MAC地址是自己的MAC地址，就接收此报文。处理完成之后，将响应报文通过lo接口传送给eth0网卡然后向外发出。 此时的源IP地址为VIP，目标IP为CIP 
(f) 响应报文最终送达至客户端</pre>
</div>

## <span id="15_web">1.5 <span style="font-family: '微软雅黑',sans-serif;">在</span>web<span style="font-family: '微软雅黑',sans-serif;">端的操作有什么含义？</span></span>

### <span id="151_RealServerloVIP">1.5.1 RealServer<span style="font-family: '微软雅黑',sans-serif;">为什么要在</span>lo<span style="font-family: '微软雅黑',sans-serif;">接口上配置</span>VIP<span style="font-family: '微软雅黑',sans-serif;">？</span></span>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">既然要让</span>RS<span style="font-family: 等线;">能够处理目标地址为</span>vip<span style="font-family: 等线;">的</span>IP<span style="font-family: 等线;">包，首先必须要让</span>RS<span style="font-family: 等线;">能接收到这个包。</span>
</p>

<span style="font-family: 等线;">　　在</span>lo<span style="font-family: 等线;">上配置</span>vip<span style="font-family: 等线;">能够完成接收包并将结果返回</span>client<span style="font-family: 等线;">。</span>

### <span id="152_eth0VIP">1.5.2 <span style="font-family: '微软雅黑',sans-serif;">在</span>eth0<span style="font-family: '微软雅黑',sans-serif;">网卡上配置</span>VIP<span style="font-family: '微软雅黑',sans-serif;">可以吗？</span></span>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">不可以，将</span>VIP<span style="font-family: 等线;">设置在</span>eth0<span style="font-family: 等线;">网卡上</span>,<span style="font-family: 等线;">会影响</span>RS<span style="font-family: 等线;">的</span>arp<span style="font-family: 等线;">请求</span>,<span style="font-family: 等线;">造成整体</span>LVS<span style="font-family: 等线;">集群</span>arp<span style="font-family: 等线;">缓</span><span style="font-family: 等线;">存表紊乱，以至于整个负载均衡集群都不能正常工作。</span>
</p>

### <span id="153_ARP">1.5.3 <span style="font-family: '微软雅黑',sans-serif;">为什么要抑制</span>ARP<span style="font-family: '微软雅黑',sans-serif;">响应？</span></span>

<p style="margin-left: 39.0pt; text-indent: -18.0pt;">
  <strong><span style="font-family: 宋体; background: yellow;">①&nbsp;</span></strong><strong><span style="font-family: 宋体; background: yellow;">arp</span></strong><strong><span style="font-family: 宋体; background: yellow;">协议说明</span></strong>
</p>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p style="text-indent: 21pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;">
    ARP<span style="font-family: '微软雅黑',sans-serif;">协议</span>,<span style="font-family: '微软雅黑',sans-serif;">全称</span>"Address Resolution Protocol",<span style="font-family: '微软雅黑',sans-serif;">中文名是地址解析协议，使用</span>ARP<span style="font-family: '微软雅黑',sans-serif;">协议可实现通过</span>IP<span style="font-family: '微软雅黑',sans-serif;">地址获得对应主机的物理地址</span>(MAC<span style="font-family: '微软雅黑',sans-serif;">地址</span>)<span style="font-family: '微软雅黑',sans-serif;">。</span>
  </p>
  
  <p style="text-indent: 21pt; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial;">
    ARP<span style="font-family: '微软雅黑',sans-serif;">协议要求通信的主机双方必须在同一个物理网段（即局域网环境）！</span>
  </p>
</div>

<p style="text-indent: 15.75pt;">
  <span style="font-family: 等线;">为了提高</span>IP<span style="font-family: 等线;">转换</span>MAC<span style="font-family: 等线;">的效率，系统会将解析结果保存下来，这个结果叫做</span>ARP<span style="font-family: 等线;">缓存。</span>
</p>

<div class="cnblogs_code">
  <pre>Windows查看ARP缓存命令 arp -<span style="color: #000000;">a
Linux查看ARP缓存命令 arp </span>-<span style="color: #000000;">n
Linux解析IP对应的MAC地址 arping </span>-c 1 -I eth0 10.0.0.6</pre>
</div>

_<span style="text-decoration: underline;"><span style="background: lime;">ARP</span></span>__<span style="text-decoration: underline;"><span style="font-family: 等线; background: lime;">缓存表是把双刃剑</span></span>_

<p style="margin-left: 63.0pt; text-indent: -21.0pt;">
  a)&nbsp;<span style="font-family: '微软雅黑',sans-serif;">主机有了</span>arp<span style="font-family: '微软雅黑',sans-serif;">缓存表，可以加快</span>ARP<span style="font-family: '微软雅黑',sans-serif;">的解析速度，减少局域网内广播风暴。因为</span>arp<span style="font-family: '微软雅黑',sans-serif;">是发广播解析的，频繁的解析也是消耗带宽的，尤其是机器多的时候。</span>
</p>

<p style="margin-left: 63.0pt; text-indent: -21.0pt;">
  b)&nbsp;<span style="font-family: '微软雅黑',sans-serif;">正是有了</span>arp<span style="font-family: '微软雅黑',sans-serif;">缓存表，给恶意黑客带来了攻击服务器主机的风险，这个就是</span>arp<span style="font-family: '微软雅黑',sans-serif;">欺骗攻击。</span>
</p>

<p style="margin-left: 63.0pt; text-indent: -21.0pt;">
  c)&nbsp;<span style="font-family: '微软雅黑',sans-serif;">切换路由器，负载均衡器等设备时，可能会导致短时网络中断。因为所有的客户端</span>ARP<span style="font-family: '微软雅黑',sans-serif;">缓存表没有更新</span>
</p>

<p style="margin-left: 21.0pt;">
  <strong><span style="font-family: 宋体; background: yellow;">②</span></strong><strong><span style="font-family: 等线; background: yellow;">服务器切换</span><span style="background: yellow;">ARP</span></strong><strong><span style="font-family: 等线; background: yellow;">问题</span></strong>
</p>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">　　当集群中一台提供服务的</span>lb01<span style="font-family: '微软雅黑',sans-serif;">机器宕机后，然后</span>VIP<span style="font-family: '微软雅黑',sans-serif;">会转移到备机</span>lb02<span style="font-family: '微软雅黑',sans-serif;">上，但是客户端的</span>ARP<span style="font-family: '微软雅黑',sans-serif;">缓存表的地址解析还是宕机的</span>lb01<span style="font-family: '微软雅黑',sans-serif;">的</span>MAC<span style="font-family: '微软雅黑',sans-serif;">地址。从而导致，即使在</span>lb02<span style="font-family: '微软雅黑',sans-serif;">上添加</span>VIP<span style="font-family: '微软雅黑',sans-serif;">，也会发生客户端无法访问的情况。</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">　　解决办法是：当</span>lb01<span style="font-family: '微软雅黑',sans-serif;">宕机，</span>VIP<span style="font-family: '微软雅黑',sans-serif;">地址迁移到</span>lb02<span style="font-family: '微软雅黑',sans-serif;">时，需要通过</span>arping<span style="font-family: '微软雅黑',sans-serif;">命令通知所有网络内机器更新本地的</span>ARP<span style="font-family: '微软雅黑',sans-serif;">缓存表，从而使得客户机访问时重新广播获取</span>MAC<span style="font-family: '微软雅黑',sans-serif;">地址。</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">　　这个是自己开发服务器高可用脚本及所有高可用软件必须考虑到的问题。</span>
  </p>
</div>

<p style="text-indent: 11.0pt;">
  <em><span style="text-decoration: underline;">ARP</span></em><em><span style="text-decoration: underline;"><span style="font-family: 等线;">广播进行新的地址解析</span></span></em>
</p>

<div class="cnblogs_code">
  <pre>arping -I eth0 -c 1 -<span style="color: #000000;">U VIP
arping </span>-I eth0 -c 1 -U 10.0.0.13</pre>
</div>

<p style="text-indent: 11.0pt;">
  <em><span style="text-decoration: underline;"><span style="font-family: 等线;">测试命令</span></span></em>
</p>

<div class="cnblogs_code">
  <pre>ip addr <span style="color: #0000ff;">del</span> 10.0.0.13/24<span style="color: #000000;"> dev eth0
ip addr add </span>10.0.0.13/24<span style="color: #000000;"> dev eth0
ip addr show eth0
arping </span>-I eth0 -c 1 -U 10.0.0.13</pre>
</div>

<p style="text-indent: 15.75pt;">
  windows<span style="font-family: 等线;">查看</span>arp -a
</p>

<div class="cnblogs_code">
  <pre>接口: 10.0.0.1 --- 0x12<span style="color: #000000;">
  Internet 地址         物理地址              类型
  </span>10.0.0.13             00-0c-29-de-7c-97<span style="color: #000000;">     动态       
  </span>10.0.0.15             00-0c-29-de-7c-97<span style="color: #000000;">     动态       
  </span>10.0.0.16             00-0c-29-2e-47-20<span style="color: #000000;">     动态       
  </span>10.0.0.17             00-0c-29-4a-ac-<span style="color: #000000;">4a     动态       
  </span>10.0.0.18             00-0c-29-ea-ca-55     动态        </pre>
</div>

<p style="text-indent: 15.75pt;">
  <strong><span style="font-family: 宋体; background: yellow;">③</span><span style="background: yellow;">arp_announce</span></strong><strong><span style="font-family: 等线; background: yellow;">和</span><span style="background: yellow;">arp_ignore</span></strong><strong><span style="font-family: 等线; background: yellow;">详解</span></strong>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;">  配置的内核参数</span>
net.ipv4.conf.all.arp_ignore = 1<span style="color: #000000;">
net.ipv4.conf.all.arp_announce </span>= 2<span style="color: #000000;">
net.ipv4.conf.lo.arp_ignore </span>= 1<span style="color: #000000;">
net.ipv4.conf.lo.arp_announce </span>= 2</pre>
</div>

<span style="text-decoration: underline;">lvs</span><span style="text-decoration: underline;"><span style="font-family: 等线;">在</span>DR</span><span style="text-decoration: underline;"><span style="font-family: 等线;">模式下需要关闭</span>arp</span><span style="text-decoration: underline;"><span style="font-family: 等线;">功能</span></span>

<p style="text-indent: 21.0pt;">
  <strong><em><span style="text-decoration: underline;"><span style="background: aqua;">arp_announce</span></span></em></strong>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">对网络接口上，本地</span>IP<span style="font-family: 等线;">地址的发出的，</span>ARP<span style="font-family: 等线;">回应，作出相应级别的限制</span>:
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">确定不同程度的限制</span>,<span style="font-family: 等线;">宣布对来自本地源</span>IP<span style="font-family: 等线;">地址发出</span>Arp<span style="font-family: 等线;">请求的接口</span>
</p>

<table style="width: 100%; border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 12.16%; border-top: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: 1pt solid #4472c4; border-right: none; background: #4472c4; padding: 0cm 5.4pt;" valign="top" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">数值</span></strong>
      </p>
    </td>
    
    <td style="width: 87.84%; border-top: 1pt solid #4472c4; border-right: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: none; background: #4472c4; padding: 0cm 5.4pt;" valign="top" width="87%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">含义</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">0(</span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体;">默认</span></strong><strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">)</span></strong>
      </p>
    </td>
    
    <td style="width: 87.84%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="87%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">在任意网络接口（</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">eth0,eth1</span><span style="font-size: 10.0pt; font-family: 宋体;">，</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">lo</span><span style="font-size: 10.0pt; font-family: 宋体;">）上的任何本地地址</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">1</span></strong>
      </p>
    </td>
    
    <td style="width: 87.84%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="87%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">尽量避免不在该网络接口子网段的本地地址做出</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">arp</span><span style="font-size: 10.0pt; font-family: 宋体;">回应</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">. </span><span style="font-size: 10.0pt; font-family: 宋体;">当发起</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ARP</span><span style="font-size: 10.0pt; font-family: 宋体;">请求的源</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">地址</span> <span style="font-size: 10.0pt; font-family: 宋体;">是被设置应该经由路由达到此网络接口的时候很有用</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">.</span><span style="font-size: 10.0pt; font-family: 宋体;">此时会检查来访</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">是否为所有接口</span> <span style="font-size: 10.0pt; font-family: 宋体;">上的子网段内</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ip</span><span style="font-size: 10.0pt; font-family: 宋体;">之一</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">.</span><span style="font-size: 10.0pt; font-family: 宋体;">如果改来访</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">不属于各个网络接口上的子网段内</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">,</span><span style="font-size: 10.0pt; font-family: 宋体;">那么将采用级别</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">2</span><span style="font-size: 10.0pt; font-family: 宋体;">的方式来进行处理</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">.</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 12.16%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="12%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">2</span></strong>
      </p>
    </td>
    
    <td style="width: 87.84%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="87%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">对查询目标使用最适当的本地地址</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">.</span><span style="font-size: 10.0pt; font-family: 宋体;">在此模式下将忽略这个</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">数据包的源地址并尝试</span> <span style="font-size: 10.0pt; font-family: 宋体;">选择与能与该地址通信的本地地址</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">.</span><span style="font-size: 10.0pt; font-family: 宋体;">首要是选择所有的网络接口的子网中外出访问子网中</span> <span style="font-size: 10.0pt; font-family: 宋体;">包含该目标</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">地址的本地地址</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">. </span><span style="font-size: 10.0pt; font-family: 宋体;">如果没有合适的地址被发现</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">,</span><span style="font-size: 10.0pt; font-family: 宋体;">将选择当前的发送网络接口</span> <span style="font-size: 10.0pt; font-family: 宋体;">或其他的有可能接受到该</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ARP</span><span style="font-size: 10.0pt; font-family: 宋体;">回应的网络接口来进行发送</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">.</span>
      </p>
    </td>
  </tr>
</table>

<p style="text-indent: 21.0pt;">
  <strong><em><span style="text-decoration: underline;"><span style="background: aqua;">arp_ignore</span></span></em></strong><strong><span style="font-family: 等线; color: white;">定义</span></strong>
</p>

<p style="text-indent: 21.0pt;">
  <strong><span style="font-family: 等线;">对目标地定义对目标地址为本地</span>IP</strong><strong><span style="font-family: 等线;">的</span>ARP</strong><strong><span style="font-family: 等线;">询问不同的应答模式</span></strong>
</p>

<table style="width: 100%; border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 16.22%; border-top: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: 1pt solid #4472c4; border-right: none; background: #4472c4; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">数值</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: 1pt solid #4472c4; border-right: 1pt solid #4472c4; border-bottom: 1pt solid #4472c4; border-left: none; background: #4472c4; padding: 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: center;" align="center">
        <strong><span style="font-size: 10.0pt; font-family: 宋体; times new roman"4times new roman";times new roman";color: white;">含义</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 16.22%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">0(</span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体;">默认值</span></strong><strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">)</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">回应任何网络接口上对任何本地</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">地址的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">arp</span><span style="font-size: 10.0pt; font-family: 宋体;">查询请求</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 16.22%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">1</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">只回答目标</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">地址是来访网络接口本地地址的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ARP</span><span style="font-size: 10.0pt; font-family: 宋体;">查询请求</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 16.22%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">2</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">只回答目标</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">地址是来访网络接口本地地址的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">ARP</span><span style="font-size: 10.0pt; font-family: 宋体;">查询请求</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">,</span><span style="font-size: 10.0pt; font-family: 宋体;">且来访</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">IP</span><span style="font-size: 10.0pt; font-family: 宋体;">必须在该网络接口的子网段内</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 16.22%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">3</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">不回应该网络界面的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">arp</span><span style="font-size: 10.0pt; font-family: 宋体;">请求，而只对设置的唯一和连接地址做出回应</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 16.22%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; background: #d9e2f3; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">4-7</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; background: #D9E2F3; padding: 0cm 5.4pt 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">保留未使用</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 16.22%; border-right: 1pt solid #8eaadb; border-bottom: 1pt solid #8eaadb; border-left: 1pt solid #8eaadb; border-top: none; padding: 0cm 5.4pt;" width="16%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">8</span></strong>
      </p>
    </td>
    
    <td style="width: 83.78%; border-top: none; border-left: none; border-bottom: solid #8EAADB 1.0pt; border-right: solid #8EAADB 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="83%">
      <p style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph;">
        <span style="font-size: 10.0pt; font-family: 宋体;">不回应所有（本地地址）的</span><span style="font-size: 10.0pt; font-family: 'Times New Roman',serif;">arp</span><span style="font-size: 10.0pt; font-family: 宋体;">查询</span>
      </p>
    </td>
  </tr>
</table>

<p style="text-indent: 21.0pt;">
  <strong><span style="font-family: 等线; background: aqua;">抑制</span><span style="background: aqua;">RS</span></strong><strong><span style="font-family: 等线; background: aqua;">端</span><span style="background: aqua;">arp</span></strong><strong><span style="font-family: 等线; background: aqua;">前的广播情况</span></strong>
</p>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154133128-1220483931.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />&nbsp;
</p>

<p style="text-indent: 21.0pt;">
  <strong><span style="font-family: 等线; background: aqua;">抑制</span><span style="background: aqua;">RS</span></strong><strong><span style="font-family: 等线; background: aqua;">端</span><span style="background: aqua;">arp</span></strong><strong><span style="font-family: 等线; background: aqua;">后广播情况</span></strong>
</p>

<p style="text-align: center;" align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154143331-1661937731.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

## <span id="16_LVS">1.6 LVS<span style="font-family: '微软雅黑',sans-serif;">集群的工作模式</span></span>

<div class="cnblogs_Highlighter">
  <pre class="brush:python;gutter:false;">DR（Direct Routing）直接路由模式
NAT（Network Address Translation）
TUN（Tunneling）隧道模式
FULLNAT（Full Network Address Translation）</pre>
</div>

### <span id="161_LVS--NAT">1.6.1 LVS<span style="font-family: '微软雅黑',sans-serif;">集群的工作模式</span>--NAT</span>

<h3 style="text-align: center;">
  <span id="nbsp"><img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154211503-5626597.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />&nbsp;</span>
</h3>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">通过网络地址转换，调度器</span>LB<span style="font-family: 等线;">重写请求报文的目标地址，根据预设的调度算法，将请求分派给后端的真实服务器，真实服务器的响应报文处理之后，返回时必须要通过调度器，经过调度器时报文的源地址被重写，再返回给客户，完成整个负载调度过程。</span>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">收费站模式</span>---<span style="font-family: 等线;">来去都要经过</span>LB<span style="font-family: 等线;">负载均衡器。</span>
</p>

**<span style="background: lime;">NAT</span>****<span style="font-family: 等线; background: lime;">方式的实现原理和数据包的改变</span>**

<p style="text-align: center;" align="center">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154235128-81782361.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

<div class="cnblogs_Highlighter">
  <pre class="brush:python;gutter:false;">(a). 当用户请求到达Director Server，此时请求的数据报文会先到内核空间的PREROUTING链。 此时报文的源IP为CIP，目标IP为VIP
(b). PREROUTING检查发现数据包的目标IP是本机，将数据包送至INPUT链
(c). IPVS比对数据包请求的服务是否为集群服务，若是，修改数据包的目标IP地址为后端服务器IP，然后将数据包发至POSTROUTING链。 此时报文的源IP为CIP，目标IP为RIP
(d). POSTROUTING链通过选路，将数据包发送给Real Server
(e). Real Server比对发现目标为自己的IP，开始构建响应报文发回给Director Server。 此时报文的源IP为RIP，目标IP为CIP
(f). Director Server在响应客户端前，此时会将源IP地址修改为自己的VIP地址，然后响应给客户端。 此时报文的源IP为VIP，目标IP为CIP</pre>
</div>

**LVS-NAT****<span style="font-family: 等线;">模型的特性</span>**

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span>RS<span style="font-family: '微软雅黑',sans-serif;">应该使用私有地址，</span>RS<span style="font-family: '微软雅黑',sans-serif;">的网关必须指向</span>DIP
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span>DIP<span style="font-family: '微软雅黑',sans-serif;">和</span>RIP<span style="font-family: '微软雅黑',sans-serif;">必须在同一个网段内</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">请求和响应报文都需要经过</span>Director Server<span style="font-family: '微软雅黑',sans-serif;">，高负载场景中，</span>Director Server<span style="font-family: '微软雅黑',sans-serif;">易成为性能瓶颈</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">支持端口映射</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span>RS<span style="font-family: '微软雅黑',sans-serif;">可以使用任意操作系统</span>
</p>

<p style="margin-left: 42.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">缺陷：对</span>Director Server<span style="font-family: '微软雅黑',sans-serif;">压力会比较大，请求和响应都需经过</span>director server
</p>

### <span id="162_LVS--TUN">1.6.2 LVS<span style="font-family: '微软雅黑',sans-serif;">集群的工作模式</span>--<span style="font-family: '微软雅黑',sans-serif;">隧道模式</span>TUN</span>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154311034-399852197.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">采用</span>NAT<span style="font-family: 等线;">技术时，由于请求和响应的报文都必须经过调度器地址重写，当客户请求越来越多时，调度器的处理能力将成为瓶颈，为了解决这个问题，调度器把请求的报文通过</span>IP<span style="font-family: 等线;">隧道</span>(<span style="font-family: 等线;">相当于</span>ipip<span style="font-family: 等线;">或</span>ipsec )<span style="font-family: 等线;">转发至真实服务器，而真实服务器将响应处理后直接返回给客户端用户，这样调度器就只处理请求的入站报文。由于一般网络服务应答数据比请求报文大很多，采用</span> VS/TUN<span style="font-family: 等线;">技术后，集群系统的最大吞吐量可以提高</span>10<span style="font-family: 等线;">倍。</span>
</p>

<p style="text-indent: 21.0pt;">
  VS/TUN<span style="font-family: 等线;">工作流程</span>,<span style="font-family: 等线;">它的连接调度和管理与</span>VS/NAT<span style="font-family: 等线;">中的一样，只是它的报文转发方法不同。调度器根据各个服务器的负载情况，连接数多少，动态地选择一台服务器，将原请求的报文封装在另一个</span>IP<span style="font-family: 等线;">报文中，再将封装后的</span>IP<span style="font-family: 等线;">报文转发给选出的真实服务器；真实服务器收到报文后，先将收到的报文解封获得原来目标地址为</span>VIP<span style="font-family: 等线;">地址的报文</span>, <span style="font-family: 等线;">服务器发现</span>VIP<span style="font-family: 等线;">地址被配置在本地的</span>IP<span style="font-family: 等线;">隧道设备上</span>(<span style="font-family: 等线;">此处要人为配置</span>)<span style="font-family: 等线;">，所以就处理这个请求，然后根据路由表将响应报文直接返回给客户。</span>
</p>

<p style="text-indent: 21.0pt;">
  <strong><span style="background: lime;">TUN</span></strong><strong><span style="font-family: 等线; background: lime;">原理和数据包的改变</span></strong>
</p>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154326034-199344942.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

<div class="cnblogs_Highlighter">
  <pre class="brush:python;gutter:false;">(a) 当用户请求到达Director Server，此时请求的数据报文会先到内核空间的PREROUTING链。 此时报文的源IP为CIP，目标IP为VIP 。
(b) PREROUTING检查发现数据包的目标IP是本机，将数据包送至INPUT链
(c) IPVS比对数据包请求的服务是否为集群服务，若是，在请求报文的首部再次封装一层IP报文，封装源IP为为DIP，目标IP为RIP。然后发至POSTROUTING链。 此时源IP为DIP，目标IP为RIP
(d) POSTROUTING链根据最新封装的IP报文，将数据包发至RS（因为在外层封装多了一层IP首部，所以可以理解为此时通过隧道传输）。 此时源IP为DIP，目标IP为RIP
(e) RS接收到报文后发现是自己的IP地址，就将报文接收下来，拆除掉最外层的IP后，会发现里面还有一层IP首部，而且目标是自己的lo接口VIP，那么此时RS开始处理此请求，处理完成之后，通过lo接口送给eth0网卡，然后向外传递。 此时的源IP地址为VIP，目标IP为CIP
(f) 响应报文最终送达至客户端</pre>
</div>

LVS-Tun<span style="font-family: 等线;">模型特性</span>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span>RIP<span style="font-family: '微软雅黑',sans-serif;">、</span>VIP<span style="font-family: '微软雅黑',sans-serif;">、</span>DIP<span style="font-family: '微软雅黑',sans-serif;">全是公网地址</span>
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span>RS<span style="font-family: '微软雅黑',sans-serif;">的网关不会也不可能指向</span>DIP
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">所有的请求报文经由</span>Director Server<span style="font-family: '微软雅黑',sans-serif;">，但响应报文必须不能进过</span>Director Server
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">不支持端口映射</span>
</p>

<p style="margin-left: 45.0pt; text-indent: -21.0pt;">
  <span style="font-family: Wingdings;">l&nbsp;</span>RS<span style="font-family: '微软雅黑',sans-serif;">的系统必须支持隧道</span>
</p>

### <span id="163_LVS--FULLNAT">1.6.3 LVS<span style="font-family: '微软雅黑',sans-serif;">集群的工作模式</span>--FULLNAT</span>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154358034-1107503185.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" />
</p>

<p style="text-indent: 21.0pt;">
  LVS<span style="font-family: 等线;">的</span>DR<span style="font-family: 等线;">和</span>NAT<span style="font-family: 等线;">模式要求</span>RS<span style="font-family: 等线;">和</span>LVS<span style="font-family: 等线;">在同一个</span>vlan<span style="font-family: 等线;">中，导致部署成本过高；</span>TUNNEL<span style="font-family: 等线;">模式虽然可以跨</span>vlan<span style="font-family: 等线;">，但</span>RealServer<span style="font-family: 等线;">上需要部署</span>ipip<span style="font-family: 等线;">隧道模块等，网络拓扑上需要连通外网，较复杂，不易运维。</span>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">为了解决上述问题，开发出</span>FULLNAT<span style="font-family: 等线;">，该模式和</span>NAT<span style="font-family: 等线;">模式的区别是：数据包进入时，除了做</span>DNAT<span style="font-family: 等线;">，还做</span>SNAT<span style="font-family: 等线;">（用户</span>ip-><span style="font-family: 等线;">内网</span>ip<span style="font-family: 等线;">），从而实现</span>LVS-RealServer<span style="font-family: 等线;">间可以跨</span>vlan<span style="font-family: 等线;">通讯，</span>RealServer<span style="font-family: 等线;">只需要连接到内网。</span>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">类比地铁站多个闸机。</span>
</p>

## <span id="17_IPVS">1.7 IPVS<span style="font-family: '微软雅黑',sans-serif;">调度器实现了如下八种负载调度算法：</span></span>

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　a)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">轮询（</span>Round Robin</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span>RR</strong>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">调度器通过</span>"<span style="font-family: 等线;">轮叫</span>"<span style="font-family: 等线;">调度算法将外部请求按顺序轮流分配到集群中的真实服务器上，它均等地对待每一台服务器，而不管服务器上实际的连接数和系统负载。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　b)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">加权轮叫（</span>Weighted Round Robin</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span>WRR</strong>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">调度器通过</span>"<span style="font-family: 等线;">加权轮叫</span>"<span style="font-family: 等线;">调度算法根据真实服务器的不同处理能力来调度访问请求。这样可以保证处理能力强的服务器处理更多的访问流量。调度器可以自动问询真实服务器的负载情况，并动态地调整其权值。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　c)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">最少链接（</span>Least Connections</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span> LC</strong>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">调度器通过</span>"<span style="font-family: 等线;">最少连接</span>"<span style="font-family: 等线;">调度算法动态地将网络请求调度到已建立的链接数最少的服务器上。如果集群系统的真实服务器具有相近的系统性能，采用</span>"<span style="font-family: 等线;">最小连接</span>"<span style="font-family: 等线;">调度算法可以较好地均衡负载。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　d)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">加权最少链接（</span>Weighted Least Connections</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span> Wlc</strong>
</p>

<p style="text-indent: 21.0pt;">
  <span style="font-family: 等线;">在集群系统中的服务器性能差异较大的情况下，调度器采用</span>"<span style="font-family: 等线;">加权最少链接</span>"<span style="font-family: 等线;">调度算法优化负载均衡性能，具有较高权值的服务器将承受较大比例的活动连接负载。调度器可以自动问询真实服务器的负载情况，并动态地调整其权值。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　e)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">基于局部性的最少链接（</span>Locality-Based Least Connections</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span> Lblc</strong>
</p>

<p style="text-indent: 21.0pt;">
  "<span style="font-family: 等线;">基于局部性的最少链接</span>" <span style="font-family: 等线;">调度算法是针对目标</span>IP<span style="font-family: 等线;">地址的负载均衡，目前主要用于</span>Cache<span style="font-family: 等线;">集群系统。该算法根据请求的目标</span>IP<span style="font-family: 等线;">地址找出该目标</span>IP<span style="font-family: 等线;">地址最近使用的服务器，若该服务器</span> <span style="font-family: 等线;">是可用的且没有超载，将请求发送到该服务器；若服务器不存在，或者该服务器超载且有服务器处于一半的工作负载，则用</span>"<span style="font-family: 等线;">最少链接</span>"<span style="font-family: 等线;">的原则选出一个可用的服务</span> <span style="font-family: 等线;">器，将请求发送到该服务器。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　f)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">带复制的基于局部性最少链接（</span>Locality-Based Least Connections with Replication</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span> </strong>
</p>

<p style="text-indent: 21.0pt;">
  "<span style="font-family: 等线;">带复制的基于局部性最少链接</span>"<span style="font-family: 等线;">调度算法也是针对目标</span>IP<span style="font-family: 等线;">地址的负载均衡，目前主要用于</span>Cache<span style="font-family: 等线;">集群系统。它与</span>LBLC<span style="font-family: 等线;">算法的不同之处是它要维护从一个</span> <span style="font-family: 等线;">目标</span>IP<span style="font-family: 等线;">地址到一组服务器的映射，而</span>LBLC<span style="font-family: 等线;">算法维护从一个目标</span>IP<span style="font-family: 等线;">地址到一台服务器的映射。该算法根据请求的目标</span>IP<span style="font-family: 等线;">地址找出该目标</span>IP<span style="font-family: 等线;">地址对应的服务</span> <span style="font-family: 等线;">器组，按</span>"<span style="font-family: 等线;">最小连接</span>"<span style="font-family: 等线;">原则从服务器组中选出一台服务器，若服务器没有超载，将请求发送到该服务器，若服务器超载；则按</span>"<span style="font-family: 等线;">最小连接</span>"<span style="font-family: 等线;">原则从这个集群中选出一</span> <span style="font-family: 等线;">台服务器，将该服务器加入到服务器组中，将请求发送到该服务器。同时，当该服务器组有一段时间没有被修改，将最忙的服务器从服务器组中删除，以降低复制的</span> <span style="font-family: 等线;">程度。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　g)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">目标地址散列（</span>Destination Hashing</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span> Dh</strong>
</p>

<p style="text-indent: 21.0pt;">
  "<span style="font-family: 等线;">目标地址散列</span>"<span style="font-family: 等线;">调度算法根据请求的目标</span>IP<span style="font-family: 等线;">地址，作为散列键（</span>Hash Key<span style="font-family: 等线;">）从静态分配的散列表找出对应的服务器，若该服务器是可用的且未超载，将请求发送到该服务器，否则返回空。</span>
</p>

&nbsp;

<p style="margin-left: 21.0pt; text-indent: -21.0pt;">
  <strong>　　h)&nbsp;</strong><strong><span style="font-family: '微软雅黑',sans-serif;">源地址散列（</span>Source Hashing</strong><strong><span style="font-family: '微软雅黑',sans-serif;">）</span>SH</strong>
</p>

"<span style="font-family: 等线;">源地址散列</span>"<span style="font-family: 等线;">调度算法根据请求的源</span>IP<span style="font-family: 等线;">地址，作为散列键（</span>Hash Key<span style="font-family: 等线;">）从静态分配的散列表找出对应的服务器，若该服务器是可用的且未超载，将请求发送到该服务器，否则返回空。</span>

## <span id="18_LVSKeepalived">1.8 LVS+Keepalived<span style="font-family: '微软雅黑',sans-serif;">方案实现</span></span>

### <span id="181_keepalived">1.8.1 keepalived<span style="font-family: '微软雅黑',sans-serif;">功能</span></span>

<p style="margin-left: 33.0pt;">
  1. <span style="font-family: 等线;">添加</span>VIP
</p>

<p style="margin-left: 33.0pt;">
  2. <span style="font-family: 等线;">添加</span>LVS<span style="font-family: 等线;">配置</span>
</p>

<p style="margin-left: 33.0pt;">
  3. <span style="font-family: 等线;">高可用（</span>VIP<span style="font-family: 等线;">漂移）</span>
</p>

<p style="margin-left: 33.0pt;">
  4. web<span style="font-family: 等线;">服务器健康检查</span>
</p>

### <span id="182_Keepalived">1.8.2 <span style="font-family: '微软雅黑',sans-serif;">在负载器安装</span>Keepalived<span style="font-family: '微软雅黑',sans-serif;">软件</span></span>

<div class="cnblogs_code">
  <pre>yum -y install keepalived</pre>
</div>

\# <span style="font-family: 等线;">检查软件是否安装</span>

<div class="cnblogs_code">
  <pre>[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpm -qa keepalived</span>
keepalived-1.3.5-1.el7.x86_64</pre>
</div>

### <span id="183">1.8.3 <span style="font-family: '微软雅黑',sans-serif;">修改配置文件</span></span>

<p style="margin-left: 7.1pt;">
  <em><span style="text-decoration: underline;"><span style="background: yellow;">lb03</span></span></em><em><span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">上</span><span style="background: yellow;">keepalied</span></span></em><em><span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">配置文件</span></span></em>
</p>

<div class="cnblogs_code" onclick="cnblogs_code_show('bd4d2e07-e9ad-48e3-950d-5b59ba57685c')">
  <img id="code_img_closed_bd4d2e07-e9ad-48e3-950d-5b59ba57685c" class="code_img_closed" src="https://clsn.io/wp-content/uploads/2018/03/ContractedBlock-14.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" /><img id="code_img_opened_bd4d2e07-e9ad-48e3-950d-5b59ba57685c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('bd4d2e07-e9ad-48e3-950d-5b59ba57685c',event)" data-original="https://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-14.gif" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" /></p> 
  
  <div id="cnblogs_code_open_bd4d2e07-e9ad-48e3-950d-5b59ba57685c" class="cnblogs_code_hide">
    <pre><span style="color: #008080;"> 1</span> [root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /etc/keepalived/keepalived.conf</span>
<span style="color: #008080;"> 2</span> <span style="color: #000000;">global_defs {
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">   router_id LVS_01
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #000000;">vrrp_instance VI_1 {
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    state MASTER
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    interface eth0
</span><span style="color: #008080;"> 9</span>     virtual_router_id 51
<span style="color: #008080;">10</span>     priority 150
<span style="color: #008080;">11</span>     advert_int 1
<span style="color: #008080;">12</span> <span style="color: #000000;">    authentication {
</span><span style="color: #008080;">13</span> <span style="color: #000000;">        auth_type PASS
</span><span style="color: #008080;">14</span>         auth_pass 1111
<span style="color: #008080;">15</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    virtual_ipaddress {
</span><span style="color: #008080;">17</span>      10.0.0.13/24
<span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span> <span style="color: #000000;">}
</span><span style="color: #008080;">20</span> 
<span style="color: #008080;">21</span> virtual_server 10.0.0.13 80<span style="color: #000000;"> {
</span><span style="color: #008080;">22</span>     delay_loop 6              
<span style="color: #008080;">23</span> <span style="color: #000000;">    lb_algo wrr                
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    lb_kind DR                
</span><span style="color: #008080;">25</span>     nat_mask 255.255.255.0
<span style="color: #008080;">26</span>     persistence_timeout 50     
<span style="color: #008080;">27</span> <span style="color: #000000;">    protocol TCP                
</span><span style="color: #008080;">28</span> 
<span style="color: #008080;">29</span>     real_server 10.0.0.17 80<span style="color: #000000;"> {
</span><span style="color: #008080;">30</span>         weight 1              
<span style="color: #008080;">31</span> <span style="color: #000000;">        TCP_CHECK {
</span><span style="color: #008080;">32</span>         connect_timeout 8       
<span style="color: #008080;">33</span>         nb_get_retry 3
<span style="color: #008080;">34</span>         delay_before_retry 3
<span style="color: #008080;">35</span>         connect_port 80
<span style="color: #008080;">36</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">37</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">38</span> 
<span style="color: #008080;">39</span>     real_server 10.0.0.18 80<span style="color: #000000;"> {
</span><span style="color: #008080;">40</span>         weight 1              
<span style="color: #008080;">41</span> <span style="color: #000000;">        TCP_CHECK {
</span><span style="color: #008080;">42</span>         connect_timeout 8       
<span style="color: #008080;">43</span>         nb_get_retry 3
<span style="color: #008080;">44</span>         delay_before_retry 3
<span style="color: #008080;">45</span>         connect_port 80
<span style="color: #008080;">46</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">47</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">48</span> }</pre>
  </div>
  
  <p>
    <span class="cnblogs_code_collapse"> lb03 /etc/keepalived/keepalived.conf</span></div> 
    
    <p style="margin-left: 7.1pt;">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <em><span style="text-decoration: underline;"><span style="background: yellow;">lb04</span></span></em><em><span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">的</span><span style="background: yellow;">Keepalied</span></span></em><em><span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">配置文件</span></span></em>
    </p>
    
    <div class="cnblogs_code" onclick="cnblogs_code_show('fadb947f-dcd8-4aa5-bdbf-6981fd152194')">
      <img id="code_img_closed_fadb947f-dcd8-4aa5-bdbf-6981fd152194" class="code_img_closed" src="https://clsn.io/wp-content/uploads/2018/03/ContractedBlock-14.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" /><img id="code_img_opened_fadb947f-dcd8-4aa5-bdbf-6981fd152194" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('fadb947f-dcd8-4aa5-bdbf-6981fd152194',event)" data-original="https://clsn.io/wp-content/uploads/2018/03/ExpandedBlockStart-14.gif" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" /></p> 
      
      <div id="cnblogs_code_open_fadb947f-dcd8-4aa5-bdbf-6981fd152194" class="cnblogs_code_hide">
        <pre><span style="color: #008080;"> 1</span> [root@lb04 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /etc/keepalived/keepalived.conf</span>
<span style="color: #008080;"> 2</span> <span style="color: #000000;">global_defs {
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">   router_id LVS_02
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #000000;">vrrp_instance VI_1 {
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    state BACKUP
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    interface eth0
</span><span style="color: #008080;"> 9</span>     virtual_router_id 51
<span style="color: #008080;">10</span>     priority 100
<span style="color: #008080;">11</span>     advert_int 1
<span style="color: #008080;">12</span> <span style="color: #000000;">    authentication {
</span><span style="color: #008080;">13</span> <span style="color: #000000;">        auth_type PASS
</span><span style="color: #008080;">14</span>         auth_pass 1111
<span style="color: #008080;">15</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    virtual_ipaddress {
</span><span style="color: #008080;">17</span>      10.0.0.13/24
<span style="color: #008080;">18</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">19</span> <span style="color: #000000;">}
</span><span style="color: #008080;">20</span> virtual_server 10.0.0.13 80<span style="color: #000000;"> {
</span><span style="color: #008080;">21</span>     delay_loop 6          
<span style="color: #008080;">22</span> <span style="color: #000000;">    lb_algo wrr                
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    lb_kind DR                
</span><span style="color: #008080;">24</span>     nat_mask 255.255.255.0
<span style="color: #008080;">25</span>     persistence_timeout 50     
<span style="color: #008080;">26</span> <span style="color: #000000;">    protocol TCP                
</span><span style="color: #008080;">27</span> 
<span style="color: #008080;">28</span>     real_server 10.0.0.17 80<span style="color: #000000;"> {
</span><span style="color: #008080;">29</span>         weight 1              
<span style="color: #008080;">30</span> <span style="color: #000000;">        TCP_CHECK {
</span><span style="color: #008080;">31</span>         connect_timeout 8       
<span style="color: #008080;">32</span>         nb_get_retry 3
<span style="color: #008080;">33</span>         delay_before_retry 3
<span style="color: #008080;">34</span>         connect_port 80
<span style="color: #008080;">35</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">36</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">37</span> 
<span style="color: #008080;">38</span>     real_server 10.0.0.18 80<span style="color: #000000;"> {
</span><span style="color: #008080;">39</span>         weight 1              
<span style="color: #008080;">40</span> <span style="color: #000000;">        TCP_CHECK {
</span><span style="color: #008080;">41</span>         connect_timeout 8       
<span style="color: #008080;">42</span>         nb_get_retry 3
<span style="color: #008080;">43</span>         delay_before_retry 3
<span style="color: #008080;">44</span>         connect_port 80
<span style="color: #008080;">45</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">46</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">47</span> }</pre>
      </div>
      
      <p>
        <span class="cnblogs_code_collapse">lb04 /etc/keepalived/keepalived.conf</span></div> 
        
        <p>
          <strong><em><span style="text-decoration: underline;">keepalived</span></em></strong> <strong>persistence_timeout</strong><strong><span style="font-family: 等线;">参数意义</span></strong> LVS Persistence <span style="font-family: 等线;">参数的作用</span>
        </p>
        
        <p style="text-indent: 15.75pt;">
          <em><span style="text-decoration: underline;">http://blog.csdn.net/nimasike/article/details/53911363 </span></em>
        </p>
        
        <h3>
          <span id="184_keepalived">1.8.4 <span style="font-family: '微软雅黑',sans-serif;">启动</span>keepalived<span style="font-family: '微软雅黑',sans-serif;">服务</span></span>
        </h3>
        
        <div class="cnblogs_code">
          <pre>[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> systemctl restart  keepalived.service </span><span style="color: #008000;">
#</span><span style="color: #008000;"> 检查lvs状态</span>
[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ipvsadm -ln</span>
IP Virtual Server version 1.2.1 (size=4096<span style="color: #000000;">)
Prot LocalAddress:Port Scheduler Flags
  </span>-><span style="color: #000000;"> RemoteAddress:Port           Forward Weight ActiveConn InActConn
TCP  </span>10.0.0.13:80 wrr persistent 50
  -> 10.0.0.17:80                 Route   1<span style="color: #000000;">      0          0         
  </span>-> 10.0.0.18:80                 Route   1<span style="color: #000000;">      0          0  
</span><span style="color: #008000;">#</span><span style="color: #008000;"> 检查虚拟ip</span>
[root@lb03 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ip a s eth0</span>
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000<span style="color: #000000;">
    link</span>/ether 00:0c:29:de:7c:97<span style="color: #000000;"> brd ff:ff:ff:ff:ff:ff
    inet </span>10.0.0.15/24 brd 10.0.0.255 scope <span style="color: #0000ff;">global</span><span style="color: #000000;"> eth0
       valid_lft forever preferred_lft forever
    inet </span>10.0.0.13/24 scope <span style="color: #0000ff;">global</span><span style="color: #000000;"> secondary eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:fede:7c97</span>/64<span style="color: #000000;"> scope link 
       valid_lft forever preferred_lft forever</span></pre>
        </div>
        
        <h3>
          <span id="185_web">1.8.5 <span style="font-family: '微软雅黑',sans-serif;">在</span>web<span style="font-family: '微软雅黑',sans-serif;">服务器上进行配置</span></span>
        </h3>
        
        <div class="cnblogs_code">
          <pre>（在web03/<span style="color: #000000;">web04同时操作下面步骤）
步骤1：在lo网卡绑定VIP地址（ip）
步骤2：修改内核参数抑制ARP响应
ip addr add </span>10.0.0.13/32<span style="color: #000000;"> dev lo

cat </span>>>/etc/sysctl.conf&lt;&lt;<span style="color: #000000;">EOF
net.ipv4.conf.all.arp_ignore </span>= 1<span style="color: #000000;">
net.ipv4.conf.all.arp_announce </span>= 2<span style="color: #000000;">
net.ipv4.conf.lo.arp_ignore </span>= 1<span style="color: #000000;">
net.ipv4.conf.lo.arp_announce </span>= 2<span style="color: #000000;">
EOF
sysctl </span>-p</pre>
        </div>
        
        <p>
          <strong><em><span style="font-family: 等线; color: red;">注意：</span><span style="color: red;">web</span></em></strong><strong><em><span style="font-family: 等线; color: red;">服务器上的配置为临时生效，可以将其写入</span><span style="color: red;">rc.local</span></em></strong><strong><em><span style="font-family: 等线; color: red;">文件，注意文件的执行权限。</span></em></strong>
        </p>
        
        <p>
          <span style="font-family: 等线;">使用</span>curl<span style="font-family: 等线;">命令进行测试</span>
        </p>
        
        <div class="cnblogs_code">
          <pre>[root@lb04 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> curl 10.0.0.13</span>
web03</pre>
        </div>
        
        <p>
          <strong><em><span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">至此</span><span style="background: yellow;">keepalived+lvs</span></span></em></strong><strong><em><span style="text-decoration: underline;"><span style="font-family: 等线; background: yellow;">配置完毕</span></span></em></strong>
        </p>
        
        <h2>
          <span id="19_LVS">1.9 <span style="font-family: '微软雅黑',sans-serif;">常见</span>LVS<span style="font-family: '微软雅黑',sans-serif;">负载均衡高可用解决方案</span></span>
        </h2>
        
        <p style="margin-left: 33.0pt; text-indent: -21.0pt;">
          <span style="font-family: Wingdings;">&Oslash;&nbsp;</span><span style="font-family: '微软雅黑',sans-serif;">开发类似</span>keepalived<span style="font-family: '微软雅黑',sans-serif;">的脚本，早期的办法，现在不推荐使用。</span>
        </p>
        
        <p style="margin-left: 33.0pt; text-indent: -21.0pt;">
          <span style="font-family: Wingdings;">&Oslash;&nbsp;</span>heartbeat+lvs+ldirectord<span style="font-family: '微软雅黑',sans-serif;">脚本配置方案，复杂不易控制，不推荐使用</span>
        </p>
        
        <p style="margin-left: 33.0pt; text-indent: -21.0pt;">
          <span style="font-family: Wingdings;">&Oslash;&nbsp;</span>RedHat<span style="font-family: '微软雅黑',sans-serif;">工具</span>piranha<span style="font-family: '微软雅黑',sans-serif;">，一个</span>web<span style="font-family: '微软雅黑',sans-serif;">界面配置</span>LVS<span style="font-family: '微软雅黑',sans-serif;">。</span>
        </p>
        
        <p style="margin-left: 33.0pt; text-indent: -21.0pt;">
          <span style="font-family: Wingdings;">&Oslash;&nbsp;</span><span style="background: yellow;">LVS-DR+keepalived</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; background: yellow;">方案，老师推荐最优方案，简单、易用、高效</span><span style="font-family: '微软雅黑',sans-serif;">。</span>
        </p>
        
        <h3>
          <span id="191_lvs">1.9.1 lvs<span style="font-family: '微软雅黑',sans-serif;">排错思路</span></span>
        </h3>
        
        <p style="text-align: center;">
          <span style="font-family: '微软雅黑',sans-serif;"><img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171129154800597-1843410323.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="高并发场景 LVS 安装及高可用实现" alt="" /></span>
        </p>
        
        <h3>
          <span id="192">1.9.2 <span style="font-family: '微软雅黑',sans-serif;">参考文档</span></span>
        </h3>
        
        <div class="cnblogs_Highlighter">
          <pre class="brush:python;gutter:true;">LVS项目介绍            http://www.linuxvirtualserver.org/zh/lvs1.html 
LVS集群的体系结构      http://www.linuxvirtualserver.org/zh/lvs2.html 
LVS集群中的IP负载均衡技术  http://www.linuxvirtualserver.org/zh/lvs3.html
LVS集群的负载调度       http://www.linuxvirtualserver.org/zh/lvs4.html 
NAT模式安装详解   http://www.cnblogs.com/liwei0526vip/p/6370103.html
开发眼光看lvs      http://blog.hesey.net/2013/02/introduce-to-load-balance-and-lvs-briefly.html
lvs 介绍      http://www.it165.net/admin/html/201401/2248.html</pre>
        </div>
        
        <p>
          &nbsp;
        </p>
        
        <p style="text-align: right;">
          <strong>&nbsp;本文出自&ldquo;惨绿少年&rdquo;，欢迎转载，转载请注明出处！http://blog.znix.top</strong>
        </p>
        
        <div id="toc_container" class="toc_white have_bullets">
          <ul class="toc_list">
            <li>
              <a href="#11">1.1 负载均衡介绍</a><ul>
                <li>
                  <a href="#111">1.1.1 负载均衡的妙用</a>
                </li>
                <li>
                  <a href="#112_lvs">1.1.2 为什么要用lvs</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#12_LVS">1.2 LVS介绍</a><ul>
                <li>
                  <a href="#121">1.2.1 相关参考资料</a>
                </li>
                <li>
                  <a href="#122_LVSip_vs">1.2.2 LVS内核模块ip_vs介绍</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#13_LVS">1.3 LVS集群搭建</a><ul>
                <li>
                  <a href="#131">1.3.1 集群环境说明</a>
                </li>
                <li>
                  <a href="#132_ipvsadm">1.3.2 安装ipvsadm管理工具</a>
                </li>
                <li>
                  <a href="#133_LVS">1.3.3 LVS集群搭建</a>
                </li>
                <li>
                  <a href="#134_web">1.3.4 在web浏览器配置操作</a>
                </li>
                <li>
                  <a href="#135">1.3.5 进行访问测试</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#14_LVS">1.4 负载均衡（LVS）相关名词</a><ul>
                <li>
                  <a href="#141_LVS--DR">1.4.1 LVS集群的工作模式--DR直接路由模式</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#15_web">1.5 在web端的操作有什么含义？</a><ul>
                <li>
                  <a href="#151_RealServerloVIP">1.5.1 RealServer为什么要在lo接口上配置VIP？</a>
                </li>
                <li>
                  <a href="#152_eth0VIP">1.5.2 在eth0网卡上配置VIP可以吗？</a>
                </li>
                <li>
                  <a href="#153_ARP">1.5.3 为什么要抑制ARP响应？</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#16_LVS">1.6 LVS集群的工作模式</a><ul>
                <li>
                  <a href="#161_LVS--NAT">1.6.1 LVS集群的工作模式--NAT</a>
                </li>
                <li>
                  <a href="#nbsp">&nbsp;</a>
                </li>
                <li>
                  <a href="#162_LVS--TUN">1.6.2 LVS集群的工作模式--隧道模式TUN</a>
                </li>
                <li>
                  <a href="#163_LVS--FULLNAT">1.6.3 LVS集群的工作模式--FULLNAT</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#17_IPVS">1.7 IPVS调度器实现了如下八种负载调度算法：</a>
            </li>
            <li>
              <a href="#18_LVSKeepalived">1.8 LVS+Keepalived方案实现</a><ul>
                <li>
                  <a href="#181_keepalived">1.8.1 keepalived功能</a>
                </li>
                <li>
                  <a href="#182_Keepalived">1.8.2 在负载器安装Keepalived软件</a>
                </li>
                <li>
                  <a href="#183">1.8.3 修改配置文件</a>
                </li>
                <li>
                  <a href="#184_keepalived">1.8.4 启动keepalived服务</a>
                </li>
                <li>
                  <a href="#185_web">1.8.5 在web服务器上进行配置</a>
                </li>
              </ul>
            </li>
            
            <li>
              <a href="#19_LVS">1.9 常见LVS负载均衡高可用解决方案</a><ul>
                <li>
                  <a href="#191_lvs">1.9.1 lvs排错思路</a>
                </li>
                <li>
                  <a href="#192">1.9.2 参考文档</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>