---
title: NFS存储服务部署
author: 惨绿少年
type: post
date: 2017-10-19T03:31:00+00:00
url: /clsn/lx910.html
Baidusubmit:
  - 1
views:
  - 178
categories:
  - Linux运维
  - 存储
  - 运维基本功

---
# <span id="1_NFS">第1章 NFS<span style="font-family: '微软雅黑',sans-serif;">介绍</span></span>

## <span id="11_NFS">1.1 NFS服务<span style="font-family: '微软雅黑',sans-serif;">内容的概述</span></span>

> RPC服务知识概念介绍说明，以及RPC服务存在价值**  
>** 
> 
> NFS服务工作原理讲解**  
>** 
> 
> &nbsp;NFS共享文件系统使用原理讲解
> 
> &nbsp;NFS服务配罝文件exports编写格式说明

## <span id="12_NFS">1.2 NFS<span style="font-family: '微软雅黑',sans-serif;">是什么</span></span>

<p style="text-indent: 21.0pt;">
  NFS<span style="font-family: '微软雅黑',sans-serif;">（</span>Network File System<span style="font-family: '微软雅黑',sans-serif;">）即<strong>网络文件系统</strong></span>
</p>

&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">它的主要功能是通过网络（一般是局域网）让不同的主机系统之间可以共享文件或目录。</span>

&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">分布式文件系统</span>Moosefs(mfs)\glusterFS

### <span id="121_NFSqudian">1.2.1 NFS<span style="font-family: '微软雅黑',sans-serif;">的</span>qudian</span>

nfs<span style="font-family: '微软雅黑',sans-serif;">属于本地文件存储服务</span>

> &nbsp;&nbsp; 缺点一：
> 
> <div>
>   <p>
>     &nbsp;&nbsp;&nbsp; winndows上无法使用
>   </p>
> </div>
> 
> &nbsp;&nbsp;&nbsp;缺点二：
> 
> <div>
>   <p>
>     在高并发场景，以及存储量比较高的场景,对数据安全性要求比较高场景
>   </p>
>   
>   <p>
>     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;需要采用分布式储存（<strong>mfs &nbsp;FastDFS</strong>）
>   </p>
>   
>   <p>
>     &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分布式文件系统：无法在服务器中看到真实的文件信息
>   </p>
> </div>

### <span id="122_Windowslinux">1.2.2 <span style="font-family: '微软雅黑',sans-serif;">实现</span>Windows<span style="font-family: '微软雅黑',sans-serif;">与</span>linux<span style="font-family: '微软雅黑',sans-serif;">系统文件数据共享方法</span></span>

<div class="cnblogs_code">
  <pre>        a.ftp(ftp服务部署)        b.samba服务   </pre>
</div>

## <span id="13_NFS">1.3 NFS<span style="font-family: '微软雅黑',sans-serif;">共享网络文件系统企业应用</span></span>

> <span style="font-family: '微软雅黑',sans-serif;">主要用于存储web服务器上用户上传的数据信息，图片&nbsp;附件&nbsp;头像&nbsp;视频&nbsp;音频</span>

## <span id="14_NFS">1.4 NFS<span style="font-family: '微软雅黑',sans-serif;">文件系统存在意义</span></span>

<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171019193219271-1132330982.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" /> 

<p style="text-indent: 36.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">实现数据共享，数据统一一致</span>
</p>

### <span id="141">1.4.1 <span style="font-family: '微软雅黑',sans-serif;">实现的不同方法</span></span>

<span style="font-family: '微软雅黑',sans-serif;">软件实现：</span>

<div class="cnblogs_code">
  <pre>本地文件系统NFS  分布式文件系统 mfs</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">硬件实现：</span>

<div class="cnblogs_code">
  <pre>IBM (服务器 小型机 大型机 存储 DS V7000 V5000) oracle EMC = 去IOE</pre>
</div>

## <span id="15_NFS">1.5 NFS <span style="font-family: '微软雅黑',sans-serif;">网络文件系统工作方式</span></span>

><img data-original="file:///C:/Users/DEFAUL~1.DES/AppData/Local/Temp/msohtmlclip1/01/clip_image001.gif" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="*" width="14" height="14" /> &nbsp;在nfs服务端创建共享目录
> 
><img data-original="file:///C:/Users/DEFAUL~1.DES/AppData/Local/Temp/msohtmlclip1/01/clip_image001.gif" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="*" width="14" height="14" /> &nbsp;通过mount&nbsp;网路挂载，将NFS客户端本地目录挂载到NFS服务端共享目录上
> 
><img data-original="file:///C:/Users/DEFAUL~1.DES/AppData/Local/Temp/msohtmlclip1/01/clip_image001.gif" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="*" width="14" height="14" /> &nbsp;NFS客户端挂载目录上创建、删除、查看数据操作，等价于在服务端进行的创建、删除、查看数据操作

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171019193253224-785213157.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" />
</p>

> 如图10-5所示，在&nbsp;NFS服务器端设置好一个共享目录&nbsp;/video后，其他有权限访问&nbsp;NFS服务器端的客户端都可以将这个共享目录&nbsp;/video挂载到客户端本地的某个挂载点（其实就是一个目录，这个挂载点目录可以自己随意指定），图10-5中的两个&nbsp;NFS客户端本地的挂载点分別为/ v/video和/video ,不同客户端的挂载点可以不相同。
> 
> 客户端正确挂载完毕后，就可以通过&nbsp;NFS客户端的挂载点所在的/v/video或&nbsp;/video目录查看
> 
> 到&nbsp;NFS服务器端&nbsp;/video共享出来的目录下的所有数据。在客户端上查看时&nbsp;，NFS服务器端的&nbsp;/video目录就相当于客户端本地的磁盘分区或目录，几乎感觉不到使用上的区别，根据&nbsp;NFS服务器端授予&nbsp;的&nbsp;NFS共享权限以及共享目录的本地系统权限，只要在指定的&nbsp;NFS客户端操作挂载/ v/video或/video的目录，就可以将数据轻松地存取到NFS服务器端上的/video目录中了。

## <span id="16_NFS">1.6 NFS<span style="font-family: '微软雅黑',sans-serif;">网络文件系统重点要了解两个重要服务</span></span>

<div class="cnblogs_code">
  <pre> RPC服务       NFS服务</pre>
</div>

### <span id="161_NFS">1.6.1 NFS<span style="font-family: '微软雅黑',sans-serif;">工作流程图</span></span>

<p style="text-align: center;">
  &nbsp;<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171019193307224-1762496667.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" />
</p>

<p style="text-align: center;" align="center">
  &nbsp;
</p>

### <span id="162_RPC">1.6.2 RPC<span style="font-family: '微软雅黑',sans-serif;">服务工作原理</span></span>

<img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20171019193322802-2000798233.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" /> 

### <span id="163_NFS">1.6.3 NFS<span style="font-family: '微软雅黑',sans-serif;">详细的访问流程</span></span>

<p align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20180207112829295-1409074935.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" />
</p>

<p style="text-align: center;" align="center">
  <img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20180207112840201-2011279376.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" />
</p>

**<span style="font-family: '微软雅黑',sans-serif;">当访问程序通过</span>NFS****<span style="font-family: '微软雅黑',sans-serif;">客户端向</span>NFS****<span style="font-family: '微软雅黑',sans-serif;">服务器存取文件时，其请求数据流程大致如下：</span>**

<div class="cnblogs_code">
  <pre>01<span style="color: #000000;">.首先用户访间网站程序，由程序在NFS客户端上发出存取NFS文件的请求，这时NFS客户端（即执行程序的服务器）的RPC服务（rpcbind服务）就会通过网络向NFS服务器端的RPC服务（rpcbind服务）的111端口发出NFS文件存取功能的询间请求.
</span>02<span style="color: #000000;">.NFS服务器端的RPC服务（rpcbind服务）找到对应的已注册的NFS端口后，通知NFS客户端的RPC服务（rpcbind服务）。
</span>03<span style="color: #000000;">.此时NFS客户端获取到正确的端口,并与NFS daemon联机存取数据
</span>04.NFS客户端把数据存取成功后，返回给前端访间程序，告知用户存取结果，作为网站用户，就完成了一次存取操作。</pre>
</div>

&nbsp;&nbsp;　　 <span style="font-family: '微软雅黑',sans-serif;">因为</span>NFS<span style="font-family: '微软雅黑',sans-serif;">的各项功能都需要向</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务（</span>rpcbind<span style="font-family: '微软雅黑',sans-serif;">服务）注册，所以只有</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务才能获取到</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务的各项功能对应的端口号（</span>port number)<span style="font-family: '微软雅黑',sans-serif;">、</span>PID<span style="font-family: '微软雅黑',sans-serif;">、</span>NFS<span style="font-family: '微软雅黑',sans-serif;">在主机所监听的</span>IP<span style="font-family: '微软雅黑',sans-serif;">等信息，而</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端也只能通过向</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务询问才能找到正确的端□。也就是说，</span>NFS<span style="font-family: '微软雅黑',sans-serif;">需要有</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务的协助才能成功对外提供服务。从上面的描述，我们不难推断，无论是</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端还是</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端，当要使用</span>NFS<span style="font-family: '微软雅黑',sans-serif;">时，都需要首先启动</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务，</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务必须在</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务启动之后启动，客户端无需启动</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务，但需要启动</span>RPC<span style="font-family: '微软雅黑',sans-serif;">服务。</span>

# <span id="2_NFS">第2章 <span style="font-family: '微软雅黑',sans-serif;">实践操作</span>NFS <span style="font-family: '微软雅黑',sans-serif;">服务</span></span>

## <span id="21">2.1 <span style="font-family: '微软雅黑',sans-serif;">进行服务器架构规划</span></span>

NFS<span style="font-family: '微软雅黑',sans-serif;">服务器部署角色</span>IP

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 205.3pt; border-width: 1pt; border-style: solid; border-color: windowtext; background: #bfbfbf; padding: 0cm 5.4pt;" valign="top" width="274">
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif;">服务器系统</span></strong>
      </p>
    </td>
    
    <td style="width: 191.35pt; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #bfbfbf; padding: 0cm 5.4pt;" valign="top" width="255">
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif;">角色</span></strong>
      </p>
    </td>
    
    <td style="width: 126.15pt; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #bfbfbf; padding: 0cm 5.4pt;" valign="top" width="168">
      <p>
        <strong>IP</strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 205.3pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="274">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        CentOS release 6.9 (Final)
      </p>
    </td>
    
    <td style="width: 191.35pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="255">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端</span>(NFS-Sever)
      </p>
    </td>
    
    <td style="width: 126.15pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="168">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        10.0.0.31
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 205.3pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="274">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        CentOS release 6.9 (Final)
      </p>
    </td>
    
    <td style="width: 191.35pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="255">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        NFS<span style="font-family: '微软雅黑',sans-serif;">客户端</span>1(NFS-Client1)
      </p>
    </td>
    
    <td style="width: 126.15pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="168">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        10.0.0.8
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 205.3pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="274">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        CentOS release 6.9 (Final)
      </p>
    </td>
    
    <td style="width: 191.35pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="255">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        NFS<span style="font-family: '微软雅黑',sans-serif;">客户端</span>2(NFS-Client2)
      </p>
    </td>
    
    <td style="width: 126.15pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="168">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        10.0.0.41
      </p>
    </td>
  </tr>
</table>

## <span id="22_NFS">2.2 NFS<span style="font-family: '微软雅黑',sans-serif;">服务端部署过程</span></span>

### <span id="221_-NFS">2.2.1 <span style="font-family: '微软雅黑',sans-serif;">第一个里程碑</span>-<span style="font-family: '微软雅黑',sans-serif;">确认软件是否已经安装，安装</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务相关软件</span></span>

<div class="cnblogs_code">
  <pre>  rpm -qa|<span style="color: #000000;">grep nfs
  rpm </span>-qa|grep rpc</pre>
</div>

<p style="text-indent: 15.75pt;">
  <span style="font-family: '微软雅黑',sans-serif;">安装</span>rpcbind nfs-utils<span style="font-family: '微软雅黑',sans-serif;">服务程序，并进行验证安装是否成功</span>
</p>

<div class="cnblogs_code">
  <pre>  yum install -y nfs-<span style="color: #000000;">utils rpcbind
  rpm </span>-qa nfs-utils rpcbind&nbsp;</pre>
</div>

### <span id="222_-nfs">2.2.2 <span style="font-family: '微软雅黑',sans-serif;">第二个里程碑</span>-<span style="font-family: '微软雅黑',sans-serif;">编写</span>nfs<span style="font-family: '微软雅黑',sans-serif;">配置文件</span></span>

&nbsp; nfs<span style="font-family: '微软雅黑',sans-serif;">配置文件默认存在</span>/etc/exports

<div class="cnblogs_code">
  <pre>  vim /etc/<span style="color: #000000;">exports
  </span><span style="color: #008000;">#</span><span style="color: #008000;">share /data by clsn for share at 20170220</span>
  /data   172.16.1.0/24(rw,sync) </pre>
</div>

<span style="background: yellow;">/etc/exports</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; background: yellow;">文件说明：</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">第一部分：</span>/data&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;--<span style="font-family: '微软雅黑',sans-serif;">指定共享目录信息</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">第二部分：</span>172.16.1.0/24&nbsp; --<span style="font-family: '微软雅黑',sans-serif;">指定了一个网段信息，表示允许指定的网段主机挂载到我本地的共享目录上</span>
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">第三部分：</span>(rw,sync)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; --<span style="font-family: '微软雅黑',sans-serif;">表示定义共享参数信息，</span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span style="background: lime;">rw&nbsp;&nbsp;&nbsp;&nbsp; </span><span style="font-family: 微软雅黑, sans-serif; background: lime;">表示读写</span><span style="font-family: '微软雅黑',sans-serif;">，对共享目录设置的权限</span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="background: lime;">sync&nbsp;&nbsp; </span><span style="font-family: 微软雅黑, sans-serif; background: lime;">同步</span><span style="font-family: '微软雅黑',sans-serif; background: lime;">，</span><span style="font-family: '微软雅黑',sans-serif;">数据会先写入到</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器内存中，会立刻同步到磁盘里面</span>==<span style="font-family: '微软雅黑',sans-serif; background: lime;">直接存储硬盘中</span>
  </p>
</div>

### <span id="223">2.2.3 <span style="font-family: '微软雅黑',sans-serif;">第三个里程碑：创建共享目录，进行权限设定</span></span>

<div class="cnblogs_code">
  <pre>mkdir /data -<span style="color: #000000;">p
chown </span>-R nfsnobody.nfsnobody /data</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">说明：</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    NFS<span style="font-family: '微软雅黑',sans-serif;">共享目录管理用户为</span>nfsnobody<span style="font-family: '微软雅黑',sans-serif;">，此用户不用创建，安装</span>nfs<span style="font-family: '微软雅黑',sans-serif;">软件时会自动创建</span>
  </p>
</div>

### <span id="224">2.2.4 <span style="font-family: '微软雅黑',sans-serif;">第四个里程碑：启动服务（<span style="color: red;">注意顺序</span>）</span></span>

&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">首先，启动</span><span style="color: red;">rpc</span><span style="font-family: '微软雅黑',sans-serif;">服务</span>

<div class="cnblogs_code">
  <pre>/etc/init.d/rpcbind start</pre>
</div>

&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">其次，启动</span><span style="color: red;">nfs</span><span style="font-family: '微软雅黑',sans-serif;">服务</span>

<div class="cnblogs_code">
  <pre>/etc/init.d/nfs start</pre>
</div>

&nbsp; rpcbind<span style="font-family: '微软雅黑',sans-serif;">服务启动信息查看</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ps -ef|grep rpcbind</span>
  rpc        4050      1  0 10:55 ?        00:00:00<span style="color: #000000;"> rpcbind
  root       </span>4054   3878  0 10:55 pts/1    00:00:00 grep --color=<span style="color: #000000;">auto rpcbind
  [root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> netstat -lntup|grep 111</span>
  tcp        0      0 0.0.0.0:111                 0.0.0.0:*                   LISTEN      4050/<span style="color: #000000;">rpcbind       
  tcp        0      0 :::</span>111                      :::*                        LISTEN      4050/<span style="color: #000000;">rpcbind       
  udp        0      0 </span>0.0.0.0:111                 0.0.0.0:*                               4050/<span style="color: #000000;">rpcbind       
  udp        0      0 :::</span>111                      :::*                                    4050/<span style="color: #000000;">rpcbind       
  [root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpcinfo -p localhost</span>
<span style="color: #000000;">   program vers proto   port  service
    </span>100000    4   tcp    111<span style="color: #000000;">  portmapper
    </span>100000    3   tcp    111<span style="color: #000000;">  portmapper
    </span>100000    2   tcp    111<span style="color: #000000;">  portmapper
    </span>100000    4   udp    111<span style="color: #000000;">  portmapper
    </span>100000    3   udp    111<span style="color: #000000;">  portmapper
    </span>100000    2   udp    111  portmapper</pre>
</div>

&nbsp;&nbsp;nfs<span style="font-family: '微软雅黑',sans-serif;">启动后查看信息</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpcinfo -p localhost</span>
<span style="color: #000000;">   program vers proto   port  service
    </span>100000    4   tcp    111<span style="color: #000000;">  portmapper
    </span>100000    3   tcp    111<span style="color: #000000;">  portmapper
    </span>100000    2   tcp    111<span style="color: #000000;">  portmapper
    </span>100000    4   udp    111<span style="color: #000000;">  portmapper
    </span>100000    3   udp    111<span style="color: #000000;">  portmapper
    </span>100000    2   udp    111<span style="color: #000000;">  portmapper
    </span>100024    1   udp  28467<span style="color: #000000;">  status
    </span>100024    1   tcp  56269<span style="color: #000000;">  status
    </span>100011    1   udp    875<span style="color: #000000;">  rquotad
    </span>100011    2   udp    875<span style="color: #000000;">  rquotad
    </span>100011    1   tcp    875<span style="color: #000000;">  rquotad
    </span>100011    2   tcp    875<span style="color: #000000;">  rquotad
    </span>100005    1   udp  32886<span style="color: #000000;">  mountd
    </span>100005    1   tcp   6154<span style="color: #000000;">  mountd
    </span>100005    2   udp  38339<span style="color: #000000;">  mountd
    </span>100005    2   tcp  60288<span style="color: #000000;">  mountd
    </span>100005    3   udp  49824<span style="color: #000000;">  mountd
    </span>100005    3   tcp  24427<span style="color: #000000;">  mountd
    </span>100003    2   tcp   2049<span style="color: #000000;">  nfs
    </span>100003    3   tcp   2049<span style="color: #000000;">  nfs
    </span>100003    4   tcp   2049<span style="color: #000000;">  nfs
    </span>100227    2   tcp   2049<span style="color: #000000;">  nfs_acl
    </span>100227    3   tcp   2049<span style="color: #000000;">  nfs_acl
    </span>100003    2   udp   2049<span style="color: #000000;">  nfs
    </span>100003    3   udp   2049<span style="color: #000000;">  nfs
    </span>100003    4   udp   2049<span style="color: #000000;">  nfs
    </span>100227    2   udp   2049<span style="color: #000000;">  nfs_acl
    </span>100227    3   udp   2049<span style="color: #000000;">  nfs_acl
    </span>100021    1   udp  61803<span style="color: #000000;">  nlockmgr
    </span>100021    3   udp  61803<span style="color: #000000;">  nlockmgr
    </span>100021    4   udp  61803<span style="color: #000000;">  nlockmgr
    </span>100021    1   tcp   6064<span style="color: #000000;">  nlockmgr
    </span>100021    3   tcp   6064<span style="color: #000000;">  nlockmgr
    </span>100021    4   tcp   6064  nlockmgr</pre>
</div>

### <span id="225">2.2.5 <span style="font-family: '微软雅黑',sans-serif;">到此服务端部署配置完成</span></span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> showmount -e 172.16.1.31</span>
Export list <span style="color: #0000ff;">for</span> 172.16.1.31<span style="color: #000000;">:
</span>/data 172.16.1.0/24</pre>
</div>

### <span id="NFSnfs">NFS服务开启后，默认的参数文件位置，注意：修改此文件，对nfs服务没有任何影响</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]# <span style="color: #0000ff;">cat</span> /var/lib/nfs/<span style="color: #000000;">etab 
</span>/data    <span style="color: #800080;">172.16</span>.<span style="color: #800080;">1.0</span>/<span style="color: #800080;">24</span>(rw,<span style="color: #0000ff;">sync</span>,wdelay,hide,nocrossmnt,secure,root_squash,all_squash,no_subtree_check,secure_locks,acl,anonuid=<span style="color: #800080;">65534</span>,anongid=<span style="color: #800080;">65534</span>,sec=sys,rw,root_squash,all_squash)</pre>
</div>

## <span id="23_NFS">2.3 NFS <span style="font-family: '微软雅黑',sans-serif;">客户端部署</span></span>

### <span id="231_nfs_rpc">2.3.1 <span style="font-family: '微软雅黑',sans-serif;">第一个里程碑：确认软件有没有安装，进行</span>nfs rpc <span style="font-family: '微软雅黑',sans-serif;">服务软件安装部署</span></span>

<div class="cnblogs_code">
  <pre>yum install rpcbind nfs-utils -y</pre>
</div>

### <span id="232">2.3.2 <span style="font-family: '微软雅黑',sans-serif;">第二个里程碑：启动服务</span></span>

**<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">提示：</span>**

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    rpcbind<span style="font-family: '微软雅黑',sans-serif;">和</span>nfs<span style="font-family: '微软雅黑',sans-serif;">软件都可以不启动</span>
  </p>
</div>

### <span id="233_NFS">2.3.3 <span style="font-family: '微软雅黑',sans-serif;">第三个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">检查</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务端是否有可以进行挂载的目录</span></span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> rpm -qf `which showmount`</span>
nfs-utils-1.2.3-75.el6.x86_64</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">说明：</span>showmount<span style="font-family: '微软雅黑',sans-serif;">使用，需要安装</span>nfs-utils<span style="font-family: '微软雅黑',sans-serif;">软件</span>

### <span id="234_nfs">2.3.4 <span style="font-family: '微软雅黑',sans-serif;">第四个里程碑：进程</span>nfs<span style="font-family: '微软雅黑',sans-serif;">客户端挂载</span></span>

<div class="cnblogs_code">
  <pre>mount -t nfs 172.16.1.31:/data /mnt</pre>
</div>

测试&nbsp;&nbsp;

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> showmount -e 172.16.1.31</span>
Export list <span style="color: #0000ff;">for</span> 172.16.1.31<span style="color: #000000;">:
</span>/data 172.16.1.0/24<span style="color: #000000;">
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> mount -t nfs 172.16.1.31:/data /mnt</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">说明：</span> <span style="font-family: '微软雅黑',sans-serif;">如果</span>nfs<span style="font-family: '微软雅黑',sans-serif;">软件不安装</span>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; a <span style="font-family: '微软雅黑',sans-serif;">无法使用</span>showmount <span style="font-family: '微软雅黑',sans-serif;">命令</span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; b <span style="font-family: '微软雅黑',sans-serif;">客户端无法识别</span>nfs <span style="font-family: '微软雅黑',sans-serif;">文件系统类型</span>
  </p>
</div>

### <span id="235">2.3.5 <span style="font-family: '微软雅黑',sans-serif;">第五个里程碑：</span> <span style="font-family: '微软雅黑',sans-serif;">进行检查测试</span></span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> df -h</span>
Filesystem         Size  Used Avail Use%<span style="color: #000000;"> Mounted on
</span>/dev/sda3           19G  1.5G   17G   9% /<span style="color: #000000;">
tmpfs              238M     0  238M   0</span>% /dev/<span style="color: #000000;">shm
</span>/dev/sda1          190M   40M  141M  22% /<span style="color: #000000;">boot
</span>172.16.1.31:/data   19G  1.5G   17G   9% /mnt</pre>
</div>

**<span style="font-family: '微软雅黑',sans-serif;">【测试】</span>**<span style="font-family: '微软雅黑',sans-serif;">本地</span>nfs<span style="font-family: '微软雅黑',sans-serif;">客户端</span> <span style="font-family: '微软雅黑',sans-serif;">进行增删改数据</span> <span style="font-family: '微软雅黑',sans-serif;">等价于</span> nfs<span style="font-family: '微软雅黑',sans-serif;">服务端共享目录操作</span>

<div class="cnblogs_code">
  <pre>[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> echo "test123">test.txt</span>
[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> ll test.txt</span>
-rw-r--r-- 1 nfsnobody nfsnobody 8 Oct 13 11:28<span style="color: #000000;"> test.txt
[root@nfs01 data]</span><span style="color: #008000;">#</span><span style="color: #008000;"> cat test.txt</span>
test123</pre>
</div>

# <span id="3">第3章 <span style="font-family: '微软雅黑',sans-serif;">知识深入</span></span>

## <span id="31_NFS">3.1 NFS<span style="font-family: '微软雅黑',sans-serif;">服务相关进程信息</span></span>

### <span id="311">3.1.1 <span style="font-family: '微软雅黑',sans-serif;">简略说明</span></span>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">rpcbind        rpc启动进程 主进程
rpc state      检查数据存储的一致性
rpc.rquotad    磁盘配额
rpc.mountd     权限管理验证
nfsd            NFS主进程
rpc.idmapd     用户压缩映射</span></pre>
</div>

### <span id="311-2">3.1.1 <span style="font-family: '微软雅黑',sans-serif;">进程</span>/<span style="font-family: '微软雅黑',sans-serif;">服务</span> <span style="font-family: '微软雅黑',sans-serif;">详细说明</span></span>

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 148.6pt; border-width: 1pt; border-style: solid; border-color: windowtext; background: #a6a6a6; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif;">服务或进程名</span></strong>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #a6a6a6; padding: 0cm 5.4pt;" valign="top" width="499">
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif;">用途说明</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        portmapper
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        rpcbind<span style="font-family: '微软雅黑',sans-serif;">服务的进程（</span>centos5.x <span style="font-family: '微软雅黑',sans-serif;">上为</span> portmap<span style="font-family: '微软雅黑',sans-serif;">软件）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        rquotad
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">磁盘配额进程</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        nfs<span style="font-family: '微软雅黑',sans-serif;">、</span>nfs_acl
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        &nbsp;&nbsp; nfs<span style="font-family: '微软雅黑',sans-serif;">服务进程</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        nfsd (rpc.nfsd )
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        rpc.nfsd<span style="font-family: '微软雅黑',sans-serif;">的主要功能是管理</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端是否能够登入</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端主机，其中还包括含登入者的</span>ID<span style="font-family: '微软雅黑',sans-serif;">判別等。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        mountd
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        rpc.mountd<span style="font-family: '微软雅黑',sans-serif;">的主要功能则是管理</span>NFS<span style="font-family: '微软雅黑',sans-serif;">文件系统。当</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端顺利通过</span>rpc.nfsd<span style="font-family: '微软雅黑',sans-serif;">登入</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端主机时，在使用</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器提供数据之前，它会去读</span>NFS<span style="font-family: '微软雅黑',sans-serif;">的配置文件</span>/etc/exports<span style="font-family: '微软雅黑',sans-serif;">来比对</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端的权限，通过这一关之后，还要经过</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端本地文件系统使用权限（就是</span>owner<span style="font-family: '微软雅黑',sans-serif;">、</span>group<span style="font-family: '微软雅黑',sans-serif;">、</span>other<span style="font-family: '微软雅黑',sans-serif;">权限）等认证程序。如果都通过了，</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端就可以取得使用</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端文件的权限。</span>
      </p>
      
      <p>
        <strong><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">注意：</span></strong><span style="font-family: '微软雅黑',sans-serif;">这个</span>/etc/exports<span style="font-family: '微软雅黑',sans-serif;">文件也是我们用来管理</span>NFS<span style="font-family: '微软雅黑',sans-serif;">共享目录的使用权限与安全设置的地方，特别强调，</span>NFS<span style="font-family: '微软雅黑',sans-serif;">本身设置的是网络共享权限，整个共享目录的权限还和目录自身的系统权限有关。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        rpc.lockd (<span style="font-family: '微软雅黑',sans-serif;">非必要）</span>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">用来锁定文件，用于多客户端同时写入</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        rpc.statd (<span style="font-family: '微软雅黑',sans-serif;">非必要）</span>
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">检查文件的一致性，与</span>rpc.lockd<span style="font-family: '微软雅黑',sans-serif;">有关。</span>c<span style="font-family: '微软雅黑',sans-serif;">、</span>d<span style="font-family: '微软雅黑',sans-serif;">两个服务雲要客户端，服务器端同时开启才可以；</span>rpc.statd<span style="font-family: '微软雅黑',sans-serif;">监听来自其他主机重启的通知，并且管理当本地系统重启时主机列表。</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 148.6pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" valign="top" width="198">
      <p>
        rpc.idmapd
      </p>
    </td>
    
    <td style="width: 374.2pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" valign="top" width="499">
      <p>
        <span style="font-family: '微软雅黑',sans-serif;">表示用户映射或用户压缩（<strong><span style="color: red;">重要</span></strong>）</span>
      </p>
    </td>
  </tr>
</table>

## <span id="32_etcexports">3.2 /etc/exports<span style="font-family: '微软雅黑',sans-serif;">配置文件说明</span></span>

### <span id="321_etcexports">3.2.1 /etc/exports<span style="font-family: '微软雅黑',sans-serif;">文件说明</span></span>

**<span style="font-family: '微软雅黑',sans-serif;">□</span> NFS****<span style="font-family: '微软雅黑',sans-serif;">共享目录：</span>**

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">为</span> NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端要共享的实际目录，要用绝对路径，如</span> <span style="font-family: '微软雅黑',sans-serif;">（</span>/data )<span style="font-family: '微软雅黑',sans-serif;">。注意共享目录的本地权限，如果需要读写共享，一定要让本地目录可以被</span> NFS<span style="font-family: '微软雅黑',sans-serif;">客户端的用户</span> <span style="font-family: '微软雅黑',sans-serif;">（</span>nfsnobody)<span style="font-family: '微软雅黑',sans-serif;">读写。</span>
</p>

**<span style="font-family: '微软雅黑',sans-serif;">□</span> NFS****<span style="font-family: '微软雅黑',sans-serif;">客户端地址：</span>**

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">为</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务器端授权的可访问共享目录的</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端地址，可以为单独的</span>IP<span style="font-family: '微软雅黑',sans-serif;">地址或主机名、域名等，也可以为整个网段地址。还可以用来匹配所有客户端服务器，这里所谓的客户端一般来说是前端的业务的业务服务器，例如：</span>web<span style="font-family: '微软雅黑',sans-serif;">服务。</span>
</p>

**<span style="font-family: '微软雅黑',sans-serif;">□权限参数集</span>**

<p style="margin-left: 21.0pt; text-indent: 21.0pt;">
  <span style="font-family: '微软雅黑',sans-serif;">对授权的</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端的访问权限设置。</span>
</p>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    nfs<span style="font-family: '微软雅黑',sans-serif;">权限（共享目录</span>\<span style="font-family: '微软雅黑',sans-serif;">借给你手机）</span>nfs<span style="font-family: '微软雅黑',sans-serif;">配置的</span>/ etc/exports /data 172.16.1.0/24(rw)
  </p>
  
  <p>
    <span style="font-family: '微软雅黑',sans-serif;">本地文件系统权限（</span>\<span style="font-family: '微软雅黑',sans-serif;">手机密码不告诉你）挂载目录的权限</span>rwxr- xr-x root root/data
  </p>
</div>

### <span id="322_NFSnbsp">3.2.2 <span style="font-family: '微软雅黑',sans-serif;">指定</span> NFS<span style="font-family: '微软雅黑',sans-serif;">客户端地址的配置详细说明</span>&nbsp;</span>

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 155.7pt; border-width: 1pt; border-style: solid; border-color: windowtext; background: #a6a6a6; padding: 0cm 5.4pt;" width="208">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">客户端地址</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="width: 61pt; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #a6a6a6; padding: 0cm 5.4pt;" width="81">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">具体地址</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </strong>
      </p>
    </td>
    
    <td style="border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #a6a6a6; padding: 0cm 5.4pt;">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">说</span> </strong><strong><span style="font-family: '微软雅黑',sans-serif;">明</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="208">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">授权单一客户端访问</span>NFS
      </p>
    </td>
    
    <td style="width: 61.0pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="81">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        10.0.0.30
      </p>
    </td>
    
    <td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">一般情况，生产环境中此配置不多</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="208">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">授权整个网段可访问</span>NFS
      </p>
    </td>
    
    <td style="width: 61.0pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="81">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        10.0.0.0/24
      </p>
    </td>
    
    <td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">其中的</span>24<span style="font-family: '微软雅黑',sans-serif;">等同于</span>255.255.255.0 ,<span style="font-family: '微软雅黑',sans-serif;">指定网段为生产环境中最常见的配置。配置简单，维护方便</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="208">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">授权整个网段可访问</span>NFS
      </p>
    </td>
    
    <td style="width: 61.0pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="81">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        10.0.0.*
      </p>
    </td>
    
    <td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">指定网段的另外写法（不推荐使用）</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="208">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">授权某个域名客户端访问</span>
      </p>
    </td>
    
    <td style="width: 61.0pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="81">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        nfs.clsnedu.com
      </p>
    </td>
    
    <td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">此方法生产环境中一般情况不常用</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 155.7pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="208">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">授权整个域名客户端访问</span>
      </p>
    </td>
    
    <td style="width: 61.0pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="81">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        *.clsnedu.com
      </p>
    </td>
    
    <td style="border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">此方法生产环境中一般情况不常用</span>
      </p>
    </td>
  </tr>
</table>

### <span id="323">3.2.3 <span style="font-family: '微软雅黑',sans-serif;">常见案例</span></span>

<table style="width: 723px; border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 84.8pt; border-width: 1pt; border-style: solid; border-color: windowtext; background: #a6a6a6; padding: 0cm 5.4pt;" width="113">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">常用格式说明</span></strong>
      </p>
    </td>
    
    <td style="width: 457.3pt; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #a6a6a6; padding: 0cm 5.4pt;" width="610">
      <p style="margin-left: -19.8pt; text-align: justify; text-justify: inter-ideograph; text-indent: 19.8pt;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">要共享的目录客户端</span>IP</strong><strong><span style="font-family: '微软雅黑',sans-serif;">地址或</span>IP</strong><strong><span style="font-family: '微软雅黑',sans-serif;">段</span>(</strong><strong><span style="font-family: '微软雅黑',sans-serif;">参</span>1,</strong><strong><span style="font-family: '微软雅黑',sans-serif;">参</span>2,)</strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 84.8pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="113">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">配罝例一</span>
      </p>
    </td>
    
    <td style="width: 457.3pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="610">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        /data10.0.0.0/24(ro,sync)
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">说明：允许客户端读写，并且数据同步写入到服务器揣的磁盘里</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">注意：</span>24<span style="font-family: '微软雅黑',sans-serif;">和</span>"("<span style="font-family: '微软雅黑',sans-serif;">之间不能有空格</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 84.8pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="113">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">配置例二</span>
      </p>
    </td>
    
    <td style="width: 457.3pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="610">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        /data10.0.0.0/24(rw,sync/all_squash,anonuid=2000,anongid=2000)
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">说明：允许客户揣读写，并且数据同步写到服务器揣的磁盘里，并且指走客户端</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">的用户</span>UID<span style="font-family: '微软雅黑',sans-serif;">和</span>GID<span style="font-family: '微软雅黑',sans-serif;">，早期生产环境的一种配罝，适合多客户端共享一个</span>NFS<span style="font-family: '微软雅黑',sans-serif;">服务</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">单目录，如果所有服务器的</span>nfsnobody<span style="font-family: '微软雅黑',sans-serif;">账户</span>UID<span style="font-family: '微软雅黑',sans-serif;">都是</span>65534,<span style="font-family: '微软雅黑',sans-serif;">则本例没什么必</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">要了</span>.<span style="font-family: '微软雅黑',sans-serif;">早期</span>centos5.5<span style="font-family: '微软雅黑',sans-serif;">的系统默认情况下</span>nfsnobody<span style="font-family: '微软雅黑',sans-serif;">的</span>UID<span style="font-family: '微软雅黑',sans-serif;">不一定是</span>65534,
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">此时如果这些服务器共享一个</span>NFS<span style="font-family: '微软雅黑',sans-serif;">目录，就会出现访问权限问题</span>.
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 84.8pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="113">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">配置例三</span>
      </p>
    </td>
    
    <td style="width: 457.3pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="610">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        /home/clsn10.0.0.0/24(ro)
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">说明：只读共享</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">用途：例如在生产环境中，开发人员有查看生产眼务器日志的需求，但又不希罜</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">给开发生产服务器的权限，那么就可以给开发提供从某个测试服务器</span>NFS<span style="font-family: '微软雅黑',sans-serif;">客户端</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">上查看某个生产服务器的日志目录（</span>NFS<span style="font-family: '微软雅黑',sans-serif;">共享）的权限，当然这不是唯一的方法，</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">例如可以把程序记录的日志发送到测试服务器供开发查看或者通过收集日志等其</span>
      </p>
      
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">它方式展现</span>
      </p>
    </td>
  </tr>
</table>

### <span id="324_nfs">3.2.4 nfs<span style="font-family: '微软雅黑',sans-serif;">客户端访问服务原理</span></span>

### <span id="325_nfs">3.2.5 nfs<span style="font-family: '微软雅黑',sans-serif;">服务访问原理</span><a href="/wp-content/themes/clsn-003/inc/go.php?url=http://www.nmtui.com"  target="_blank"><span style="font-family: '微软雅黑',sans-serif;"><img data-original="https://clsn.io/wp-content/uploads/2018/03/1190037-20180207113350388-1866906937.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="NFS存储服务部署" alt="" /></span></a></span>

<p style="text-align: center;" align="center">
  <span style="font-family: '微软雅黑',sans-serif;">客户端（无论用什么用户访问）</span>---<span style="font-family: '微软雅黑',sans-serif;">门</span>---<span style="font-family: '微软雅黑',sans-serif;">服务端（</span>nfsnobody<span style="font-family: '微软雅黑',sans-serif;">）</span> rpc.idmapd
</p>

## <span id="33_NFSrpcbind_nfs">3.3 NFS<span style="font-family: '微软雅黑',sans-serif;">服务端设置</span>rpcbind nfs<span style="font-family: '微软雅黑',sans-serif;">服务开机自启动</span></span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;">  chkconfig rpcbind on</span>
[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;">  chkconfig nfs  on</span>
[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;">  chkconfig |egrep "rpcbinf|nfs"</span>
nfs             0:off  1:off  2:on   3:on   4:on   5:on   6<span style="color: #000000;">:off
nfslock         0:off  </span>1:off  2:off  3:on   4:on   5:on   6:off</pre>
</div>

## <span id="34_NFS">3.4 NFS<span style="font-family: '微软雅黑',sans-serif;">配置文件编写说明</span></span>

### <span id="341">3.4.1 <span style="font-family: '微软雅黑',sans-serif;">官方举例配置</span></span>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">EXAMPLE
       </span><span style="color: #008000;">#</span><span style="color: #008000;"> sample /etc/exports file</span>
       /<span style="color: #000000;">               master(rw) trusty(rw,no_root_squash)
       </span>/projects       proj*<span style="color: #000000;">.local.domain(rw)
       </span>/usr            *<span style="color: #000000;">.local.domain(ro) @trusted(rw)
       </span>/home/joe       pc001(rw,all_squash,anonuid=150,anongid=100<span style="color: #000000;">)
       </span>/pub            *<span style="color: #000000;">(ro,insecure,all_squash)
       </span>/srv/www        -<span style="color: #000000;">sync,rw server @trusted @external(ro)
       </span>/foo            2001:db8:9:e54::/64(rw) 192.0.2.0/24<span style="color: #000000;">(rw)
       </span>/build          buildhost[0-9].local.domain(rw)</pre>
</div>

### <span id="342_etcexports">3.4.2 <span style="background: lime;">/etc/exports</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; background: lime;">文件配置格式为：</span></span>

<div class="cnblogs_code">
  <pre><span style="color: #000000;"> NFS共享目录 NFS客户端地址1（参数1，参数2，...） 客户端地址2（参数1，参数2，...）
    或
    NFS共享目录 NFS客户端地址1（参数1，参数2，...）
    NFS共享目录 NFS客户端地址2（参数1，参数2，...）</span></pre>
</div>

**<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";color: red;">注意：</span>**nfs<span style="font-family: '微软雅黑',sans-serif;">服务<strong>默认没有认证机制</strong>，安全性不如分布式文件系统</span>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-family: '微软雅黑',sans-serif;">只能通过控制配置文件中网络地址信息，实现安全性</span>

## <span id="35_nfs">3.5 nfs<span style="font-family: '微软雅黑',sans-serif;">配置参数说明</span></span>

<table style="border-collapse: collapse; border-width: initial; border-style: none; border-color: initial;" border="1" cellspacing="0" cellpadding="0">
  <tr>
    <td style="width: 113.15pt; border-width: 1pt; border-style: solid; border-color: windowtext; background: #a6a6a6; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">参数</span></strong>
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: 1pt solid windowtext; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: none; background: #a6a6a6; padding: 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <strong><span style="font-family: '微软雅黑',sans-serif;">说明</span></strong>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="color: red;">rw </span>
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">可读写的权限</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        ro&nbsp;
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">只读的权限</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        no_root_squash
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">登入</span>NFS<span style="font-family: '微软雅黑',sans-serif;">主机，使用该共享目录时相当于该目录的拥有者，如果是</span>root<span style="font-family: '微软雅黑',sans-serif;">的话，那么对于这个共享的目录来说，他就具有</span>root<span style="font-family: '微软雅黑',sans-serif;">的权限，这个参数<strong>『极不安全』</strong>，不建议使用</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        root_squash
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">登入</span>NFS<span style="font-family: '微软雅黑',sans-serif;">主机，使用该共享目录时相当于该目录的拥有者。但是如果是以</span>root<span style="font-family: '微软雅黑',sans-serif;">身份使用这个共享目录的时候，那么这个使用者（</span>root<span style="font-family: '微软雅黑',sans-serif;">）的权限将被压缩成为匿名使用者，即通常他的</span>UID<span style="font-family: '微软雅黑',sans-serif;">与</span>GID<span style="font-family: '微软雅黑',sans-serif;">都会变成</span>nobody<span style="font-family: '微软雅黑',sans-serif;">那个身份</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="color: red;">all_squash</span>
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">不论登入</span>NFS<span style="font-family: '微软雅黑',sans-serif;">的使用者身份为何，他的身份都会被压缩成为匿名使用者，通常也就是</span>nobody
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="color: red;">anonuid </span>
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">可以自行设定这个</span>UID<span style="font-family: '微软雅黑',sans-serif;">的值，这个</span>UID<span style="font-family: '微软雅黑',sans-serif;">必需要存在于你的</span>/etc/passwd<span style="font-family: '微软雅黑',sans-serif;">当中</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="color: red;">anongid </span>
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">同</span>anonuid<span style="font-family: '微软雅黑',sans-serif;">，但是变成</span>groupID<span style="font-family: '微软雅黑',sans-serif;">就是了</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="color: red;">sync </span>
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">资料同步写入到内存与硬盘当中</span>
      </p>
    </td>
  </tr>
  
  <tr>
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        async
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">资料会先暂存于内存当中，而非直接写入硬盘</span>
      </p>
    </td>
  </tr>
  
  <tr style="height: 3.2pt;">
    <td style="width: 113.15pt; border-right: 1pt solid windowtext; border-bottom: 1pt solid windowtext; border-left: 1pt solid windowtext; border-top: none; padding: 0cm 5.4pt; height: 3.2pt;" width="151">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        insecure
      </p>
    </td>
    
    <td style="width: 409.65pt; border-top: none; border-left: none; border-bottom: solid windowtext 1.0pt; border-right: solid windowtext 1.0pt; padding: 0cm 5.4pt 0cm 5.4pt; height: 3.2pt;" width="546">
      <p style="text-align: justify; text-justify: inter-ideograph;">
        <span style="font-family: '微软雅黑',sans-serif;">允许从这台机器过来的非授权访问</span>
      </p>
    </td>
  </tr>
</table>

## <span id="36_nfs">3.6 nfs<span style="font-family: '微软雅黑',sans-serif;">配置参数实践</span></span>

### <span id="361_all_squash">3.6.1 all_squash <span style="font-family: '微软雅黑',sans-serif;">参数实践</span></span>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">服务端修改配置</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/exports</span><span style="color: #008000;">
#</span><span style="color: #008000;">share 20171013 hzs</span>
/data 172.16.1.0/24<span style="color: #000000;">(rw,sync,all_squash)
[root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/nfs reload</span></pre>
</div>

<div style="border: solid windowtext 2.0pt; padding: 1.0pt 4.0pt 1.0pt 4.0pt; background: #F2F2F2;">
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span style="font-family: '微软雅黑',sans-serif;">配置修改需要平滑重启</span>nfs <span style="font-family: '微软雅黑',sans-serif;">服务</span>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<strong><span style="color: red; background: lime;">reload &nbsp;&nbsp; </span></strong><strong><span style="font-family: '微软雅黑',sans-serif; color: red; background: lime;">平滑重启</span> </strong>
  </p>
  
  <p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;<span style="font-family: '微软雅黑',sans-serif;">用户的访问体验更好</span>
  </p>
</div>

<span style="background: yellow;">nfs</span><span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">客户端进行测试</span>

<div class="cnblogs_code">
  <pre>[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> touch test.txt</span>
[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
-rw-r--r-- 1 nfsnobody nfsnobody    8 Oct 13 11:28<span style="color: #000000;"> test.txt
[root@backup </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> su - clsn</span>
[clsn@backup ~]$ cd /mnt/<span style="color: #000000;">
[clsn@backup mnt]$ touch clsn1.txt
[clsn@backup mnt]$ ll
</span>-rw-rw-r-- 1 nfsnobody nfsnobody    0 Oct 13 12:34<span style="color: #000000;"> clsn1.txt
</span>-rw-r--r-- 1 nfsnobody nfsnobody    8 Oct 13 11:28 test.txt</pre>
</div>

**<span style="font-family: '微软雅黑',sans-serif;">说明：</span>**

<span style="font-family: '微软雅黑',sans-serif;">不论登入</span>NFS<span style="font-family: '微软雅黑',sans-serif;">的使用者身份为何，他的身份都会被压缩成为匿名使用者，通常也就是</span>nobody

### <span id="362_no_all_squashroot_squash">3.6.2 no_all_squash,root_squash <span style="font-family: '微软雅黑',sans-serif;">参数实践</span></span>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">服务端修改配置</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/exports</span><span style="color: #008000;">
#</span><span style="color: #008000;">share 20171013 hzs</span>
/data 172.16.1.0/24<span style="color: #000000;">(rw,sync,no_all_squash,root_squash)
[root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/nfs reload</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">客户端卸载重新挂载<span style="background: lime;">（<strong>服务器配置修改后<span style="color: red;">客户端要重新挂载</span></strong>）</span></span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> umount /mnt/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> mount -t nfs 172.16.1.31:/data /mnt</span></pre>
</div>

nfs<span style="font-family: '微软雅黑',sans-serif;">客户端测试结果：</span>

<div class="cnblogs_code">
  <pre>[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> touch test1.txt</span>
[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
-rw-r--r-- 1 nfsnobody nfsnobody    0 Oct 13 12:37<span style="color: #000000;"> test1.txt
[root@backup mnt]</span><span style="color: #008000;">#</span><span style="color: #008000;"> su - clsn</span>
[clsn@backup ~]$ cd /mnt/<span style="color: #000000;">
[clsn@backup mnt]$ touch clsn1.txt
touch: cannot touch `clsn1.txt</span><span style="color: #800000;">'</span><span style="color: #800000;">: Permission denied</span>
<span style="color: #000000;">[clsn@backup mnt]$ touch clsn2.txt
touch: cannot touch `clsn2.txt</span><span style="color: #800000;">'</span><span style="color: #800000;">: Permission denied</span>
<span style="color: #008000;">#</span><span style="color: #008000;"> 服务端验证：</span>
[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> ll /data/</span>
-rw-rw-r-- 1 nfsnobody nfsnobody    0 Oct 13 12:34<span style="color: #000000;"> clsn1.txt
</span>-rw-r--r-- 1 nfsnobody nfsnobody    0 Oct 13 12:37<span style="color: #000000;"> test1.txt
</span>-rw-r--r-- 1 nfsnobody nfsnobody    8 Oct 13 11:28 test.txt</pre>
</div>

**<span style="font-family: '微软雅黑',sans-serif;">说明：</span>**

<p style="text-indent: 21.0pt;">
  no_all_squash<span style="font-family: '微软雅黑',sans-serif;">，是所有用户都不进行压缩，所以</span>clsn<span style="font-family: '微软雅黑',sans-serif;">用户对</span>nfs<span style="font-family: '微软雅黑',sans-serif;">的目录没有写入的权限（与</span>nfs<span style="font-family: '微软雅黑',sans-serif;">服务器的共享目录权限有关）。</span>root<span style="font-family: '微软雅黑',sans-serif;">用户进行压缩所以可以写入。</span>
</p>

### <span id="363_no_root_squash_root">3.6.3 no_root_squash <span style="font-family: '微软雅黑',sans-serif;">参数实践（</span>root<span style="font-family: '微软雅黑',sans-serif;">用户不进行压缩映射）</span></span>

<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new";background: yellow;">服务端修改配置</span>

<div class="cnblogs_code">
  <pre>[root@nfs01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> vim /etc/exports</span><span style="color: #008000;">
#</span><span style="color: #008000;">share 20171013 hzs</span>
/data 172.16.1.0/24<span style="color: #000000;">(rw,sync,no_root_squash)
[root@nfs01 </span>~]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/nfs reload</span></pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">客户端卸载重新挂载<span style="background: lime;">（<strong>服务器配置修改后<span style="color: red;">客户端要重新挂载</span></strong>）</span></span>

<div class="cnblogs_code">
  <pre>[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> umount /mnt/</span>
[root@backup ~]<span style="color: #008000;">#</span><span style="color: #008000;"> mount -t nfs 172.16.1.31:/data /mnt</span></pre>
</div>

nfs<span style="font-family: '微软雅黑',sans-serif;">客户端测试结果：</span>

<div class="cnblogs_code">
  <pre>[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> touch root.txt</span>
[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 16
-rw-rw-r-- 1 nfsnobody nfsnobody    0 Oct 13 12:34<span style="color: #000000;"> clsn1.txt
</span>-rw-r--r-- 1 root      root         0 Oct 13 12:45<span style="color: #000000;"> root.txt
</span>-rw-r--r-- 1 nfsnobody nfsnobody    0 Oct 13 12:37<span style="color: #000000;"> test1.txt
</span>-rw-r--r-- 1 nfsnobody nfsnobody    8 Oct 13 11:28 test.txt</pre>
</div>

<span style="font-family: '微软雅黑',sans-serif;">删除测试</span>

<div class="cnblogs_code">
  <pre>[root@backup mnt]<span style="color: #008000;">#</span><span style="color: #008000;"> rm -rf ./*</span>
<span style="color: #000000;">
[root@backup mnt]</span><span style="color: #008000;">#</span><span style="color: #008000;"> ll</span>
total 0</pre>
</div>

**<span style="font-family: '微软雅黑',sans-serif;">说明：</span>**

<span style="font-family: '微软雅黑',sans-serif;">由于对</span>root<span style="font-family: '微软雅黑',sans-serif;">用户没有进行压缩，所以到达</span>nfs<span style="font-family: '微软雅黑',sans-serif;">服务器后依旧是</span>root<span style="font-family: '微软雅黑',sans-serif;">身份，</span>root<span style="font-family: '微软雅黑',sans-serif;">用户默认对所有的文件都有权限，所以可以写入。</span>**<span style="color: red;">(</span>****<span style="font-family: '微软雅黑',sans-serif; courier new"4courier new"; color: red;">很危险</span><span style="color: red;">)</span>**

<div id="toc_container" class="toc_white have_bullets">
  <ul class="toc_list">
    <li>
      <a href="#1_NFS">第1章 NFS介绍</a><ul>
        <li>
          <a href="#11_NFS">1.1 NFS服务内容的概述</a>
        </li>
        <li>
          <a href="#12_NFS">1.2 NFS是什么</a><ul>
            <li>
              <a href="#121_NFSqudian">1.2.1 NFS的qudian</a>
            </li>
            <li>
              <a href="#122_Windowslinux">1.2.2 实现Windows与linux系统文件数据共享方法</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#13_NFS">1.3 NFS共享网络文件系统企业应用</a>
        </li>
        <li>
          <a href="#14_NFS">1.4 NFS文件系统存在意义</a><ul>
            <li>
              <a href="#141">1.4.1 实现的不同方法</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#15_NFS">1.5 NFS 网络文件系统工作方式</a>
        </li>
        <li>
          <a href="#16_NFS">1.6 NFS网络文件系统重点要了解两个重要服务</a><ul>
            <li>
              <a href="#161_NFS">1.6.1 NFS工作流程图</a>
            </li>
            <li>
              <a href="#162_RPC">1.6.2 RPC服务工作原理</a>
            </li>
            <li>
              <a href="#163_NFS">1.6.3 NFS详细的访问流程</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#2_NFS">第2章 实践操作NFS 服务</a><ul>
        <li>
          <a href="#21">2.1 进行服务器架构规划</a>
        </li>
        <li>
          <a href="#22_NFS">2.2 NFS服务端部署过程</a><ul>
            <li>
              <a href="#221_-NFS">2.2.1 第一个里程碑-确认软件是否已经安装，安装NFS服务相关软件</a>
            </li>
            <li>
              <a href="#222_-nfs">2.2.2 第二个里程碑-编写nfs配置文件</a>
            </li>
            <li>
              <a href="#223">2.2.3 第三个里程碑：创建共享目录，进行权限设定</a>
            </li>
            <li>
              <a href="#224">2.2.4 第四个里程碑：启动服务（注意顺序）</a>
            </li>
            <li>
              <a href="#225">2.2.5 到此服务端部署配置完成</a>
            </li>
            <li>
              <a href="#NFSnfs">NFS服务开启后，默认的参数文件位置，注意：修改此文件，对nfs服务没有任何影响</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#23_NFS">2.3 NFS 客户端部署</a><ul>
            <li>
              <a href="#231_nfs_rpc">2.3.1 第一个里程碑：确认软件有没有安装，进行nfs rpc 服务软件安装部署</a>
            </li>
            <li>
              <a href="#232">2.3.2 第二个里程碑：启动服务</a>
            </li>
            <li>
              <a href="#233_NFS">2.3.3 第三个里程碑： 检查NFS服务端是否有可以进行挂载的目录</a>
            </li>
            <li>
              <a href="#234_nfs">2.3.4 第四个里程碑：进程nfs客户端挂载</a>
            </li>
            <li>
              <a href="#235">2.3.5 第五个里程碑： 进行检查测试</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    
    <li>
      <a href="#3">第3章 知识深入</a><ul>
        <li>
          <a href="#31_NFS">3.1 NFS服务相关进程信息</a><ul>
            <li>
              <a href="#311">3.1.1 简略说明</a>
            </li>
            <li>
              <a href="#311-2">3.1.1 进程/服务 详细说明</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#32_etcexports">3.2 /etc/exports配置文件说明</a><ul>
            <li>
              <a href="#321_etcexports">3.2.1 /etc/exports文件说明</a>
            </li>
            <li>
              <a href="#322_NFSnbsp">3.2.2 指定 NFS客户端地址的配置详细说明&nbsp;</a>
            </li>
            <li>
              <a href="#323">3.2.3 常见案例</a>
            </li>
            <li>
              <a href="#324_nfs">3.2.4 nfs客户端访问服务原理</a>
            </li>
            <li>
              <a href="#325_nfs">3.2.5 nfs服务访问原理</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#33_NFSrpcbind_nfs">3.3 NFS服务端设置rpcbind nfs服务开机自启动</a>
        </li>
        <li>
          <a href="#34_NFS">3.4 NFS配置文件编写说明</a><ul>
            <li>
              <a href="#341">3.4.1 官方举例配置</a>
            </li>
            <li>
              <a href="#342_etcexports">3.4.2 /etc/exports文件配置格式为：</a>
            </li>
          </ul>
        </li>
        
        <li>
          <a href="#35_nfs">3.5 nfs配置参数说明</a>
        </li>
        <li>
          <a href="#36_nfs">3.6 nfs配置参数实践</a><ul>
            <li>
              <a href="#361_all_squash">3.6.1 all_squash 参数实践</a>
            </li>
            <li>
              <a href="#362_no_all_squashroot_squash">3.6.2 no_all_squash,root_squash 参数实践</a>
            </li>
            <li>
              <a href="#363_no_root_squash_root">3.6.3 no_root_squash 参数实践（root用户不进行压缩映射）</a>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</div>