---
title: Nginx软件优化
author: 惨绿少年
type: post
date: 2018-03-01T06:13:00+00:00
url: /clsn/lx27.html
Baidusubmit:
  - 1
views:
  - 607
specs_zan:
  - 2
zm_like:
  - 2
categories:
  - Linux运维
  - Web应用
  - 玩转Linux
  - 运维基本功

---
<h2 style="mso-list: l10 level2 lfo4; margin: 6.0pt 0cm 6.0pt 25.1pt;">
  <span id="11_Nginx"><a name="_Toc507528100"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.1 </span></span><!--[endif]-->
  
  <span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528100;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">优化分类</span></span></span>
</h2>

<img class="size-medium wp-image-1323 aligncenter" data-original="/wp-content/uploads/2018/03/nginx-300x61.png" src="/wp-content/themes/clsn-003/img/blank.gif" alt="Nginx软件优化" alt="" width="300" height="61" srcset="/wp-content/uploads/2018/03/nginx-300x61.png 300w, /wp-content/uploads/2018/03/nginx.png 352w" sizes="(max-width: 300px) 100vw, 300px" /> 

<p class="MsoNormal" style="text-indent: 21.0pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">安全优化（提升网站安全性配置）</span>
</p>

<p class="MsoNormal" style="text-indent: 21.0pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">性能优化（提升用户访问网站效率）</span>
</p>

<h2 style="mso-list: l10 level2 lfo4; margin: 6.0pt 0cm 6.0pt 25.1pt;">
  <span id="12_Nginx"><a name="_Toc507528101"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2 </span></span><!--[endif]-->
  
  <span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528101;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">安全优化</span></span></span>
</h2>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="121_nginx"><a name="_Toc507528102"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.1 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">隐藏</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528102;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">版本信息优化</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">官方配置参数说明：</span><span lang="EN-US"><a href="/wp-content/themes/clsn-003/inc/go.php?url=http://nginx.org/en/docs/http/ngx_http_core_module.html#server_tokens" >http://nginx.org/en/docs/http/ngx_http_core_module.html#server_tokens</a></span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">官方参数：</span>
</p>

<div class="cnblogs_code">
  <pre>Syntax:  server_tokens on | off | build |<span style="color: #000000;"> string;
Default: server_tokens on;
Context: http, server, location</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">配置举例：</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /application/nginx/conf/nginx.conf</span>
worker_processes  1<span style="color: #000000;">;
events {
    worker_connections  </span>1024<span style="color: #000000;">;
}
http {
    include       mime.types;
    default_type  application</span>/octet-<span style="color: #000000;">stream;
    sendfile        off;
    keepalive_timeout  </span>65<span style="color: #000000;">;
    log_format  main  </span><span style="color: #800000;">'</span><span style="color: #800000;">$remote_addr - $remote_user [$time_local] "$request" </span><span style="color: #800000;">'</span>
                      <span style="color: #800000;">'</span><span style="color: #800000;">$status $body_bytes_sent "$http_referer" </span><span style="color: #800000;">'</span>
                      <span style="color: #800000;">'</span><span style="color: #800000;">"$http_user_agent" "$http_x_forwarded_for"</span><span style="color: #800000;">'</span><span style="color: #000000;">;
    server {
        listen       </span>80<span style="color: #000000;">;
        server_name  www.nmtui.com;
        server_tokens off;
        location </span>/<span style="color: #000000;"> {
            root   html</span>/<span style="color: #000000;">www;
            index  index.html index.htm;
        }
        access_log  logs</span>/<span style="color: #000000;">access_www.log  main;
    }
}</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">测试结果：</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> curl -I 10.0.0.8</span>
HTTP/1.1 200<span style="color: #000000;"> OK
Server: nginx
Date: Wed, </span>01 Nov 2017 18:32:40<span style="color: #000000;"> GMT
Content</span>-Type: text/<span style="color: #000000;">html
Content</span>-Length: 10<span style="color: #000000;">
Last</span>-Modified: Wed, 25 Oct 2017 01:20:56<span style="color: #000000;"> GMT
Connection: keep</span>-<span style="color: #000000;">alive
ETag: </span><span style="color: #800000;">"</span><span style="color: #800000;">59efe6f8-a</span><span style="color: #800000;">"</span><span style="color: #000000;">
Accept</span>-Ranges: bytes</pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="122_nginx"><a name="_Toc507528103"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.2 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">修改</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528103;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">版本信息</span></span></span>
</h3>

<p class="MsoNormal" style="margin-left: 21.0pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">修改版本信息需要修改程序源文件信息</span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">修改内核信息</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 nginx-1.10.2]<span style="color: #008000;">#</span><span style="color: #008000;"> vim  src/core/nginx.h</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ···</span>
 13 <span style="color: #008000;">#</span><span style="color: #008000;">define NGINX_VERSION      "1.0"</span>
 14 <span style="color: #008000;">#</span><span style="color: #008000;">define NGINX_VER          "clsn/" NGINX_VERSION</span>
 22 <span style="color: #008000;">#</span><span style="color: #008000;">define NGINX_VAR          "clsn"</span><span style="color: #008000;">
#</span><span style="color: #008000;"> ···</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">修改头部信息</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 nginx-1.10.2]<span style="color: #008000;">#</span><span style="color: #008000;"> vim  src/http/ngx_http_header_filter_module.c </span><span style="color: #008000;">
#</span><span style="color: #008000;"> ···</span>
 49 static char ngx_http_server_string[] = <span style="color: #800000;">"</span><span style="color: #800000;">Server: clsn</span><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF;
</span><span style="color: #008000;">#</span><span style="color: #008000;"> ···</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">修改错误页显示</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 nginx-1.10.2]<span style="color: #008000;">#</span><span style="color: #008000;"> vim src/http/ngx_http_special_response.c </span><span style="color: #008000;">
#</span><span style="color: #008000;"> ···</span><span style="color: #008000;">
#</span><span style="color: #008000;"> 此处可以不修改</span>
 21 static u_char ngx_http_error_full_tail[] =
 22 <span style="color: #800000;">"</span></pre>
  
  <hr />
  
  <p>
     
  </p>
  
  <pre><span style="color: #800000;">"</span> NGINX_VER <span style="color: #800000;">"</span><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF
 </span>23 <span style="color: #800000;">"</span><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF
 </span>24 <span style="color: #800000;">"</span><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF
 </span>25<span style="color: #000000;"> ;
</span><span style="color: #008000;">#</span><span style="color: #008000;"> ···</span>
 28 static u_char ngx_http_error_tail[] =
 29 <span style="color: #800000;">"</span></pre>
  
  <hr />
  
  <p>
    <center>
      clsn
    </center>
  </p>
  
  <pre><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF
 </span>30 <span style="color: #800000;">"</span><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF
 </span>31 <span style="color: #800000;">"</span><span style="color: #800000;">"</span><span style="color: #000000;"> CRLF
 </span>32<span style="color: #000000;"> ;
</span><span style="color: #008000;">#</span><span style="color: #008000;"> ···</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">修改完成后重新编译</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 nginx-1.10.2]<span style="color: #008000;">#</span><span style="color: #008000;"> ./configure  --prefix=/application/nginx-1.10.2 --user=www --group=www --with-http_stub_status_module --with-http_ssl_module</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">重启服务</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 nginx-1.10.2]<span style="color: #008000;">#</span><span style="color: #008000;"> /etc/init.d/nginx restart</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">访问测试是否修改成功</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> curl -I 127.0.0.1 </span>
HTTP/1.1 200<span style="color: #000000;"> OK
Server: clsn
Date: Wed, </span>01 Nov 2017 19:05:43<span style="color: #000000;"> GMT
Content</span>-Type: text/<span style="color: #000000;">html
Content</span>-Length: 10<span style="color: #000000;">
Last</span>-Modified: Wed, 25 Oct 2017 01:20:56<span style="color: #000000;"> GMT
Connection: keep</span>-<span style="color: #000000;">alive
ETag: </span><span style="color: #800000;">"</span><span style="color: #800000;">59efe6f8-a</span><span style="color: #800000;">"</span><span style="color: #000000;">
Accept</span>-Ranges: bytes</pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="123_worker"><a name="_Toc507528104"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.3 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">修改</span><span lang="EN-US">worker</span><span style="mso-bookmark: _Toc507528104;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">进程的用户</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">第一种方法：利用编译安装配置参数，设定</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">默认</span><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程用户</span>
</p>

<div class="cnblogs_code">
  <pre>useradd -s /sbin/nologin -<span style="color: #000000;">M www
.</span>/configure --user=www --group=www</pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">第二种方式：编写</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">服务配置文件，设定</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">默认</span><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程用户</span>
</p>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">官方配置参数说明：</span><span lang="EN-US"><a href="/wp-content/themes/clsn-003/inc/go.php?url=http://nginx.org/en/docs/ngx_core_module.html#user" >http://nginx.org/en/docs/ngx_core_module.html#user</a></span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">Syntax:user user [group];
Default: user nobody nobody;
Context: main</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">配置举例：</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web02 conf]<span style="color: #008000;">#</span><span style="color: #008000;"> cat nginx.conf</span>
user  www www;          <span style="color: #008000;">#</span><span style="color: #008000;"> 主区块添加user参数</span>
worker_processes  1<span style="color: #000000;">;
events {
    worker_connections  </span>1024<span style="color: #000000;">;
}</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看是否生效</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 nginx-1.10.2]<span style="color: #008000;">#</span><span style="color: #008000;"> ps -ef|grep nginx</span>
root      16987      1  0 15:14 ?        00:00:00<span style="color: #000000;"> nginx: master process nginx
clsn    </span>18484  16987  0 15:22 ?        00:00:00<span style="color: #000000;"> nginx: worker process
root      </span>18486   9593  0 15:22 pts/0    00:00:00 grep --color=auto nginx</pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="124"><a name="_Toc507528105"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.4 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">上传文件大小的限制（动态应用）</span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">默认语法说明</span><span lang="EN-US">:</span>
</p>

<div class="cnblogs_code">
  <pre>syntax：client_max_body_size size；    <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default：client_max_body_size 1m；    <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==默认值是1m</span>
context：http，server，location        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">举例配置：</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">http {
 sendfile        on;
 keepalive_timeout  </span>65<span style="color: #000000;">;
 client_max_body_size 8m;    </span><span style="color: #008000;">#</span><span style="color: #008000;"> 设置上传文件最大值8M</span>
}</pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="125_NginxURL"><a name="_Toc507528106"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.5 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">站点</span><span lang="EN-US"> Nginx</span><span style="mso-bookmark: _Toc507528106;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">站点目录及文件</span><span lang="EN-US">URL</span></span><span style="mso-bookmark: _Toc507528106;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">访问控制</span></span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span>01. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">根据目录或扩展名，禁止用户访问指定数据信息</span>
</p>

<div class="cnblogs_code">
  <pre>location ~ ^/images/.*\.（php|php5|sh|pl|py|<span style="color: #000000;">html）$ 
    { 
        deny all;
    } 
location </span>~ ^/static/.*\.（php|php5|sh|pl|<span style="color: #000000;">py）$ 
    { 
        deny all;
    } 
location </span>~* ^/data/（attachment|avatar）/.*\.（php|<span style="color: #000000;">php5）$ 
    { 
        deny all;
    } </span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span>02. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">当访问禁止的数据信息时，进行页面跳转</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">Nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">下配置禁止访问</span><span lang="EN-US">*.txt</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">和</span><span lang="EN-US">*.doc</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">文件。</span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">实际配置信息如下：</span>
</p>

<div class="cnblogs_code">
  <pre>location ~* \.（txt|<span style="color: #000000;">doc）$ {
    </span><span style="color: #0000ff;">if</span> （-<span style="color: #000000;">f $request_filename）{
    root </span>/data/www/<span style="color: #000000;">www;
    </span><span style="color: #008000;">#</span><span style="color: #008000;">rewrite …..可以重定向到某个URL</span>
    <span style="color: #0000ff;">break</span><span style="color: #000000;">;
    }
}
location </span>~* \.（txt|<span style="color: #000000;">doc）${
    root </span>/data/www/<span style="color: #000000;">www;
    denyall;
}</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span>03. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">根据</span><span lang="EN-US">IP</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">地址或网络进行访问策略控制</span>
</p>

<div class="cnblogs_code">
  <pre>location /<span style="color: #000000;"> { 
    deny </span>192.168.1.1<span style="color: #000000;">;
    allow </span>192.168.1.0/24<span style="color: #000000;">;
    allow </span>10.1.1.0/16<span style="color: #000000;">;
    deny all;
}</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span>04. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">采用</span><span lang="EN-US">if</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">判断方式，进行访问控制</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #0000ff;">if</span> （$remote_addr = 10.0.0.7<span style="color: #000000;"> ）{
        </span><span style="color: #0000ff;">return</span> 403<span style="color: #000000;">;
 }</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="126_Nginx"><a name="_Toc507528107"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.6 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">配置</span><span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528107;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">，禁止非法域名解析访问企业网站</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">第一种方式：配置一个</span><span lang="EN-US">server</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">虚拟主机区块，放置在所有</span><span lang="EN-US">server</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">区块最前面</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">server {
   listen </span>80<span style="color: #000000;">;
   server_name </span>-<span style="color: #000000;"> ;
   </span><span style="color: #0000ff;">return</span> 501<span style="color: #000000;">;
}</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">第二种方式：将计就计，通过你的域名访问时候，自动跳转到我的域名上</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">server {
   listen </span>80<span style="color: #000000;"> default_server;
   server_name _;
   rewrite </span>^（.*） http://www.nmtui.com/$1<span style="color: #000000;"> permanent;
}
</span><span style="color: #0000ff;">if</span> （$host !~ ^<span style="color: #000000;">www\.nmtui\.com$）
{
    rewrite </span>^（.*） http://www.nmtui.com/$1<span style="color: #000000;"> permanent;
}</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="127_Nginx"><a name="_Toc507528108"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.7 </span></span><!--[endif]-->
  
  <span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528108;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">图片及目录防盗链解决方案</span></span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">什么是资源盗链</span> <span lang="EN-US">?</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">简单地说，就是某些不法网站未经许可，通过在其自身网站程序里非法调用其他网站的资源，然后在自己的网站上显示这些调用的资源，达到填充自身网站的效果。</span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">实现盗链过程：</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">01. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">真正的合法网站（盗链的目标）</span><span lang="EN-US"><span style="mso-spacerun: yes;">  </span>web01<span style="mso-spacerun: yes;">   </span>www.nmtui.com www</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">站点目录有一个</span><span lang="EN-US">oldboy.jpg</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">图片</span>
</p>

<div class="cnblogs_code">
  <pre>    <span style="color: #008000;">#</span><span style="color: #008000;"> 配置静态虚拟主机</span>
<span style="color: #000000;">   server {
     listen       </span>80<span style="color: #000000;">;
     server_name  www.nmtui.com;
     location </span>/<span style="color: #000000;"> {
         root   html</span>/<span style="color: #000000;">www;
         index  index.html index.htm;
     }
   </span><span style="color: #008000;">#</span><span style="color: #008000;"> 确认生成盗链文件</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">   </span>02. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">不合法的网站（真正盗链网站）</span> <span lang="EN-US"><span style="mso-spacerun: yes;"> </span>www.daolian.com</span>
</p>

<div class="cnblogs_code">
  <pre>   <span style="color: #008000;">#</span><span style="color: #008000;"> 编写一个html盗链文件</span>
    
    
       
    
    <span style="color: #000000;">
       惨绿少年的博客！
    </span>
<span style="color: #000000;">我的博客是
    </span>&lt;<span style="color: #000000;">a
     href</span>=<span style="color: #800000;">"</span><span style="color: #800000;">http://www.nmtui.com</span><span style="color: #800000;">"</span> target=<span style="color: #800000;">"</span><span style="color: #800000;">_blank</span><span style="color: #800000;">"</span>><span style="color: #000000;">博客地址
    </span>
    <img style="color: #800000;" data-original="<span" src="/wp-content/themes/clsn-003/img/blank.gif" alt="Nginx软件优化" />"<span style="color: #800000;">http://www.nmtui.com/clsn.jpg</span><span style="color: #800000;">"</span>>

    
</pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">    </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">编写盗链虚拟主机</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">    server {
            listen       </span>80<span style="color: #000000;">;
            server_name  www.daolian.org;
            location </span>/<span style="color: #000000;"> {
                root   html;
                index  index.html index.htm;
            }   
        }</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-tab-count: 1;">         </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">至此就实现了盗链。</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">03 </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">常见防盗链解决方案的基本原理</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">1)<span style="mso-tab-count: 1;">     </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">根据</span><span lang="EN-US">HTTP referer</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">实现防盗链</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;">    </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">利用</span><span lang="EN-US">referer</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，并且针对扩展名</span><span lang="EN-US">rewrite</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">重定向，下面的代码为利用</span><span lang="EN-US">referer</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">且针对扩展名</span><span lang="EN-US">rewrite</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">重定向，即实现防盗链的</span><span lang="EN-US">Nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">配置。</span>
</p>

<div class="cnblogs_code">
  <pre>    location ~* /\.(jpg|gif|png|swf|flv|wma|wmv|asf|mp3|mmf|zip|<span style="color: #000000;">rar)$ {
        root  html</span>/<span style="color: #000000;">www;
        valid_referers none blocked </span>*<span style="color: #000000;">.nmtui.com nmtui.com;
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> （$invalid_referer）{ 
        rewrite </span>^/  http://www.nmtui.com/img/<span style="color: #000000;">nolink.jpg;
      } 
    } </span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-tab-count: 1;">         </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">设置</span><span lang="EN-US">expires</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的方法如下：</span>
</p>

<div class="cnblogs_code">
  <pre>    [root@clsn www]<span style="color: #008000;">#</span><span style="color: #008000;"> cat /application/nginx/conf/extra/www.conf </span>
<span style="color: #000000;">        server {
            listen            </span>80<span style="color: #000000;">;
            server_name        www.nmtui.com;
                root        html</span>/<span style="color: #000000;">www;
                index        index.html index.htm;
                access_log    logs</span>/<span style="color: #000000;">www_access.log main;
    </span><span style="color: #008000;">#</span><span style="color: #008000;">Preventing hot linking of images and other file types</span>
    location ~* ^.+\.（gif|jpg|png|swf|flv|rar|<span style="color: #000000;">zip）$ {
        valid_referers none blocked server_names </span>*<span style="color: #000000;">.nmtui.com nmtui.com;
        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> （$invalid_referer）{
            rewrite </span>^/ http：//www.nmtui.com/img/<span style="color: #000000;">nolink.jpg;
        }
        access_log off;
        root html</span>/<span style="color: #000000;">www;
        expires 1d;
        </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
       }
    }</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US">2) </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">根据</span><span lang="EN-US">cookie</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">防盗链</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">3) </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">通过加密变换访问路径实现防盗链</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">4) </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">在所有网站资源上添加网站信息，让盗链人员帮你做推广宣传</span>
</p>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="128_NGINX"><a name="_Toc507528109"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.8 </span></span><!--[endif]-->
  
  <span lang="EN-US">NGINX</span><span style="mso-bookmark: _Toc507528109;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">错误页面友好显示</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">范例</span><span lang="EN-US">1</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：对错误代码</span><span lang="EN-US">403</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">实行本地页面跳转，命令如下：</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;">##www</span>
<span style="color: #000000;">    server {
        listen       </span>80<span style="color: #000000;">;
        server_name  www.nmtui.com;
        location </span>/<span style="color: #000000;"> {
            root   html</span>/<span style="color: #000000;">www;
            index  index.html index.htm;
        }
        error_page  </span>403  /403.html;    <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==当出现403错误时，会跳转到403.html页面</span>
    }</pre>
</div>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <span lang="EN-US"># </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">上面的</span><span lang="EN-US">/403.html</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">是相对于站点根目录</span><span lang="EN-US">html/www</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的。</span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">范例</span><span lang="EN-US">2</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：</span><span lang="EN-US">50x</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">页面放到本地单独目录下，进行优雅显示。</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"> redirect server error pages to the static page /50x.html</span>
error_page   500 502 503 504  /<span style="color: #000000;">50x.html;
location </span>= /<span style="color: #000000;">50x.html {
    root   </span>/data0/www/<span style="color: #000000;">html;
}</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">范例</span><span lang="EN-US">3</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：改变状态码为新的状态码，并显示指定的文件内容，命令如下：</span>
</p>

<div class="cnblogs_code">
  <pre>error_page 404 =200 /<span style="color: #000000;">empty.gif;
    server {
        listen       </span>80<span style="color: #000000;">;
        server_name www.nmtui.com;
        location </span>/<span style="color: #000000;"> {
            root   </span>/data0/www/<span style="color: #000000;">bbs;
            index  index.html index.htm;
            fastcgi_intercept_errors on;
            error_page  </span>404 =200    /<span style="color: #000000;">ta.jpg;
            access_log  </span>/app/logs/<span style="color: #000000;">bbs_access.log  commonlog;
        }
}</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">范例</span><span lang="EN-US">4</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：错误状态码</span><span lang="EN-US">URL</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">重定向，命令如下：</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">server {
        listen       </span>80<span style="color: #000000;">;
        server_name www.nmtui.com;
        location </span>/<span style="color: #000000;"> {
            root   html</span>/<span style="color: #000000;">www;
            index  index.html index.htm;
        error_page   </span>404  https://<span style="color: #000000;">clsn.cnblogs.com;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==当出现404错误时，会跳转到指定的URL https://clsn.cnblogs.com页面显示给用户，这个URL一般是企业另外的可用地址</span>
            access_log  /app/logs/<span style="color: #000000;">bbs_access.log  commonlog;
        }
}</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="129_Nginx"><a name="_Toc507528110"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.9 </span></span><!--[endif]-->
  
  <span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528110;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">站点目录文件及目录权限优化</span></span></span>
</h3>

<div align="center">
  <table class="MsoTable15Grid4Accent3" style="width: 100.0%; border-collapse: collapse; border: none; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; mso-yfti-tbllook: 1184; mso-padding-alt: 0cm 5.4pt 0cm 5.4pt;" border="1" cellspacing="0" cellpadding="0">
    <tr style="mso-yfti-irow: -1; mso-yfti-firstrow: yes; mso-yfti-lastfirstrow: yes;">
      <td style="width: 24.36%; border: solid #A5A5A5 1.0pt; mso-border-themecolor: accent3; border-right: none; mso-border-top-alt: solid #A5A5A5 .5pt; mso-border-top-themecolor: accent3; mso-border-left-alt: solid #A5A5A5 .5pt; mso-border-left-themecolor: accent3; mso-border-bottom-alt: solid #A5A5A5 .5pt; mso-border-bottom-themecolor: accent3; background: #A5A5A5; mso-background-themecolor: accent3; padding: 0cm 5.4pt 0cm 5.4pt;" width="24%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 5;">
          <strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; color: white; mso-themecolor: background1;">服务器角色</span></strong>
        </p>
      </td>
      
      <td style="width: 42.32%; border-top: solid #A5A5A5 1.0pt; mso-border-top-themecolor: accent3; border-left: none; border-bottom: solid #A5A5A5 1.0pt; mso-border-bottom-themecolor: accent3; border-right: none; mso-border-top-alt: solid #A5A5A5 .5pt; mso-border-bottom-alt: solid #A5A5A5 .5pt; background: #A5A5A5; mso-background-themecolor: accent3; padding: 0cm 5.4pt 0cm 5.4pt;" width="42%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 1;">
          <strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; color: white; mso-themecolor: background1;">权限处理</span></strong>
        </p>
      </td>
      
      <td style="width: 33.32%; border: solid #A5A5A5 1.0pt; mso-border-themecolor: accent3; border-left: none; mso-border-top-alt: solid #A5A5A5 .5pt; mso-border-top-themecolor: accent3; mso-border-bottom-alt: solid #A5A5A5 .5pt; mso-border-bottom-themecolor: accent3; mso-border-right-alt: solid #A5A5A5 .5pt; mso-border-right-themecolor: accent3; background: #A5A5A5; mso-background-themecolor: accent3; padding: 0cm 5.4pt 0cm 5.4pt;" width="33%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 1;">
          <strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; color: white; mso-themecolor: background1;">安全系数</span></strong>
        </p>
      </td>
    </tr>
    
    <tr style="mso-yfti-irow: 0;">
      <td style="width: 24.36%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="24%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
          <strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">动态</span></strong><strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">Web</span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">集群</span></strong>
        </p>
      </td>
      
      <td style="width: 42.32%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="42%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">目录权限</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">755</span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">文件权限</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">644</span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">所用的目录，以及文件用户和组都是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">root</span>
        </p>
      </td>
      
      <td style="width: 33.32%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="33%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">环境为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">Nginx+PHP<span style="mso-tab-count: 1;">   </span></span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">文件不能被改，目录不能被写入，安全系数</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">10</span>
        </p>
      </td>
    </tr>
    
    <tr style="mso-yfti-irow: 1;">
      <td style="width: 24.36%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="24%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
          <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">static</span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">图片集群</span></strong>
        </p>
      </td>
      
      <td style="width: 42.32%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="42%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">目录权限</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">755</span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">文件权限</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">644</span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">所用的目录，以及文件用户和组都是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">root</span>
        </p>
      </td>
      
      <td style="width: 33.32%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="33%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">环境为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">Nginx<span style="mso-tab-count: 1;">    </span></span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">文件不能被改，目录不能被写入，安全系数</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">10</span>
        </p>
      </td>
    </tr>
    
    <tr style="mso-yfti-irow: 2; mso-yfti-lastrow: yes;">
      <td style="width: 24.36%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="24%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
          <strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">上传</span></strong><strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">upload</span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">集群</span></strong>
        </p>
      </td>
      
      <td style="width: 42.32%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="42%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">目录权限</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">755</span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">文件权限</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">644</span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">所用的目录，以及文件用户和组都是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">root</span>
        </p>
      </td>
      
      <td style="width: 33.32%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="33%">
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">特别：用户上传的目录设置为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">755</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">，用户和组使用</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">Nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务配置的用户</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;"><span style="mso-tab-count: 1;">     </span></span>
        </p>
        
        <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
          <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">文件不能被改，目录不能被写入，但是用户上传的目录允许写入文件且需要通过</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">Nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的其他功能来禁止读文件，安全系数</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">8</span>
        </p>
      </td>
    </tr>
  </table>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="1210_Nginx"><a name="_Toc507528111"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.10 </span></span><!--[endif]-->
  
  <span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528111;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">防爬虫优化</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">范例</span><span lang="EN-US">1</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：阻止下载协议代理，命令如下：</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #008000;">#</span><span style="color: #008000;"># Block download agents ##</span>
<span style="color: #0000ff;">if</span> （$http_user_agent ~* LWP：：Simple|BBBike|<span style="color: #000000;">wget）
 {
    </span><span style="color: #0000ff;">return</span> 403<span style="color: #000000;">;
}</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">范例</span><span lang="EN-US">2</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：添加内容防止</span><span lang="EN-US">N</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">多爬虫代理访问网站，命令如下：</span>
</p>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">这些爬虫代理使用“</span><span lang="EN-US">|</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">”分隔，具体要处理的爬虫可以根据需求增加或减少，添加的内容如下：</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #0000ff;">if</span> （$http_user_agent ~* <span style="color: #800000;">"</span><span style="color: #800000;">qihoobot|Baiduspider|Googlebot|Googlebot-Mobile|Googlebot-Image|Mediapartners-Google|Adsbot-Google|Yahoo！Slurp China|YoudaoBot|Sosospider|Sogou spider|Sogou web spider|MSNBot</span><span style="color: #800000;">"</span><span style="color: #000000;">）
 {
</span><span style="color: #0000ff;">return</span> 403<span style="color: #000000;">;
}</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="1211_NginxHTTP"><a name="_Toc507528112"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.11 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">利用</span><span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528112;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">限制</span><span lang="EN-US">HTTP</span></span><span style="mso-bookmark: _Toc507528112;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">的请求方法</span></span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US">#Only allow these request methods</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #0000ff;">if</span> （$request_method ！~ ^（GET|HEAD|<span style="color: #000000;">POST）$ ） {
    </span><span style="color: #0000ff;">return</span> 501<span style="color: #000000;">;
}</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US">#Do not accept DELETE</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，</span><span lang="EN-US">SEARCH and other methods</span>
</p>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="1212_nginx"><a name="_Toc507528113"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.2.12 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">使用普通用户启动</span><span lang="EN-US">nginx</span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US">1</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">、切换到普通用户家目录下，创建</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">所需文件</span>
</p>

<div class="cnblogs_code">
  <pre>[nginx@web01 ~]$ mkdir -p blog/<span style="color: #000000;">{conf,logs,html}
[nginx@web01 </span>~]$ cd blog/<span style="color: #000000;"> 
[nginx@web01 blog]$ cp </span>/application/nginx/conf/nginx.conf.default  ./conf/<span style="color: #000000;">
[nginx@web01 blog]$ grep </span>-vE <span style="color: #800000;">"</span><span style="color: #800000;">^$|#</span><span style="color: #800000;">"</span> conf/nginx.conf.default  >  conf/<span style="color: #000000;">nginx.conf
[nginx@web01 blog]$ cp </span>/application/nginx/conf/mime.types conf/</pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US">2</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">、编写配置文件</span>
</p>

<div class="cnblogs_code">
  <pre>[nginx@web01 ~]$ cat blog/conf/<span style="color: #000000;">nginx.conf
worker_processes  </span>4<span style="color: #000000;">;
worker_cpu_affinity </span>0001 0010 0100 1000<span style="color: #000000;">;
worker_rlimit_nofile </span>65535<span style="color: #000000;">;
error_log  </span>/home/nginx/blog/logs/<span style="color: #000000;">error.log;
user inca inca;
pid       </span>/home/nginx/blog/logs/<span style="color: #000000;">nginx.pid;
events {
    use epoll;
    worker_connections  </span>1024<span style="color: #000000;">;
}
http {
    include      mime.types;
    default_type  application</span>/octet-<span style="color: #000000;">stream;
    sendfile        on;
    keepalive_timeout  </span>65<span style="color: #000000;">;
    log_format  main  </span><span style="color: #800000;">'</span><span style="color: #800000;">$remote_addr - $remote_user [$time_local] "$request" </span><span style="color: #800000;">'</span>
                      <span style="color: #800000;">'</span><span style="color: #800000;">$status $body_bytes_sent "$http_referer" </span><span style="color: #800000;">'</span>
                      <span style="color: #800000;">'</span><span style="color: #800000;">"$http_user_agent" "$http_x_forwarded_for"</span><span style="color: #800000;">'</span><span style="color: #000000;">;
    server {
        listen       </span>8080<span style="color: #000000;">;
        server_name  www.etiantian.org;
        root   </span>/home/nginx/blog/<span style="color: #000000;">html;
        location </span>/<span style="color: #000000;"> {
            index  index.html index.htm;
                }
        access_log  </span>/home/nginx/blog/logs/<span style="color: #000000;">web_blog_access.log  main;
            }
}</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-tab-count: 1;">         </span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">注意：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">普通用户不能使用知名端口，需要使用其他端口启动服务</span>
</p>

<p class="MsoNormal">
  <span lang="EN-US">3</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">、检查配置文件语法，并启动</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">服务</span>
</p>

<div class="cnblogs_code">
  <pre>/application/nginx/sbin/nginx -t -c /home/nginx/blog/conf/<span style="color: #000000;">nginx.conf
或
</span>/application/nginx/sbin/nginx -c /home/nginx/blog/conf/nginx.conf &>/dev/null &</pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-tab-count: 1;">         </span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">注意：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">忽略一些不正确的输出信息</span>
</p>

<h2 style="mso-list: l10 level2 lfo4; margin: 6.0pt 0cm 6.0pt 25.1pt;">
  <span id="13_Nginx"><a name="_Toc507528114"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3 </span></span><!--[endif]-->
  
  <span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528114;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">性能优化</span></span></span>
</h2>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="131_nginx_worker"><a name="_Toc507528115"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.1 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">优化</span><span lang="EN-US">nginx worker</span><span style="mso-bookmark: _Toc507528115;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">进行个数</span></span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">服务主要有两个重要进程：</span>
</p>

> <p class="a4">
>    01） master进程：可以控制nginx服务的启动 停止 或重启
> </p>
> 
> <p class="a4">
>    02） worker进程：处理用户请求信息，帮助用户向后端服务进行请求（php mysql）
> </p>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;"> </span><span style="mso-spacerun: yes;"> </span></span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">添加</span><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程方法</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;"> vim nginx.conf
 worker_processes  </span>1; <span style="color: #008000;">#</span><span style="color: #008000;">  修改nginx配置文件中worker_processes指令后面的数值</span></pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US"><span style="mso-spacerun: yes;"> </span><span style="mso-spacerun: yes;"> </span></span><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">建议：</span></strong><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程数量</span><span lang="EN-US">=</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">等于</span><span lang="EN-US">CPU</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的核数</span><span lang="EN-US"><span style="mso-spacerun: yes;">   </span>worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程数量</span><span lang="EN-US">=</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">等于</span><span lang="EN-US">CPU</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的核数</span><span lang="EN-US">*2</span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; background: yellow; mso-highlight: yellow;">如何在一个系统中获悉</span><span lang="EN-US" style="background: yellow; mso-highlight: yellow;">CPU</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; background: yellow; mso-highlight: yellow;">核心是多少？</span>
</p>

<div class="cnblogs_code">
  <pre> ①. 利用top命令--<span style="color: #000000;">按数字1，获取到CPU核数信息
 ②. grep processor </span>/proc/cpuinfo|wc -<span style="color: #000000;">l
 ③. lscpu</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看</span><span lang="EN-US">cpu</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">核心数命令示例</span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">示例一</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> top  # 按数字1</span>
top - 03:22:48 up 9 days, 26 min,  4 users,  load average: 1.06, 0.99, 0.92<span style="color: #000000;">
Tasks: </span>107 total,   1 running, 106<span style="color: #000000;"> sleeping,   0 stopped,   0 zombie
Cpu0  :  </span>0.2%us,  0.6%sy,  0.0%ni, 99.0%id,  0.1%wa,  0.0%hi,  0.0%si,  0.0%<span style="color: #000000;">st
Cpu1  :  </span>0.1%us,  0.1%sy,  0.0%ni, 99.1%id,  0.7%wa,  0.0%hi,  0.0%si,  0.0%<span style="color: #000000;">st
Mem:    485984k total,   452536k used,    33448k free,    24984k buffers
Swap:   786428k total,     5912k used,   780516k free,   242048k cached</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">示例二</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> lscpu |grep CPU </span>
CPU op-mode(s):        32-bit, 64-<span style="color: #000000;">bit
CPU(s):                </span>2</pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">示例三</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web01 ~]<span style="color: #008000;">#</span><span style="color: #008000;"> grep processor /proc/cpuinfo </span>
<span style="color: #000000;">processor    : 0
processor    : </span>1</pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="132_nginxCPU"><a name="_Toc507528116"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.2 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">绑定不同的</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528116;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">进程到不同的</span><span lang="EN-US">CPU</span></span><span style="mso-bookmark: _Toc507528116;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">上</span></span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US">4</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">个</span><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程分配</span><span lang="EN-US">CPU</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">资源方法：</span>
</p>

<div class="cnblogs_code">
  <pre>worker_processes    4<span style="color: #000000;">；
worker_cpu_affinity </span>0001 0010 0100 1000；</pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US">8</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">个</span><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程分配</span><span lang="EN-US">CPU</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">资源方法</span><span lang="EN-US">;</span>
</p>

<div class="cnblogs_code">
  <pre>worker_processes    8<span style="color: #000000;">；
worker_cpu_affinity </span>0001 0010 0100 1000 0001 0010 0100 1000； <span style="color: #008000;">#</span><span style="color: #008000;"> 分配8进程方法</span>
worker_cpu_affinity 00000001 00000010 00000100 00001000 00010000 00100000 01000000 10000000；</pre>
</div>

<p class="MsoNormal">
  <span lang="EN-US">4</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">个</span><span lang="EN-US">worker</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进程分配</span><span lang="EN-US">CPU</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">资源方法：</span>
</p>

<div class="cnblogs_code">
  <pre>worker_processes    4<span style="color: #000000;">；
worker_cpu_affinity </span>0101 1010；  <span style="color: #008000;">#</span><span style="color: #008000;"> 将进程分配到两颗CPU上</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="133_nginx"><a name="_Toc507528117"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.3 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">优化</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528117;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">事件处理模型</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">官方配置参数说明：</span><span lang="EN-US"><a href="/wp-content/themes/clsn-003/inc/go.php?url=http://nginx.org/en/docs/ngx_core_module.html#use" >http://nginx.org/en/docs/ngx_core_module.html#use</a></span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">Syntax:    use method;
Default:    —
Context:    events</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">关于事件处理模型可以参考：</span><span lang="EN-US"><a href="https://clsn.cnblogs.com/p/7750615.html#auto_id_10">https://clsn.cnblogs.com/p/7750615.html#auto_id_10</a></span>
</p>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">举例配置：</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">user  www www;
worker_processes  </span>1<span style="color: #000000;">;
events {
    worker_connections  </span>1024<span style="color: #000000;">;
    use epoll;         </span>---<span style="color: #000000;"> 指定使用的模型为epoll
}</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="134_nginx"><a name="_Toc507528118"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.4 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">调整</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528118;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">单个进程允许的客户端最大连接数</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">当前的打开文件数</span>
</p>

<div class="cnblogs_code">
  <pre>[root@clsn ~]<span style="color: #008000;">#</span><span style="color: #008000;"> lsof -i:80</span>
COMMAND   PID USER   FD   TYPE   DEVICE SIZE/<span style="color: #000000;">OFF NODE NAME
nginx   </span>10422 root    6u  IPv4 11868856      0t0  TCP *<span style="color: #000000;">:http (LISTEN)
nginx   </span>10424  www    6u  IPv4 11868856      0t0  TCP *<span style="color: #000000;">:http (LISTEN)
nginx   </span>10425  www    6u  IPv4 11868856      0t0  TCP *:http</pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">修改最大连接数方法</span>
</p>

<div class="cnblogs_code">
  <pre><span style="color: #000000;">vim nginx.conf
 events        </span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==events指令是设定Nginx的工作模式及连接数上限</span>
<span style="color: #000000;"> {
   worker_connections </span>1024<span style="color: #000000;">；
 }</span></pre>
</div>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <strong style="mso-bidi-font-weight: normal;"><span lang="EN-US" style="color: red;"><span style="mso-spacerun: yes;"> </span></span></strong><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">说</span><span lang="EN-US" style="color: red;"><span style="mso-tab-count: 1;">    </span></span></strong><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">明</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：此数值设置不要超过系统最大打开文件数量。</span>
</p>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="135_Nginx_worker"><a name="_Toc507528119"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.5 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">配置</span><span lang="EN-US">Nginx worker</span><span style="mso-bookmark: _Toc507528119;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">进程最大打开文件数</span></span></span>
</h3>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">举例配置：</span>
</p>

<div class="cnblogs_code">
  <pre>[root@web02 conf]<span style="color: #008000;">#</span><span style="color: #008000;"> cat nginx.conf</span>
<span style="color: #000000;">user  www www;
worker_processes  </span>1<span style="color: #000000;">;
worker_rlimit_nofile </span>2048;   <span style="color: #008000;">#</span><span style="color: #008000;"> 设置worker进程打开文件数</span></pre>
</div>

<h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
  <span id="136_nginx"><a name="_Toc507528120"></a><!-- [if !supportLists]-->
  
  <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.6 </span></span><!--[endif]-->
  
  <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">优化</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528120;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">高效文件传输模式</span></span></span>
</h3>

<p class="MsoNormal">
  <span lang="EN-US">sendfile</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">参数的官方说明如下：</span>
</p>

<div class="cnblogs_code">
  <pre>syntax：sendfile on | off;                              <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default：sendfile off;                                  <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数默认大小</span>
context：http，server，location，<span style="color: #0000ff;">if</span> <span style="color: #0000ff;">in</span> location         <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
</div>

<p class="MsoNormal">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">说明：在系统内核中，利用零拷贝方式实现数据传输</span>
</p>

<p class="MsoNormal">
  <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red; background: yellow; mso-highlight: yellow;">实现高效数据传输的两种方式</span></strong>
</p>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">第一种方式：</span><span lang="EN-US">tcp_nopush</span>
</p>

<div class="cnblogs_code">
  <pre>syntax： tcp_nopush on | off;        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default： tcp_nopush off;            <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数默认大小</span>
context： http，server，location        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
</div>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">说明：将数据包积攒到一定量时再进行传输</span>
</p>

<p class="MsoNormal" style="text-indent: 15.75pt;">
  <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">参数作用：</span>
</p>

> <p class="MsoNormal" style="text-indent: 15.75pt;">
>    　　激活或禁用Linux上的TCP_NODELAY选项。这个参数启用只在连接传输进入到 keep-alive状态。TCP_NODELAY和TCP_CORK基本上控制了包的"Nagle化"，Nagle化在这里 的含义是采用Nagle算法把较小的包组装为更大的帧。John Nagle是Nagle算法的发明人，后者就是用他的名字来命名的。
> </p>
> 
> <p class="MsoNormal" style="text-indent: 15.75pt;">
>    　　此算法解决的问题就是所谓的silly window syndrome,中文称"愚蠢窗口症候群"，具体含义是，因为普遍终端应用程序每产生一次击键操作就会发送一个包，很轻易地就能令网络发生拥塞，Nagle化后来成了一种标准并且立即在因特网上得以实现。它现在已经成为缺省配置了，但在我们看来，有些场合下希望发送小块数据，把这一选项关掉也是合乎需要的。
> </p>
> 
> <p class="MsoNormal" style="text-indent: 15.75pt;">
>   </blockquote> 
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">第二种方式：</span><span lang="EN-US">tcp_nodelay</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>Syntax:         tcp_nodelay on |<span style="color: #000000;"> off;
Default:     tcp_nodelay on;
Context:     http, server, location</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">说明：只要有数据包产生，不管大小多少，就尽快传输</span><span lang="EN-US"><span style="mso-spacerun: yes;">  </span></span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">参数作用：</span>
>   </p>
>   
>   <blockquote>
>     <p class="a4">
>       　　激活或禁用Linux上的TCP_CORK socket选项，tcp_cork是linux下tcp/ip传输的一个标准了，这个标准的大概的意思是，一般情况下，在tcp交互的过程中，当应用程序接收到数据包后马上传送出去，不等待，而tcp_cork选项是数据包不会马上传送出去，等到数据包最大时，一次性的传输出去，这样有助于解决网络堵塞，已经是默认了。
>     </p>
>     
>     <p class="a4">
>       　　此选项仅仅当开启sendfile时才生效， 激活这个.tcp_nopush参数可以允许把http response header和响应数据文件的开始部分放在一个文件里发布，其积极的作用是减少网络报文段的数量。
>     </p>
>   </blockquote>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red; background: yellow; mso-highlight: yellow;">强调：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">两个指令是相悖的，请选择其一开启，不要同时开启</span><span lang="EN-US">;</span>
>   </p>
>   
>   <p class="MsoNormal" style="margin-left: 42.0pt; text-indent: 11.0pt; mso-char-indent-count: 1.0;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">默认采用</span><span lang="EN-US">tcp_nodelay</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">方式进行传输。</span>
>   </p>
>   
>   <h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
>     <span id="137_nginx"><a name="_Toc507528121"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.7 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">设置</span><span lang="EN-US">nginx</span><span style="mso-bookmark: _Toc507528121;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">服务超时参数</span></span></span>
>   </h3>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">Nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">连接超时的参数设置</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">1) </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">设置参数： <span class="cnblogs_code">keepalive_timeout 60; <span style="color: #008000;">#</span><span style="color: #008000;"> 长连接才有意义</span></span> </span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">keepalive_timeout</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">参数的官方说明如下：</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>syntax：keepalive_timeout timeout [header_timeout];<span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default：keepalive_timeout 75s;<span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数默认大小</span>
context：http，server，location                 <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">说明：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">客户端和服务端都没有数据传输时，进行超时时间倒计时，一旦超时时间读取完毕还没有数据传输，就断开连接</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">2) </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">设置参数：</span><span lang="EN-US">client_header_timeout 55;</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>syntax：client_header_timeout time;        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default：client_header_timeout 60s;        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数默认大小</span>
context：http，server                     <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">说明：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">表示定义客户端请求报文发送的间隔超时时间，客户端发送的请求报文中请求头信息的间隔时间</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">3</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）设置参数：</span><span lang="EN-US">client_body_timeout 55;</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>syntax：client_body_timeout time;        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default：client_body_timeout 60s;        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==默认值是60秒</span>
context：http，server，location            <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">说明：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">表示定义服务端响应报文发送的间隔超时时间，客户端发送的请求报文中请求主体信息的间隔时间</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">4</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">）设置参数：</span><span lang="EN-US">send_timeout 60s</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>syntax：send_timeout time;            <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==参数语法</span>
default：send_timeout 60s;            <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==默认值是60秒</span>
context：http，server，location        <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==可以放置的标签段</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">说明：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">表示定义客户端读取服务端响应报文的间隔超时时间，服务端发送的响应报文间隔时间</span>
>   </p>
>   
>   <h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
>     <span id="138_Nginx_gzip"><a name="_Toc507528122"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.8 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">配置</span><span lang="EN-US">Nginx gzip</span><span style="mso-bookmark: _Toc507528122;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">压缩实现性能优化</span></span></span>
>   </h3>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">1.<span style="mso-tab-count: 1;">     </span>Nginx gzip</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">压缩功能介绍</span>
>   </p>
>   
>   <p class="MsoNormal" style="text-indent: 21.0pt;">
>     <span lang="EN-US">Nginx gzip</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">压缩模块提供了压缩文件内容的功能，用户请求的内容在发送到用户客户端之前，</span><span lang="EN-US"> Nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">服务器会根据一些具体的策略实施压缩，以节约网站出口带宽，同时加快数据传输效率，来提升用户访问体验。</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">2.<span style="mso-tab-count: 1;">     </span>Nginx gzip</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">压缩的优点</span>
>   </p>
>   
>   <blockquote>
>     <p class="MsoNormal" style="margin-left: 30px;">
>       <span style="background-color: initial;">提升网站用户体验：</span>
>     </p>
>     
>     <p class="MsoNormal" style="margin-left: 30px;">
>       <span style="background-color: initial;">　　发送给用户的内容小了，用户访问单位大小的页面就加快了，用户体验提升了，网站口碑就好了。</span>
>     </p>
>     
>     <p class="MsoNormal" style="margin-left: 30px;">
>        节约网站带宽成本：
>     </p>
>     
>     <p class="MsoNormal" style="margin-left: 30px;">
>        　　数据是压缩传输的，因此节省了网站的带宽流量成本，不过压缩时会稍 微消耗一些CPU资源，这个一般可以忽略。
>     </p>
>   </blockquote>
>   
>   <p class="MsoNormal" style="text-indent: 21.0pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">此功能既能提升用户体验，又能使公司少花钱，一举多得。对于几乎所有的</span><span lang="EN-US">Web</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">服务来说，这</span> <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">是一个非常重要的功能，</span><span lang="EN-US">Apache</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">服务也有此功能。</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; background: yellow; mso-highlight: yellow;">官方用法参考链接：</span></strong><span lang="EN-US"><a href="/wp-content/themes/clsn-003/inc/go.php?url=http://nginx.org/en/docs/http/ngx_http_gzip_module.html#gzip" >http://nginx.org/en/docs/http/ngx_http_gzip_module.html#gzip</a></span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre><span style="color: #000000;">gzip on;
gzip_min_length        1k;
gzip_buffers        </span>4<span style="color: #000000;"> 16k;
gzip_http_version    </span>1.1<span style="color: #000000;">;
gzip_comp_level     </span>4<span style="color: #000000;">;
gzip_types             text</span>/css text/xml application/<span style="color: #000000;">javascript;
gzip_vary             on;</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red;">说明：</span></strong><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">将服务端响应的数据信息进行压缩，可以有效节省带宽，提高用户访问效率</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; color: red; background: yellow; mso-highlight: yellow;">需要和不需要压缩的对象</span></strong>
>   </p>
>   
>   <blockquote>
>     <ol>
>       <li>
>         纯文本内容压缩比很高，因此，纯文本的内容最好进行压缩，例如：html、js、css、xml、shtml等格式的文件。
>       </li>
>       <li>
>         被压缩的纯文本文件必须要大于1KB，由于压缩算法的特殊原因，极小的文件压缩后可能反而变大。
>       </li>
>       <li>
>         图片、视频（流媒体）等文件尽量不要压缩，因为这些文件大多都是经过压缩的。
>       </li>
>       <li>
>         如果再压缩很可能不会减小或减小很少，或者有可能增大，同时压缩时还会消耗大量的CPU、内存资源。
>       </li>
>     </ol>
>   </blockquote>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; background: lime; mso-highlight: lime;">压缩配置参数说明</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre><span style="color: #000000;">gzip on ;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==开启gzip压缩功能。 </span>
<span style="color: #000000;">
gzip_min_length lk;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==设置允许压缩的页面最小宇节数，页面宇节数从header头的Content-Length中获取。默认值是0,表示不管页面多大都进行压缩。建议设置成大于1K,如果小于1K可能会越压越大。 </span>
<span style="color: #000000;">
gzip_buffers    </span>4<span style="color: #000000;"> 16k;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==压缩缓冲区大小。表示申请4个单位为16K的内存作为压缩结果流缓存，默认值是申请与原始数据 大小相同的内存空间来存储gzip压缩结果。 </span>
<span style="color: #000000;">
gzip_http_version </span>1.1<span style="color: #000000;"> ;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==压缩版本（默认1.1,前端为squid2.5时使用1.0),用于设置识别HTTP协议版本，默认是1.1, 目前大部分浏览器已经支持GZIP解压，使用默认即可。 </span>
<span style="color: #000000;">
gzip_comp_level </span>2<span style="color: #000000;"> ;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==压缩比率。用来指定gzip压缩比，1压缩比最小，处理速度最快；9压缩比最大，传输速度快，但处理最慢，也比较消耗CPU资源。</span>
<span style="color: #000000;">
gzip_types text</span>/plain application/x-javascript text/css application/<span style="color: #000000;">xml ;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==用来指定压缩的类型，"text/html"类型总是会被压缩，这个就是HTTP原理部分讲的媒体类型。 </span>
<span style="color: #000000;">
gzip_vary on ;
</span><span style="color: #008000;">#</span><span style="color: #008000;">&lt;==vary header支持。该选项可以让前端的缓存服务器缓存经过gzip压缩的页面，例如用Squid缓存 经过Nginx压缩的数据。</span></pre>
>   </div>
>   
>   <h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
>     <span id="139_Nginx_expires"><a name="_Toc507528123"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.9 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">配置</span><span lang="EN-US">Nginx expires</span><span style="mso-bookmark: _Toc507528123;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">缓存实现性能优化</span></span></span>
>   </h3>
>   
>   <p class="MsoNormal" style="text-indent: 21.0pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">简单地说，</span><span lang="EN-US">Nginx expires</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">的功能就是为用户访问的网站内容设定一个过期时间，当用户第一次访问这些内容时，会把这些内容存储在用户浏览器本地，这样用户第二次及以后继续访问该网站时，浏览器会检查加载已经缓存在用户浏览器本地的内容，就不会去服务器下载了，直到缓存的内容过期或被清除为止。</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <strong style="mso-bidi-font-weight: normal;"><span lang="EN-US" style="background: yellow; mso-highlight: yellow;">Nginx expires</span></strong><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; background: yellow; mso-highlight: yellow;">功能优点</span></strong>
>   </p>
>   
>   <blockquote>
>     <ol>
>       <li>
>         expires可以降低网站的带宽，节约成本。
>       </li>
>       <li>
>         加快用户访问网站的速度，提升用户访问体验。
>       </li>
>       <li>
>         服务器访问量降低了，服务器压力就减轻了，服务器成本也会降低，甚至可以节约人力成本。
>       </li>
>       <li>
>         对于几乎所有的Web服务来说，这是非常重要的功能之一，Apache服务也有此功能。
>       </li>
>     </ol>
>   </blockquote>
>   
>   <p class="MsoNormal">
>     <strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin; background: yellow; mso-highlight: yellow;">实践配置</span></strong>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>[root@web02 extra]<span style="color: #008000;">#</span><span style="color: #008000;"> cat blog.conf </span>
<span style="color: #000000;">server {
        listen       </span>80<span style="color: #000000;">;
        server_name  blog.etiantian.org;
        server_tokens off;
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 静态请求处理的location</span>
        location /<span style="color: #000000;"> {
            root   html</span>/<span style="color: #000000;">blog;
            index  index.php index.html index.htm;
        }
        </span><span style="color: #008000;">#</span><span style="color: #008000;"> 动态请求处理的location</span>
        location ~* .*\.(php|<span style="color: #000000;">php5)?$ {
            root html</span>/<span style="color: #000000;">blog;
            fastcgi_pass  </span>127.0.0.1:9000<span style="color: #000000;">;
            fastcgi_index index.php;
            include fastcgi.conf;
        }
       location </span>~ .*\.(gif|jpg|jpeg|png|bmp|<span style="color: #000000;">swf)$
       {
          expires      10y;
          root   html</span>/<span style="color: #000000;">blog;
       }
        location </span>~ .*\.(js|<span style="color: #000000;">css)$
        {
           expires      30d;
           root    html</span>/<span style="color: #000000;">blog;
        } 
    }
   
   location </span>/<span style="color: #000000;"> {
        expires 3650d;
 }</span></pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">企业网站有可能不希望被缓存的内容</span>
>   </p>
>   
>   <blockquote>
>     <ol>
>       <li>
>         广告图片，用于广告服务，都缓存了就不好控制展示了。
>       </li>
>       <li>
>         网站流量统计工具（JS代码），都缓存了流量统计就不准了。
>       </li>
>       <li>
>         更新很频繁的文件（google的logo），这个如果按天，缓存效果还是显著的。
>       </li>
>     </ol>
>   </blockquote>
>   
>   <h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
>     <span id="1310_FastCGI"><a name="_Toc507528124"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.3.10 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">配置</span><span lang="EN-US">FastCGI</span><span style="mso-bookmark: _Toc507528124;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">优化</span></span></span>
>   </h3>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">FastCGI Cache</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">资料见</span><span lang="EN-US">:</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US"><a href="/wp-content/themes/clsn-003/inc/go.php?url=http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_cache" >http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_cache</a></span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">FastCGI</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">常见参数的</span><span lang="EN-US">Nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">配置示例如下</span><span lang="EN-US">:</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>[root@nginx conf]<span style="color: #008000;">#</span><span style="color: #008000;"> cat nginx.conf</span>
worker_processes  4<span style="color: #000000;">;
worker_cpu_affinity </span>0001 0010 0100 1000<span style="color: #000000;">;
worker_rlimit_nofile </span>65535<span style="color: #000000;">;
user nginx;
events {
    use epoll;
    worker_connections  </span>10240<span style="color: #000000;">;
}
http {
    include       mime.types;
    default_type  application</span>/octet-<span style="color: #000000;">stream;
    sendfile        on;
    tcp_nopush on;
    keepalive_timeout  </span>65<span style="color: #000000;">;
    tcp_nodelay on;
    client_header_timeout </span>15<span style="color: #000000;">;
    client_body_timeout </span>15<span style="color: #000000;">;
    send_timeout </span>15<span style="color: #000000;">;
    log_format  main  </span><span style="color: #800000;">'</span><span style="color: #800000;">$remote_addr - $remote_user [$time_local] "$request" </span><span style="color: #800000;">'</span>
                      <span style="color: #800000;">'</span><span style="color: #800000;">$status $body_bytes_sent "$http_referer" </span><span style="color: #800000;">'</span>
                      <span style="color: #800000;">'</span><span style="color: #800000;">"$http_user_agent" "$http_x_forwarded_for"</span><span style="color: #800000;">'</span><span style="color: #000000;">;
    server_tokens off;
    fastcgi_connect_timeout </span>240<span style="color: #000000;">;
    fastcgi_send_timeout </span>240<span style="color: #000000;">;
    fastcgi_read_timeout </span>240<span style="color: #000000;">;
    fastcgi_buffer_size 64k;
    fastcgi_buffers </span>4<span style="color: #000000;"> 64k;
    fastcgi_busy_buffers_size 128k;
    fastcgi_temp_file_write_size 128k;
    </span><span style="color: #008000;">#</span><span style="color: #008000;">fastcgi_temp_path /data/ngx_fcgi_tmp;</span>
    fastcgi_cache_path /data/ngx_fcgi_cache levels=2:2 keys_zone=ngx_fcgi_cache:512m inactive=1d max_size=<span style="color: #000000;">40g;
    </span><span style="color: #008000;">#</span><span style="color: #008000;">web...............</span>
<span style="color: #000000;">    server {
        listen       </span>80<span style="color: #000000;">;
        server_name  blog.nmtui.com;
        root   html</span>/<span style="color: #000000;">blog;
        location </span>/<span style="color: #000000;"> {
            root   html</span>/<span style="color: #000000;">blog;
            index  index.php index.html index.htm;
                }
        location </span>~ .*\.（php|<span style="color: #000000;">php5）${      
            fastcgi_pass  </span>127.0.0.1:9000<span style="color: #000000;">;
            fastcgi_index index.php;
            include fastcgi.conf;
            fastcgi_cache ngx_fcgi_cache;
            fastcgi_cache_valid </span>200 302<span style="color: #000000;"> 1h;
            fastcgi_cache_valid </span>301<span style="color: #000000;"> 1d;
            fastcgi_cache_valid any 1m;
            fastcgi_cache_min_uses </span>1<span style="color: #000000;">;
            fastcgi_cache_use_stale error timeout invalid_header http_500;
            fastcgi_cache_key http:</span>//<span style="color: #000000;">$host$request_uri;
                }
        access_log  logs</span>/<span style="color: #000000;">web_blog_access.log  main;
           }
    upstream blog_etiantian{
        server </span>10.0.0.8:8000 weight=1<span style="color: #000000;">;
}
    server {
        listen       </span>8000<span style="color: #000000;">;
        server_name  blog.nmtui.com;
        location </span>/<span style="color: #000000;"> {
            proxy_pass http:</span>//<span style="color: #000000;">blog_etiantian;
            proxy_set_header Host  $host;
            proxy_set_header X</span>-Forwarded-<span style="color: #000000;">For  $remote_addr;
              }
        access_log  logs</span>/<span style="color: #000000;">proxy_blog_access.log  main;
           }
}</span></pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <strong style="mso-bidi-font-weight: normal;"><span lang="EN-US">FastCGI</span></strong><strong style="mso-bidi-font-weight: normal;"><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">常见参数列表说明：</span></strong>
>   </p>
>   
>   <table class="MsoTable15Grid4Accent3" style="width: 100.0%; border-collapse: collapse; border: none; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; mso-yfti-tbllook: 1184; mso-padding-alt: 0cm 5.4pt 0cm 5.4pt;" border="1" cellspacing="0" cellpadding="0">
>     <tr style="mso-yfti-irow: -1; mso-yfti-firstrow: yes; mso-yfti-lastfirstrow: yes;">
>       <td style="width: 43.34%; border: solid #A5A5A5 1.0pt; mso-border-themecolor: accent3; border-right: none; mso-border-top-alt: solid #A5A5A5 .5pt; mso-border-top-themecolor: accent3; mso-border-left-alt: solid #A5A5A5 .5pt; mso-border-left-themecolor: accent3; mso-border-bottom-alt: solid #A5A5A5 .5pt; mso-border-bottom-themecolor: accent3; background: #A5A5A5; mso-background-themecolor: accent3; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: center; text-indent: 15.75pt; mso-yfti-cnfc: 5;" align="center">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体; color: white; mso-themecolor: background1;">Nginx FastCGI </span></strong><strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; color: white; mso-themecolor: background1;">相关参数</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border: solid #A5A5A5 1.0pt; mso-border-themecolor: accent3; border-left: none; mso-border-top-alt: solid #A5A5A5 .5pt; mso-border-top-themecolor: accent3; mso-border-bottom-alt: solid #A5A5A5 .5pt; mso-border-bottom-themecolor: accent3; mso-border-right-alt: solid #A5A5A5 .5pt; mso-border-right-themecolor: accent3; background: #A5A5A5; mso-background-themecolor: accent3; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: center; text-indent: 15.75pt; mso-yfti-cnfc: 1;" align="center">
>           <strong><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; color: white; mso-themecolor: background1;">说明</span></strong>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 0;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_connect_timeout</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">表示</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务器和后端</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务器连接的超时时间，默认值为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">60</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">秒，</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">这个参数值通常不要超过</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">75</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">秒，因为建立的连接越多，消耗的资源就越多</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 1;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_send_timeout</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">设置</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">传输请求到</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务器的超时时间，这个超时时间不是整个请</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">求的超时时间，而是两个成功请求的之间间隔时间为超时时间，如果这个时间</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">内，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务没有收到任何信息，连接将关闭</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 2;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_read_timeout</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">设置</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">从</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务器读取响应信息的超时时间苯示连捿建立成功后，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;"> nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">等待后端服务器的响应时间，是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">进入后端的排队之中的等候处理</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的时间，实际上是读取</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">响应成功信息的间隔时间，</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 3;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_buffer_size</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">这是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">Nginx FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的缓冲区大小参数，设定用来读取从</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务器端收</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">到的第一部分响应信息的缓冲区大小，这里的第一部分通常会包含一个小的响</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">应头部</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">s</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">默认情况下，这个参数的大小等价于</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">_</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">个内存页。不是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">4k</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">就是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">8k </span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">根据相应系统平台来决定，也可以更小。</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 4;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_buffers</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">设定用来读取从</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">服务器端收到的响应信息的缓冲区大小和缓冲区数</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">是，默认值为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_buffer 8 4k|8k;</span>
>         </p>
>         
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">指定本地需要用多少和多大的缓冲区来缓冲</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的应答请求，如果一个</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;"> PHP</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">脚本产生的页面大小为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">256KB ,</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">那么会为其分配</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">4</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">个</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">64KB</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的缓冲区来缓</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">存；如果页面大小大于</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">256KB ,</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">那么大于</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">256KB</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的部分会缓存到</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_temp </span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">指定的路径中，但是这并不是好方法，因为内存中的数据处理速度要快于硬盘。</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">一般这个值应该为站点中</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">PHP</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">脚本产生的页面大小的中间值，如果站点大部分</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">脚本所产生的页面大小为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">256KB ,</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">那么可以把这个值设置为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">"16 16k" , "4 64k"</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">等</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 5;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_busy_buffers_size</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">用于设置系统很忙时可以使用的</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_buffers</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">大小，言方推荐的大小为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_buffers*2 ;</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">默认值为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;"> fastcgi_busy_buffers_size 8k|16k</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 6;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_temp_file_write_size</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">临时文件的大小，可以设置为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">128~256KB ; </span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">默认</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_temp_file_write_size 8k|16k;</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 7;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache oldboy_nginx</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">表示开后</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">FastCGI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">缓存并为其指定一个名称。开后缓存非常有用，可以有效降</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">低</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">CPU</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的负载，并且防止</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">502</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">错误的发生，但是开后缓存也可能引起其它问</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">题，要根据具体情况来选择</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 8;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_path</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">实例：</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_path /data/nginx/cache levels = 2:2 keys_zone = ngx_fcgi_cache:512m inactive = ld max_size=40g; fastcgi_cache</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">缓存目录，可以设置目录前列层级，比如</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">2:2</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">会生成</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">256*256 </span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">个子目录，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">keys_zone</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">是这个缓存空间的名字，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">cache</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">是用多少内存（这样热</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">门的内容，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">会直接放入内存，提高访问速度）。</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">inactive</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">表示默认失效时</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">间，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">max_size</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">表示最多用多少硬盘空间，雲要注意的是</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">缓存是</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">先写在</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_temp_path</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">在移到</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_path</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">中去的，所以这个两个</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">目录最好在同一个分区，从</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">0.8.9</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">之后可以在不同的分区，不过还是建议放在</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">同</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">_</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">分区。</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 9;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_valid</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">示例：</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_valid 200 302 lh;<span style="mso-spacerun: yes;">  </span></span>
>         </p>
>         
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">用来指定应答代码的缓存时间，实例中的值表示将</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">200</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">和</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">302</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">应答缓存</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">1</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">个小</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">时；</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;"><span style="mso-spacerun: yes;">  </span></span>
>         </p>
>         
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">示例：</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_valid 301 Id;<span style="mso-spacerun: yes;">  </span></span>
>         </p>
>         
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">将</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">301</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">应答缓存</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">1</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">天；</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 10;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_min_uses</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">示例：</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_min_uses 1;<span style="mso-spacerun: yes;">  </span></span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">设置清求几次之后晌应将被缓存，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">1</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">表示一次即被缓存</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 11;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 4;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_use_stale</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">示例：</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_use_stale error timeout invalid_header http_500 </span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">定义在哪些情况下使用过期缓存</span>
>         </p>
>       </td>
>     </tr>
>     
>     <tr style="mso-yfti-irow: 12; mso-yfti-lastrow: yes;">
>       <td style="width: 43.34%; border: solid #C9C9C9 1.0pt; mso-border-themecolor: accent3; mso-border-themetint: 153; border-top: none; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="43%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 68;">
>           <strong><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_key</span></strong>
>         </p>
>       </td>
>       
>       <td style="width: 56.66%; border-top: none; border-left: none; border-bottom: solid #C9C9C9 1.0pt; mso-border-bottom-themecolor: accent3; mso-border-bottom-themetint: 153; border-right: solid #C9C9C9 1.0pt; mso-border-right-themecolor: accent3; mso-border-right-themetint: 153; mso-border-top-alt: solid #C9C9C9 .5pt; mso-border-top-themecolor: accent3; mso-border-top-themetint: 153; mso-border-left-alt: solid #C9C9C9 .5pt; mso-border-left-themecolor: accent3; mso-border-left-themetint: 153; mso-border-alt: solid #C9C9C9 .5pt; mso-border-themecolor: accent3; mso-border-themetint: 153; background: #EDEDED; mso-background-themecolor: accent3; mso-background-themetint: 51; padding: 0cm 5.4pt 0cm 5.4pt;" width="56%">
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">示例：</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache_key $request_method://$host$request_uri; fastcgi.cache.key http://$host$request_uri;</span>
>         </p>
>         
>         <p class="MsoNormal" style="margin-bottom: .0001pt; text-align: justify; text-justify: inter-ideograph; text-indent: 15.75pt; mso-yfti-cnfc: 64;">
>           <span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">定义</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">fastcgi_cache</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">key ,</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">示例中以请求的</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">URI</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">作为缓存的</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">key</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">会取</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">这个</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">key</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">的</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">md5</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">作为缓存文件，如果设置了缓存散列目录，</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">nginx</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">会从后往前取梠应的位数作为目录。</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">注意一定要加作为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">cache key,</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">否则如果先请求的为</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">head </span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">类型，后面的</span><span lang="EN-US" style="font-size: 10.0pt; font-family: 'Times New Roman',serif; mso-fareast-font-family: 宋体;">GET</span><span style="font-size: 10.0pt; font-family: 宋体; mso-ascii-font-family: 'Times New Roman'; mso-hansi-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman';">清求返回为空。</span>
>         </p>
>       </td>
>     </tr>
>   </table>
>   
>   <h2 style="mso-list: l10 level2 lfo4; margin: 6.0pt 0cm 6.0pt 25.1pt;">
>     <span id="14"><a name="_Toc507528125"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.4 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">日志方面优化</span></span>
>   </h2>
>   
>   <h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
>     <span id="141_Nginx"><a name="_Toc507528126"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.4.1 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">配置</span><span lang="EN-US">Nginx</span><span style="mso-bookmark: _Toc507528126;"><span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">服务相关日志操作</span></span></span>
>   </h3>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">01. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进行日志的切割</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>[root@clsn ~]<span style="color: #008000;">#</span><span style="color: #008000;"> mkdir /server/scripts/ -p</span>
[root@clsn ~]<span style="color: #008000;">#</span><span style="color: #008000;"> cd /server/scripts/</span>
[root@clsn scripts]<span style="color: #008000;">#</span><span style="color: #008000;"> vim cut_nginx_log.sh </span><span style="color: #008000;">
#</span><span style="color: #008000;">!/bin/bash</span>
cd /application/nginx/logs &&<span style="color: #000000;">\
</span>/bin/mv www_access.log www_access_$（date +%F -d -1day）.log   <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==将日志按日期改成前一天的名称</span>
/application/nginx/sbin/nginx -s reload  <span style="color: #008000;">#</span><span style="color: #008000;">&lt;==重新加载nginx使得触发重新生成访问日志文件</span></pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 21.0pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">提示：实际上脚本的功能很简单，就是改名日志，然后加载</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，重新生成文件记录日志</span>
>   </p>
>   
>   <p class="MsoNormal" style="text-indent: 21.0pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">说明：也可以编辑使用</span><span lang="EN-US">logrotate</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">日志切割服务，进行日志切割</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">02. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进行日志的选择记录</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>location ~ .*\.（js|jpg|JPG|jpeg|JPEG|css|bmp|gif|<span style="color: #000000;">GIF）$ {
  access_log off;
}</span></pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">03. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">进行日志文件授权</span>
>   </p>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">假如日志目录为</span><span lang="EN-US">/app/logs</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">，则授权方法如下：</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>chown -R root.root /app/<span style="color: #000000;">logs
chmod </span>-R 700 /app/logs</pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US">04. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">日志信息尽量汇总备份</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>[root@clsn ~]<span style="color: #008000;">#</span><span style="color: #008000;"> zgrep 456 clsn.tar.gz</span></pre>
>   </div>
>   
>   <h3 style="mso-list: l10 level3 lfo4; margin: 6.0pt 0cm 6.0pt 43.1pt;">
>     <span id="142"><a name="_Toc507528127"></a><!-- [if !supportLists]-->
>     
>     <span lang="EN-US" style="mso-fareast-font-family: 'Courier New'; mso-bidi-font-family: 'Courier New';"><span style="mso-list: Ignore;">1.4.2 </span></span><!--[endif]-->
>     
>     <span style="font-family: '微软雅黑',sans-serif; mso-ascii-font-family: 'Courier New'; mso-hansi-font-family: 'Courier New';">查看软件编译时的参数</span></span>
>   </h3>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">①</span><span lang="EN-US">. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看</span><span lang="EN-US">nginx</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">安装时编译了哪些参数</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>/application/nginx/sbin/nginx -V</pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">②</span><span lang="EN-US">. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看</span><span lang="EN-US">apache</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">安装时编译了哪些参数</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>cat /application/apache/build/<span style="color: #000000;">config.nice         
</span>/application/apache/bin/apachectl -V     <span style="color: #008000;">#</span><span style="color: #008000;">&lt;--也可查看安装时编译信息，但显示的不全</span></pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">③</span><span lang="EN-US">. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看</span><span lang="EN-US">mysql</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">安装时编译了哪些参数</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>grep CONFIGURE_LINE /application/mysql/bin/mysqlbug</pre>
>   </div>
>   
>   <p class="MsoNormal" style="text-indent: 15.75pt;">
>     <span lang="EN-US">PS</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">：</span><span lang="EN-US">mysql</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">二进制包的安装方式，是无法看到编译参数的，默认为空</span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">④</span><span lang="EN-US">. </span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">查看</span><span lang="EN-US">php</span><span style="font-family: 等线; mso-ascii-font-family: Calibri; mso-ascii-theme-font: minor-latin; mso-fareast-font-family: 等线; mso-fareast-theme-font: minor-fareast; mso-hansi-font-family: Calibri; mso-hansi-theme-font: minor-latin;">安装时编译了哪些参数</span>
>   </p>
>   
>   <div class="cnblogs_code">
>     <pre>/application/php/bin/php -i|grep configure</pre>
>   </div>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US"> </span><span lang="EN-US"> </span>
>   </p>
>   
>   <p class="MsoNormal">
>     <span lang="EN-US"> </span>
>   </p>
>   
>   <div id="toc_container" class="toc_white have_bullets">
>     <ul class="toc_list">
>       <li>
>         <a href="#11_Nginx">1.1 Nginx优化分类</a>
>       </li>
>       <li>
>         <a href="#12_Nginx">1.2 Nginx安全优化</a><ul>
>           <li>
>             <a href="#121_nginx">1.2.1 隐藏nginx版本信息优化</a>
>           </li>
>           <li>
>             <a href="#122_nginx">1.2.2 修改nginx版本信息</a>
>           </li>
>           <li>
>             <a href="#123_worker">1.2.3 修改worker进程的用户</a>
>           </li>
>           <li>
>             <a href="#124">1.2.4 上传文件大小的限制（动态应用）</a>
>           </li>
>           <li>
>             <a href="#125_NginxURL">1.2.5 站点 Nginx站点目录及文件URL访问控制</a>
>           </li>
>           <li>
>             <a href="#126_Nginx">1.2.6 配置Nginx，禁止非法域名解析访问企业网站</a>
>           </li>
>           <li>
>             <a href="#127_Nginx">1.2.7 Nginx图片及目录防盗链解决方案</a>
>           </li>
>           <li>
>             <a href="#128_NGINX">1.2.8 NGINX错误页面友好显示</a>
>           </li>
>           <li>
>             <a href="#129_Nginx">1.2.9 Nginx站点目录文件及目录权限优化</a>
>           </li>
>           <li>
>             <a href="#1210_Nginx">1.2.10 Nginx防爬虫优化</a>
>           </li>
>           <li>
>             <a href="#1211_NginxHTTP">1.2.11 利用Nginx限制HTTP的请求方法</a>
>           </li>
>           <li>
>             <a href="#1212_nginx">1.2.12 使用普通用户启动nginx</a>
>           </li>
>         </ul>
>       </li>
>       
>       <li>
>         <a href="#13_Nginx">1.3 Nginx性能优化</a><ul>
>           <li>
>             <a href="#131_nginx_worker">1.3.1 优化nginx worker进行个数</a>
>           </li>
>           <li>
>             <a href="#132_nginxCPU">1.3.2 绑定不同的nginx进程到不同的CPU上</a>
>           </li>
>           <li>
>             <a href="#133_nginx">1.3.3 优化nginx事件处理模型</a>
>           </li>
>           <li>
>             <a href="#134_nginx">1.3.4 调整nginx单个进程允许的客户端最大连接数</a>
>           </li>
>           <li>
>             <a href="#135_Nginx_worker">1.3.5 配置Nginx worker进程最大打开文件数</a>
>           </li>
>           <li>
>             <a href="#136_nginx">1.3.6 优化nginx高效文件传输模式</a>
>           </li>
>           <li>
>             <a href="#137_nginx">1.3.7 设置nginx服务超时参数</a>
>           </li>
>           <li>
>             <a href="#138_Nginx_gzip">1.3.8 配置Nginx gzip压缩实现性能优化</a>
>           </li>
>           <li>
>             <a href="#139_Nginx_expires">1.3.9 配置Nginx expires缓存实现性能优化</a>
>           </li>
>           <li>
>             <a href="#1310_FastCGI">1.3.10 配置FastCGI优化</a>
>           </li>
>         </ul>
>       </li>
>       
>       <li>
>         <a href="#14">1.4 日志方面优化</a><ul>
>           <li>
>             <a href="#141_Nginx">1.4.1 配置Nginx服务相关日志操作</a>
>           </li>
>           <li>
>             <a href="#142">1.4.2 查看软件编译时的参数</a>
>           </li>
>         </ul>
>       </li>
>     </ul>
>   </div>